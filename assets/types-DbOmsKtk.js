import{__toESM as b}from"./chunk-DgAfPHQg.js";import{CurrencyAmount as y,Price as T,TradeType as P,init_sdk_core_esm as F}from"./utils-BX1Fu73x.js";import{AddressZero as I,BigNumber as d,MaxUint256 as W,init_lib$1 as Y,init_lib$5 as K}from"./lib-DPFIyRke.js";import{ZERO_PERCENT as h}from"./misc-BMnlqqV4.js";import{TypedDataEncoder as J}from"./lib-CKG8APVv.js";import{AbiCoder as E}from"./lib-XGdDYWzD.js";import{BPS as O,MissingConfiguration as Z,PERMIT2_MAPPING as U,PriorityOrderTrade as z,V2DutchOrderTrade as j,V3DutchOrderTrade as Q,areCurrenciesEqual as D,getDecayedAmount as _,init_lib as $,parseValidation as tt,require_dist as et,require_dist$1 as it}from"./V3DutchOrderTrade-Cl7yELmp.js";import{computeAddress as rt,recoverPublicKey as nt}from"./lib-BncBk3QF.js";var e=(function(t){function i(s){"@babel/helpers - typeof";return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},i(s)}function r(s,o){if(i(s)!="object"||!s)return s;var u=s[Symbol.toPrimitive];if(u!==void 0){var p=u.call(s,o||"default");if(i(p)!="object")return p;throw TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(s)}function n(s){var o=r(s,"string");return i(o)=="symbol"?o:o+""}function a(s,o,u){return(o=n(o))in s?Object.defineProperty(s,o,{value:u,enumerable:!0,configurable:!0,writable:!0}):s[o]=u,s}return t.defineProperty=a,t})({}),g=b(et());$();const st=d.from(0),C={ExclusiveDutchOrder:[{name:"info",type:"OrderInfo"},{name:"decayStartTime",type:"uint256"},{name:"decayEndTime",type:"uint256"},{name:"exclusiveFiller",type:"address"},{name:"exclusivityOverrideBps",type:"uint256"},{name:"inputToken",type:"address"},{name:"inputStartAmount",type:"uint256"},{name:"inputEndAmount",type:"uint256"},{name:"outputs",type:"DutchOutput[]"}],OrderInfo:[{name:"reactor",type:"address"},{name:"swapper",type:"address"},{name:"nonce",type:"uint256"},{name:"deadline",type:"uint256"},{name:"additionalValidationContract",type:"address"},{name:"additionalValidationData",type:"bytes"}],DutchOutput:[{name:"token",type:"address"},{name:"startAmount",type:"uint256"},{name:"endAmount",type:"uint256"},{name:"recipient",type:"address"}]},x=["tuple("+["tuple(address,address,uint256,uint256,address,bytes)","uint256","uint256","address","uint256","tuple(address,uint256,uint256)","tuple(address,uint256,uint256,address)[]"].join(",")+")"];var ot=class w{constructor(i,r,n){if(this.info=i,this.chainId=r,this._permit2Address=n,n)this.permit2Address=n;else if(U[r])this.permit2Address=U[r];else throw new Z("permit2",r.toString())}static fromJSON(i,r,n){return new w(Object.assign(Object.assign({},i),{exclusivityOverrideBps:d.from(i.exclusivityOverrideBps),nonce:d.from(i.nonce),input:{token:i.input.token,startAmount:d.from(i.input.startAmount),endAmount:d.from(i.input.endAmount)},outputs:i.outputs.map(a=>({token:a.token,startAmount:d.from(a.startAmount),endAmount:d.from(a.endAmount),recipient:a.recipient}))}),r,n)}static parse(i,r,n){const s=new E().decode(x,i),[[[o,u,p,f,c,m],l,S,V,G,[q,B,R],k]]=s;return new w({reactor:o,swapper:u,nonce:p,deadline:f.toNumber(),additionalValidationContract:c,additionalValidationData:m,decayStartTime:l.toNumber(),decayEndTime:S.toNumber(),exclusiveFiller:V,exclusivityOverrideBps:G,input:{token:q,startAmount:B,endAmount:R},outputs:k.map(([L,H,M,X])=>({token:L,startAmount:H,endAmount:M,recipient:X}))},r,n)}toJSON(){return{chainId:this.chainId,permit2Address:this.permit2Address,reactor:this.info.reactor,swapper:this.info.swapper,nonce:this.info.nonce.toString(),deadline:this.info.deadline,additionalValidationContract:this.info.additionalValidationContract,additionalValidationData:this.info.additionalValidationData,decayStartTime:this.info.decayStartTime,decayEndTime:this.info.decayEndTime,exclusiveFiller:this.info.exclusiveFiller,exclusivityOverrideBps:this.info.exclusivityOverrideBps.toString(),input:{token:this.info.input.token,startAmount:this.info.input.startAmount.toString(),endAmount:this.info.input.endAmount.toString()},outputs:this.info.outputs.map(i=>({token:i.token,startAmount:i.startAmount.toString(),endAmount:i.endAmount.toString(),recipient:i.recipient}))}}get blockOverrides(){}serialize(){return new E().encode(x,[[[this.info.reactor,this.info.swapper,this.info.nonce,this.info.deadline,this.info.additionalValidationContract,this.info.additionalValidationData],this.info.decayStartTime,this.info.decayEndTime,this.info.exclusiveFiller,this.info.exclusivityOverrideBps,[this.info.input.token,this.info.input.startAmount,this.info.input.endAmount],this.info.outputs.map(r=>[r.token,r.startAmount,r.endAmount,r.recipient])]])}getSigner(i){return rt(nt(g.SignatureTransfer.hash(this.toPermit(),this.permit2Address,this.chainId,this.witness()),i))}permitData(){return g.SignatureTransfer.getPermitData(this.toPermit(),this.permit2Address,this.chainId,this.witness())}hash(){return J.from(C).hash(this.witnessInfo())}resolve(i){const r=this.info.exclusiveFiller!==I&&i.timestamp<=this.info.decayStartTime&&i.filler!==this.info.exclusiveFiller;return{input:{token:this.info.input.token,amount:_({decayStartTime:this.info.decayStartTime,decayEndTime:this.info.decayEndTime,startAmount:this.info.input.startAmount,endAmount:this.info.input.endAmount},i.timestamp)},outputs:this.info.outputs.map(n=>{const a=_({decayStartTime:this.info.decayStartTime,decayEndTime:this.info.decayEndTime,startAmount:n.startAmount,endAmount:n.endAmount},i.timestamp);let s=a;return r&&(this.info.exclusivityOverrideBps.eq(st)?s=W:s=a.mul(this.info.exclusivityOverrideBps.add(O)).div(O)),{token:n.token,amount:s}})}}get validation(){return tt(this.info)}toPermit(){return{permitted:{token:this.info.input.token,amount:this.info.input.endAmount},spender:this.info.reactor,nonce:this.info.nonce,deadline:this.info.deadline}}witnessInfo(){return{info:{reactor:this.info.reactor,swapper:this.info.swapper,nonce:this.info.nonce,deadline:this.info.deadline,additionalValidationContract:this.info.additionalValidationContract,additionalValidationData:this.info.additionalValidationData},decayStartTime:this.info.decayStartTime,decayEndTime:this.info.decayEndTime,exclusiveFiller:this.info.exclusiveFiller,exclusivityOverrideBps:this.info.exclusivityOverrideBps,inputToken:this.info.input.token,inputStartAmount:this.info.input.startAmount,inputEndAmount:this.info.input.endAmount,outputs:this.info.outputs}}witness(){return{witness:this.witnessInfo(),witnessTypeName:"ExclusiveDutchOrder",witnessType:C}}};F();var N=class{constructor({currencyIn:t,currenciesOut:i,orderInfo:r,tradeType:n}){this._currencyIn=t,this._currenciesOut=i,this.tradeType=n,this.order=new ot(r,t.chainId)}get inputAmount(){if(this._inputAmount)return this._inputAmount;const t=y.fromRawAmount(this._currencyIn,this.order.info.input.startAmount.toString());return this._inputAmount=t,t}get outputAmounts(){if(this._outputAmounts)return this._outputAmounts;const t=this.order.info.outputs.map(i=>{const r=this._currenciesOut.find(n=>D(n,i.token,n.chainId));if(!r)throw new Error("currency not found in output array");return y.fromRawAmount(r,i.startAmount.toString())});return this._outputAmounts=t,t}getFirstNonFeeOutputStartEndAmounts(){if(this._firstNonFeeOutputStartEndAmounts)return this._firstNonFeeOutputStartEndAmounts;if(this.order.info.outputs.length===0)throw new Error("there must be at least one output token");const t=this.order.info.outputs[0],i=this._currenciesOut.find(n=>D(n,t.token,n.chainId));if(!i)throw new Error("currency output from order must exist in currenciesOut list");const r={startAmount:y.fromRawAmount(i,t.startAmount.toString()),endAmount:y.fromRawAmount(i,t.endAmount.toString())};return this._firstNonFeeOutputStartEndAmounts=r,r}get outputAmount(){return this.getFirstNonFeeOutputStartEndAmounts().startAmount}minimumAmountOut(){return this.getFirstNonFeeOutputStartEndAmounts().endAmount}maximumAmountIn(){return y.fromRawAmount(this._currencyIn,this.order.info.input.endAmount.toString())}get executionPrice(){var t;return(t=this._executionPrice)!==null&&t!==void 0?t:this._executionPrice=new T(this.inputAmount.currency,this.outputAmount.currency,this.inputAmount.quotient,this.outputAmount.quotient)}worstExecutionPrice(){return new T(this.inputAmount.currency,this.outputAmount.currency,this.maximumAmountIn().quotient,this.minimumAmountOut().quotient)}};K();Y();var at=b(it());F();let At=(function(t){return t.LOADING="loading",t.INVALID="invalid",t.STALE="stale",t.NO_ROUTE_FOUND="no_route_found",t.VALID="valid",t})({}),Tt=(function(t){return t.ROUTING_API="ROUTING_API",t.QUICK_ROUTE="QUICK_ROUTE",t.CLIENT_SIDE_FALLBACK="CLIENT_SIDE_FALLBACK",t})({});const St="price",ut=1.15;let wt=(function(t){return t.X="uniswapx",t.API="api",t})({}),Pt=(function(t){return t.Pricing="pricing",t.Quote="quote",t})({});function Et(t){return t.routing===pt.CLASSIC}let v=(function(t){return t.Classic="classic",t.UniswapX="uniswap_x",t.UniswapXv2="uniswap_x_v2",t.UniswapXv3="uniswap_x_v3",t.None="none",t})({});var Ot=class extends at.Trade{constructor({gasUseEstimate:t,gasUseEstimateUSD:i,blockNumber:r,requestId:n,quoteMethod:a,approveInfo:s,swapFee:o,...u}){super(u),e.defineProperty(this,"fillType",v.Classic),e.defineProperty(this,"approveInfo",void 0),e.defineProperty(this,"gasUseEstimate",void 0),e.defineProperty(this,"gasUseEstimateUSD",void 0),e.defineProperty(this,"blockNumber",void 0),e.defineProperty(this,"requestId",void 0),e.defineProperty(this,"quoteMethod",void 0),e.defineProperty(this,"swapFee",void 0),this.blockNumber=r,this.gasUseEstimateUSD=i,this.requestId=n,this.quoteMethod=a,this.approveInfo=s,this.swapFee=o,this.gasUseEstimate=t}get executionPrice(){return this.tradeType===P.EXACT_INPUT||!this.swapFee?super.executionPrice:new T({baseAmount:this.inputAmount,quoteAmount:this.postSwapFeeOutputAmount})}get postSwapFeeOutputAmount(){var t;if(this.tradeType===P.EXACT_INPUT)return this.outputAmount;const i=y.fromRawAmount(this.outputAmount.currency,((t=this.swapFee)===null||t===void 0?void 0:t.amount)??0);return this.outputAmount.subtract(i)}get totalGasUseEstimateUSD(){return this.approveInfo.needsApprove&&this.gasUseEstimateUSD?this.approveInfo.approveGasEstimateUSD+this.gasUseEstimateUSD:this.gasUseEstimateUSD}get totalGasUseEstimateUSDWithBuffer(){return this.totalGasUseEstimateUSD?this.totalGasUseEstimateUSD*ut:0}};let A=(function(t){return t.DUTCH_AUCTION="Dutch",t.DUTCH_V2_AUCTION="Dutch_V2",t.DUTCH_V3_AUCTION="Dutch_V3",t.LIMIT_ORDER="Limit",t.DUTCH_V1_AND_V2="Dutch_V1_V2",t.PRIORITY_ORDER="Priority",t})({});var Ut=class extends N{constructor({currencyIn:t,currenciesOut:i,orderInfo:r,tradeType:n,quoteId:a,requestId:s,wrapInfo:o,approveInfo:u,classicGasUseEstimateUSD:p,auctionPeriodSecs:f,startTimeBufferSecs:c,deadlineBufferSecs:m,slippageTolerance:l,swapFee:S}){super({currencyIn:t,currenciesOut:i,orderInfo:r,tradeType:n}),e.defineProperty(this,"fillType",v.UniswapX),e.defineProperty(this,"offchainOrderType",A.DUTCH_AUCTION),e.defineProperty(this,"quoteId",void 0),e.defineProperty(this,"requestId",void 0),e.defineProperty(this,"wrapInfo",void 0),e.defineProperty(this,"approveInfo",void 0),e.defineProperty(this,"classicGasUseEstimateUSD",void 0),e.defineProperty(this,"auctionPeriodSecs",void 0),e.defineProperty(this,"startTimeBufferSecs",void 0),e.defineProperty(this,"deadlineBufferSecs",void 0),e.defineProperty(this,"slippageTolerance",void 0),e.defineProperty(this,"inputTax",h),e.defineProperty(this,"outputTax",h),e.defineProperty(this,"swapFee",void 0),this.quoteId=a,this.requestId=s,this.approveInfo=u,this.wrapInfo=o,this.classicGasUseEstimateUSD=p,this.auctionPeriodSecs=f,this.deadlineBufferSecs=m,this.slippageTolerance=l,this.startTimeBufferSecs=c,this.swapFee=S}get totalGasUseEstimateUSD(){return this.wrapInfo.needsWrap&&this.approveInfo.needsApprove?this.wrapInfo.wrapGasEstimateUSD+this.approveInfo.approveGasEstimateUSD:this.wrapInfo.needsWrap?this.wrapInfo.wrapGasEstimateUSD:this.approveInfo.needsApprove?this.approveInfo.approveGasEstimateUSD:0}asDutchOrderTrade(){return this}},Dt=class extends j{constructor({currencyIn:t,currenciesOut:i,orderInfo:r,tradeType:n,quoteId:a,requestId:s,wrapInfo:o,approveInfo:u,classicGasUseEstimateUSD:p,deadlineBufferSecs:f,slippageTolerance:c,swapFee:m,forceOpenOrder:l}){super({currencyIn:t,currenciesOut:i,orderInfo:r,tradeType:n}),e.defineProperty(this,"fillType",v.UniswapXv2),e.defineProperty(this,"offchainOrderType",A.DUTCH_V2_AUCTION),e.defineProperty(this,"quoteId",void 0),e.defineProperty(this,"requestId",void 0),e.defineProperty(this,"wrapInfo",void 0),e.defineProperty(this,"approveInfo",void 0),e.defineProperty(this,"classicGasUseEstimateUSD",void 0),e.defineProperty(this,"deadlineBufferSecs",void 0),e.defineProperty(this,"slippageTolerance",void 0),e.defineProperty(this,"inputTax",h),e.defineProperty(this,"outputTax",h),e.defineProperty(this,"swapFee",void 0),e.defineProperty(this,"forceOpenOrder",void 0),this.quoteId=a,this.requestId=s,this.approveInfo=u,this.wrapInfo=o,this.classicGasUseEstimateUSD=p,this.deadlineBufferSecs=f,this.slippageTolerance=c,this.swapFee=m,this.forceOpenOrder=l}get totalGasUseEstimateUSD(){return this.wrapInfo.needsWrap&&this.approveInfo.needsApprove?this.wrapInfo.wrapGasEstimateUSD+this.approveInfo.approveGasEstimateUSD:this.wrapInfo.needsWrap?this.wrapInfo.wrapGasEstimateUSD:this.approveInfo.needsApprove?this.approveInfo.approveGasEstimateUSD:0}},_t=class extends Q{constructor({currencyIn:t,currenciesOut:i,orderInfo:r,tradeType:n,quoteId:a,requestId:s,wrapInfo:o,approveInfo:u,classicGasUseEstimateUSD:p,deadlineBufferSecs:f,slippageTolerance:c,swapFee:m,forceOpenOrder:l}){super({currencyIn:t,currenciesOut:i,orderInfo:r,tradeType:n}),e.defineProperty(this,"fillType",v.UniswapXv3),e.defineProperty(this,"offchainOrderType",A.DUTCH_V3_AUCTION),e.defineProperty(this,"quoteId",void 0),e.defineProperty(this,"requestId",void 0),e.defineProperty(this,"wrapInfo",void 0),e.defineProperty(this,"approveInfo",void 0),e.defineProperty(this,"classicGasUseEstimateUSD",void 0),e.defineProperty(this,"deadlineBufferSecs",void 0),e.defineProperty(this,"slippageTolerance",void 0),e.defineProperty(this,"inputTax",h),e.defineProperty(this,"outputTax",h),e.defineProperty(this,"swapFee",void 0),e.defineProperty(this,"forceOpenOrder",void 0),this.quoteId=a,this.requestId=s,this.approveInfo=u,this.wrapInfo=o,this.classicGasUseEstimateUSD=p,this.deadlineBufferSecs=f,this.slippageTolerance=c,this.swapFee=m,this.forceOpenOrder=l}get totalGasUseEstimateUSD(){return this.wrapInfo.needsWrap&&this.approveInfo.needsApprove?this.wrapInfo.wrapGasEstimateUSD+this.approveInfo.approveGasEstimateUSD:this.wrapInfo.needsWrap?this.wrapInfo.wrapGasEstimateUSD:this.approveInfo.needsApprove?this.approveInfo.approveGasEstimateUSD:0}},gt=class extends z{constructor({currencyIn:t,currenciesOut:i,orderInfo:r,tradeType:n,quoteId:a,requestId:s,wrapInfo:o,approveInfo:u,classicGasUseEstimateUSD:p,startTimeBufferSecs:f,deadlineBufferSecs:c,slippageTolerance:m,swapFee:l}){super({currencyIn:t,currenciesOut:i,orderInfo:r,tradeType:n}),e.defineProperty(this,"fillType",v.UniswapX),e.defineProperty(this,"offchainOrderType",A.PRIORITY_ORDER),e.defineProperty(this,"quoteId",void 0),e.defineProperty(this,"requestId",void 0),e.defineProperty(this,"wrapInfo",void 0),e.defineProperty(this,"approveInfo",void 0),e.defineProperty(this,"classicGasUseEstimateUSD",void 0),e.defineProperty(this,"startTimeBufferSecs",void 0),e.defineProperty(this,"deadlineBufferSecs",void 0),e.defineProperty(this,"slippageTolerance",void 0),e.defineProperty(this,"inputTax",h),e.defineProperty(this,"outputTax",h),e.defineProperty(this,"swapFee",void 0),this.quoteId=a,this.requestId=s,this.approveInfo=u,this.wrapInfo=o,this.classicGasUseEstimateUSD=p,this.deadlineBufferSecs=c,this.slippageTolerance=m,this.startTimeBufferSecs=f,this.swapFee=l}get totalGasUseEstimateUSD(){return this.wrapInfo.needsWrap&&this.approveInfo.needsApprove?this.wrapInfo.wrapGasEstimateUSD+this.approveInfo.approveGasEstimateUSD:this.wrapInfo.needsWrap?this.wrapInfo.wrapGasEstimateUSD:this.approveInfo.needsApprove?this.approveInfo.approveGasEstimateUSD:0}};const dt="0x6000da47483062a0d734ba3dc7576ce6a0b645c4";var Ct=class{constructor({tradeType:t,amountIn:i,amountOut:r,deadlineBufferSecs:n,swapFee:a,wrapInfo:s,approveInfo:o,swapper:u}){e.defineProperty(this,"fillType",v.UniswapX),e.defineProperty(this,"offchainOrderType",A.LIMIT_ORDER),e.defineProperty(this,"deadlineBufferSecs",void 0),e.defineProperty(this,"wrapInfo",void 0),e.defineProperty(this,"approveInfo",void 0),e.defineProperty(this,"swapFee",void 0),e.defineProperty(this,"amountIn",void 0),e.defineProperty(this,"amountOut",void 0),e.defineProperty(this,"tradeType",void 0),e.defineProperty(this,"swapper",void 0),e.defineProperty(this,"deadline",void 0),e.defineProperty(this,"inputTax",h),e.defineProperty(this,"outputTax",h),e.defineProperty(this,"slippageTolerance",h),e.defineProperty(this,"quoteId",void 0),e.defineProperty(this,"requestId",void 0),this.deadlineBufferSecs=n,this.swapFee=a,this.wrapInfo=s,this.approveInfo=o,this.amountIn=i,this.amountOut=r,this.tradeType=t,this.swapper=u;const p=Math.floor(Date.now()/1e3);this.deadline=(p+n)*1e3}asDutchOrderTrade(t){const i={token:this.amountOut.currency.isNative?I:this.amountOut.currency.address,recipient:(t==null?void 0:t.swapper)??this.swapper,startAmount:d.from(this.amountOut.quotient.toString()),endAmount:d.from(this.amountOut.quotient.toString())},r=this.swapFee&&{token:this.amountOut.currency.isNative?I:this.amountOut.currency.address,recipient:this.swapFee.recipient,startAmount:d.from(this.amountOut.multiply(this.swapFee.percent).quotient.toString()),endAmount:d.from(this.amountOut.multiply(this.swapFee.percent).quotient.toString())},n=r?[i,r]:[i],a=Math.floor(Date.now()/1e3);return new N({currencyIn:this.amountIn.currency,currenciesOut:[this.amountOut.currency],orderInfo:{reactor:dt,swapper:(t==null?void 0:t.swapper)??this.swapper,deadline:(a+this.deadlineBufferSecs)*1e3,additionalValidationContract:I,additionalValidationData:"0x",nonce:(t==null?void 0:t.nonce)??d.from(0),decayStartTime:a,decayEndTime:a,exclusiveFiller:I,exclusivityOverrideBps:d.from(0),input:{token:this.amountIn.currency.address,startAmount:d.from(this.amountIn.quotient.toString()),endAmount:d.from(this.amountIn.quotient.toString())},outputs:n},tradeType:this.tradeType})}get inputAmount(){return this.amountIn}get outputAmount(){return this.amountOut}get postTaxOutputAmount(){return this.outputAmount}get totalGasUseEstimateUSD(){return this.wrapInfo.needsWrap?this.wrapInfo.wrapGasEstimateUSD:0}get classicGasUseEstimateUSD(){return 0}get startTimeBufferSecs(){return 0}get auctionPeriodSecs(){return 0}get executionPrice(){return new T(this.amountIn.currency,this.amountOut.currency,this.amountIn.quotient,this.amountOut.quotient)}worstExecutionPrice(){return this.executionPrice}maximumAmountIn(){return this.inputAmount}minimumAmountOut(){return this.outputAmount}};let xt=(function(t){return t.SUCCESS="Success",t.NOT_FOUND="Not found",t})({}),bt=(function(t){return t.V2Pool="v2-pool",t.V3Pool="v3-pool",t})({}),Ft=(function(t){return t.MATIC="MATIC",t.BNB="BNB",t.AVAX="AVAX",t.ETH="ETH",t.MON="MON",t})({}),pt=(function(t){return t.CLASSIC="CLASSIC",t.DUTCH_V1="DUTCH_LIMIT",t.DUTCH_V2="DUTCH_V2",t.DUTCH_V3="DUTCH_V3",t.PRIORITY="PRIORITY",t})({});export{Ot as ClassicTrade,ot as DutchOrder,Ut as DutchOrderTrade,St as INTERNAL_ROUTER_PREFERENCE_PRICE,Ct as LimitOrderTrade,A as OffchainOrderType,bt as PoolType,gt as PriorityOrderTrade,Pt as QuoteIntent,Tt as QuoteMethod,xt as QuoteState,wt as RouterPreference,Ft as SwapRouterNativeAssets,v as TradeFillType,At as TradeState,pt as URAQuoteType,Dt as V2DutchOrderTrade,_t as V3DutchOrderTrade,Et as isClassicQuoteResponse};
