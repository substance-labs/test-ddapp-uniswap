import{__toESM as Y}from"./chunk-DgAfPHQg.js";import{require_react as se}from"./react-CNoFhWkx.js";import{Trans as C}from"./src-DOOtfpHS.js";import{useTranslation as ue}from"./useTranslation-BotBuoJf.js";import{ReactQueryCacheKey as Z}from"./cache-BFZkIToX.js";import{require_jsx_runtime as ae}from"./jsx-runtime-D7bMTQeG.js";import{CurrencyAmount as P,init_sdk_core_esm as M}from"./utils-BX1Fu73x.js";import{ONE_SECOND_MS as ee}from"./time-D_OqcZ4M.js";import{Position as W,init_v4_sdk_esm as de}from"./V3DutchOrderTrade-Cl7yELmp.js";import{Position as V,init_v3_sdk_esm as le}from"./v3-sdk.esm-CHH6GWR1.js";import{useQuery as ne}from"./useQuery-D_ZCw8XG.js";import{useExperimentValue as ce}from"./hooks-Bp0VtWbX.js";import{createLpPosition as pe,increaseLpPosition as me}from"./TradingApiClient-Cp_0ez5S.js";import{applyNativeTokenPercentageBuffer as fe,useOnChainCurrencyBalance as q,useUSDCValue as I}from"./useUSDCPrice-HO7Wgroz.js";import{uniswapUrls as oe}from"./urls-kwiZbYPW.js";import{ProtocolVersion as w}from"./types_pb-yZxlo4b1.js";import{CurrencyField as L}from"./currency-xm5i4cH7.js";import{getTradeSettingsDeadline as te}from"./getTradeSettingsDeadline-B3uZN4NF.js";import{CurrencyInputPanel as z,useMaxAmountSpend as H}from"./CurrencyInputPanel-CJ-UCFJ3.js";import{Experiments as Te,NativeTokenPercentageBufferProperties as ve}from"./experiments-rc6XUB0U.js";import{useCurrencyInfo as U}from"./Tokens-HEKZ8edJ.js";import{tryParseCurrencyAmount as Q}from"./tryParseCurrencyAmount-Bt3FPZDG.js";import{PositionField as t}from"./hasLPFoTTransferError-Co-P2mPd.js";let Qe=(function(e){return e.TOKEN_0="TOKEN_0",e.TOKEN_1="TOKEN_1",e})({});function re(){return ce({experiment:Te.NativeTokenPercentageBuffer,param:ve.BufferSize,defaultValue:1})}M();le();de();function Ee({independentAmount:e,otherAmount:i,pair:r,exactField:s,token0:n,token1:o,dependentToken:u}){const[l,c]=[n==null?void 0:n.wrapped,o==null?void 0:o.wrapped];if(!(!l||!c||!e||!r))try{const a=s===t.TOKEN0?r.priceOf(l).quote(e.wrapped):r.priceOf(c).quote(e.wrapped);return u?u.isNative?P.fromRawAmount(u,a.quotient):a:void 0}catch{return i}}function _e({independentAmount:e,pool:i,tickLower:r,tickUpper:s}){const n=e.wrapped;return n.currency.equals(i.token0)?V.fromAmount0({pool:i,tickLower:r,tickUpper:s,amount0:n.quotient,useFullPrecision:!0}).amount1:V.fromAmount1({pool:i,tickLower:r,tickUpper:s,amount1:n.quotient}).amount0}function Ne({independentAmount:e,pool:i,tickLower:r,tickUpper:s}){return e.currency.equals(i.token0)?W.fromAmount0({pool:i,tickLower:r,tickUpper:s,amount0:e.quotient,useFullPrecision:!0}).amount1:W.fromAmount1({pool:i,tickLower:r,tickUpper:s,amount1:e.quotient}).amount0}M();var T=Y(se()),f=Y(ae());function A(e,i){return(0,T.useMemo)(()=>{if(e)return fe(e,i)},[e,i])}function $e(e){const i=re(),{protocolVersion:r,address:s,token0:n,token1:o,exactField:u,exactAmounts:l}=e,{balance:c}=q(n,s),{balance:a}=q(o,s),_=A(c,i),p=A(a,i),E=H({currencyAmount:_}),x=H({currencyAmount:p}),[D,v]=u===t.TOKEN0?[n,o]:[o,n],d=Q(l[u],D),K=Q(l[u===t.TOKEN0?t.TOKEN1:t.TOKEN0],v),m=(0,T.useMemo)(()=>{if(e.skipDependentAmount||r===w.UNSPECIFIED)return v&&P.fromRawAmount(v,0);if(r===w.V2)return Ee({independentAmount:d,otherAmount:K,pair:e.poolOrPair,exactField:u,token0:n,token1:o,dependentToken:v});const{tickLower:b,tickUpper:R}=e;if(b===void 0||R===void 0||!e.poolOrPair||!d)return;const ie=r===w.V3?_e({independentAmount:d,pool:e.poolOrPair,tickLower:b,tickUpper:R}):Ne({independentAmount:d,pool:e.poolOrPair,tickLower:b,tickUpper:R});return v&&P.fromRawAmount(v,ie.quotient)},[e,r,d,K,v,u,n,o]),S=I(d),y=I(m),h=u===t.TOKEN0?t.TOKEN1:t.TOKEN0,O=(0,T.useMemo)(()=>({[t.TOKEN0]:u===t.TOKEN0?d:m,[t.TOKEN1]:u===t.TOKEN0?m:d}),[m,d,u]),{[t.TOKEN0]:g,[t.TOKEN1]:N}=O,{t:k}=ue(),j=(0,T.useMemo)(()=>{if(!O[t.TOKEN0]||!O[t.TOKEN1])return k("common.noAmount.error");const B=g&&(E==null?void 0:E.lessThan(g)),b=N&&(x==null?void 0:x.lessThan(N));if(B&&b)return(0,f.jsx)(C,{i18nKey:"common.insufficientBalance.error"});if(B)return(0,f.jsx)(C,{i18nKey:"common.insufficientTokenBalance.error",values:{tokenSymbol:n==null?void 0:n.symbol}});if(b)return(0,f.jsx)(C,{i18nKey:"common.insufficientTokenBalance.error",values:{tokenSymbol:o==null?void 0:o.symbol}})},[O,g,E,N,x,k,n==null?void 0:n.symbol,o==null?void 0:o.symbol]);return(0,T.useMemo)(()=>({currencyBalances:{[t.TOKEN0]:c,[t.TOKEN1]:a},formattedAmounts:{[u]:l[u],[h]:m==null?void 0:m.toExact()},currencyAmounts:{[u]:d,[h]:m},currencyAmountsUSDValue:{[u]:S,[h]:y},error:j}),[c,a,u,l,h,m,d,S,y,j])}const $="  _display-flex _alignItems-stretch _flexBasis-auto _boxSizing-border-box _position-relative _minHeight-0px _minWidth-0px _flexShrink-0 _flexDirection-column _gap-2px ",Oe="  _display-flex _alignItems-stretch _flexBasis-auto _boxSizing-border-box _position-relative _minHeight-0px _minWidth-0px _flexShrink-0 _flexDirection-column _gap-t-space-gap52 ",xe="  _display-flex _alignItems-stretch _flexBasis-auto _boxSizing-border-box _position-relative _minHeight-0px _minWidth-0px _flexShrink-0 _flexDirection-column _backgroundColor-surface2 _borderBottomLeftRadius-t-radius-ro291586424 _borderBottomRightRadius-t-radius-ro291586424 _pt-t-space-spa94665593 _pb-t-space-spa94665593 _pr-t-space-spa1360334076 _pl-t-space-spa1360334076 ",F="$rounded20",G={borderTopLeftRadius:F,borderTopRightRadius:F,backgroundColor:"$surface2"};function J(e){return{borderBottomLeftRadius:e?"$rounded0":F,borderBottomRightRadius:e?"$rounded0":F}}function X({children:e}){return(0,f.jsx)("div",{className:xe,children:e})}function Ge({token0:e,token1:i,currencyAmounts:r,currencyBalances:s,currencyAmountsUSDValue:n,formattedAmounts:o,onUserInput:u,onSetMax:l,deposit0Disabled:c,deposit1Disabled:a,token0UnderCardComponent:_,token1UnderCardComponent:p,amount0Loading:E,amount1Loading:x,autofocus:D=!0}){const v=re(),[d,K]=(0,T.useState)(D?t.TOKEN0:void 0),m=A(s==null?void 0:s[t.TOKEN0],v),S=A(s==null?void 0:s[t.TOKEN1],v),y=U(e),h=U(i),O=N=>k=>{u(N,k)},g=N=>k=>{K(N),l(N,k)};return(0,f.jsxs)("div",{className:Oe,children:[!c&&(0,f.jsxs)("div",{className:$,children:[(0,f.jsx)(z,{focus:d===t.TOKEN0,customPanelStyle:{...G,...J(_)},currencyInfo:y,currencyField:L.INPUT,currencyAmount:r==null?void 0:r[t.TOKEN0],currencyBalance:m,onSetExactAmount:O(t.TOKEN0),onToggleIsFiatMode:()=>{},usdValue:n==null?void 0:n[t.TOKEN0],onSetPresetValue:g(t.TOKEN0),value:o==null?void 0:o[t.TOKEN0],onPressIn:()=>K(t.TOKEN0),isLoading:E}),_&&(0,f.jsx)(X,{children:_})]}),!a&&(0,f.jsxs)("div",{className:$,children:[(0,f.jsx)(z,{focus:d===t.TOKEN1,customPanelStyle:{...G,py:"$spacing16",...J(p)},currencyInfo:h,currencyField:L.INPUT,currencyAmount:r==null?void 0:r[t.TOKEN1],currencyBalance:S,onSetExactAmount:O(t.TOKEN1),onToggleIsFiatMode:()=>{},usdValue:n==null?void 0:n[t.TOKEN1],onSetPresetValue:g(t.TOKEN1),value:o==null?void 0:o[t.TOKEN1],onPressIn:()=>K(t.TOKEN1),isLoading:x}),p&&(0,f.jsx)(X,{children:p})]})]})}function Ke({params:e,deadlineInMinutes:i,...r}){const s=[Z.TradingApi,oe.tradingApiPaths.createLp,e],n=te(i),o={...e,deadline:n};return ne({queryKey:s,queryFn:async()=>{if(!e)throw{name:"Params are required"};return await pe(o)},...r})}function he({params:e,deadlineInMinutes:i,...r}){const s=[Z.TradingApi,oe.tradingApiPaths.increaseLp,e],n=te(i),o={...e,deadline:n};return ne({queryKey:s,queryFn:async()=>{if(!e)throw{name:"Params are required"};return await me(o)},...r})}M();function Je(e,i){const[r,s]=(0,T.useState)(!1),{data:n,error:o}=he({params:{...e,simulateTransaction:!1},refetchInterval:r?!1:5*ee,retry:!1,enabled:i&&(e==null?void 0:e.simulateTransaction)});return(0,T.useEffect)(()=>{s(!!o)},[o,e]),n==null?void 0:n.dependentAmount}function Xe(e,i){const[r,s]=(0,T.useState)(!1),{data:n,error:o}=Ke({params:{...e,simulateTransaction:!1},refetchInterval:r?!1:5*ee,retry:!1,enabled:i&&(e==null?void 0:e.simulateTransaction)});return(0,T.useEffect)(()=>{s(!!o)},[o,e]),n==null?void 0:n.dependentAmount}function Ye({token0:e,token1:i,dependentAmount:r,exactField:s,currencyAmounts:n,currencyAmountsUSDValue:o,formattedAmounts:u,deposit0Disabled:l,deposit1Disabled:c}){const a=r&&s===t.TOKEN1&&e?P.fromRawAmount(e,r):void 0,_=I(a),p=r&&s===t.TOKEN0&&i?P.fromRawAmount(i,r):void 0,E=I(p);return(0,T.useMemo)(()=>a?{updatedFormattedAmounts:{...u,TOKEN0:a.toExact()},updatedUSDAmounts:{...o,TOKEN0:_},updatedCurrencyAmounts:{...n,TOKEN0:a},updatedDeposit0Disabled:!a.greaterThan(0),updatedDeposit1Disabled:c}:p?{updatedFormattedAmounts:{...u,TOKEN1:p.toExact()},updatedUSDAmounts:{...o,TOKEN1:E},updatedCurrencyAmounts:{...n,TOKEN1:p},updatedDeposit0Disabled:l,updatedDeposit1Disabled:!p.greaterThan(0)}:{updatedFormattedAmounts:u,updatedUSDAmounts:o,updatedCurrencyAmounts:n,updatedDeposit0Disabled:l,updatedDeposit1Disabled:c},[a,_,p,E,n,o,u,l,c])}export{Ge as DepositInputForm,Qe as IndependentToken,Ke as useCreateLpPositionCalldataQuery,Xe as useCreatePositionDependentAmountFallback,$e as useDepositInfo,he as useIncreaseLpPositionCalldataQuery,Je as useIncreasePositionDependentAmountFallback,Ye as useUpdatedAmountsFromDependentAmount};
