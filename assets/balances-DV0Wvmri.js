import{__commonJS as kt,__toESM as Me}from"./chunk-DgAfPHQg.js";import{require_react as Tt}from"./react-CNoFhWkx.js";import{require__baseIsEqual as wt}from"./src-DOOtfpHS.js";import{isExtension as Ge}from"./index.web-BqgtOHN3.js";import{ReactQueryCacheKey as gt}from"./cache-BFZkIToX.js";import{useEnabledChains as R}from"./useEnabledChains-DuB86c95.js";import{getChromeWithThrow as St,logger as ee,useEvent as Ce}from"./hooks-BXO4d1DJ.js";import{NetworkStatus as ne,PortfolioBalancesDocument as Pt,ProtectionAttackType as Rt,ProtectionResult as It,SafetyLevel as qt,fromGraphQLChain as Ft,useApolloClient as Jt,usePortfolioBalancesQuery as xe}from"./utils-BX1Fu73x.js";import{currencyId as We,isNativeCurrencyAddress as Ct}from"./currencyId-Ci6selsx.js";import{ONE_SECOND_MS as Bt}from"./time-D_OqcZ4M.js";import{useQuery as bt,useQueryClient as Lt}from"./useQuery-D_ZCw8XG.js";import{FeatureFlags as Be,useFeatureFlag as be}from"./hooks-Bp0VtWbX.js";import{useCurrencyIdToVisibility as Le}from"./selectors-BwkayGDl.js";import{Portfolio as He,PortfolioValueModifier as Qe,SpamCode as Ee,Token as Ut,TokenReportEventType as je,Transaction as $e,buildCurrency as Ke,buildCurrencyInfo as ze,currencyIdToContractInput as At,currencyIdToRestContractInput as Dt,getCurrencySafetyInfo as Et,getRestCurrencySafetyInfo as Vt,getRestTokenSafetyInfo as Nt}from"./getCurrencySafetyInfo-BHD1ohD-.js";import{queryOptions as Ot}from"./queryOptions-P48mrm5X.js";import{MethodKind as S}from"./connect-transport-9OnIgPz5.js";import{Message as c,proto3 as r}from"./proto3-DkSQZto4.js";import{createPromiseClient as Mt}from"./promise-client-BYLTs0DC.js";import{uniswapGetTransport as Gt}from"./base-DVpWJ4NW.js";import{ProtocolVersion as Fe}from"./types_pb-yZxlo4b1.js";import{useHideSmallBalancesSetting as Xe,useHideSpamTokensSetting as Ye}from"./hooks-Dhx5teK4.js";var xt=kt({"../../node_modules/lodash/isEqual.js"(n,e){var t=wt();function o(s,a){return t(s,a)}e.exports=o}}),I;(function(n){n[n.EVM=0]="EVM",n[n.SVM=1]="SVM"})(I||(I={}));r.util.setEnumType(I,"data.v1.Platform",[{no:0,name:"EVM"},{no:1,name:"SVM"}]);var re=class b extends c{constructor(e){super(),this.requestId="",this.tokenAddress="",this.chainId=0,this.tokenName="",this.tokenSymbol="",this.imageUrl="",this.decimals=0,r.util.initPartial(e,this)}static fromBinary(e,t){return new b().fromBinary(e,t)}static fromJson(e,t){return new b().fromJson(e,t)}static fromJsonString(e,t){return new b().fromJsonString(e,t)}static equals(e,t){return r.util.equals(b,e,t)}};re.runtime=r;re.typeName="data.v1.CreatePendingTokenFactoryTokenRequest";re.fields=r.util.newFieldList(()=>[{no:1,name:"request_id",kind:"scalar",T:9},{no:2,name:"token_address",kind:"scalar",T:9},{no:3,name:"chain_id",kind:"scalar",T:13},{no:4,name:"token_name",kind:"scalar",T:9},{no:5,name:"token_symbol",kind:"scalar",T:9},{no:6,name:"image_url",kind:"scalar",T:9},{no:7,name:"decimals",kind:"scalar",T:13},{no:8,name:"description",kind:"scalar",T:9,opt:!0},{no:9,name:"website_url",kind:"scalar",T:9,opt:!0},{no:10,name:"x_url",kind:"scalar",T:9,opt:!0}]);var oe=class L extends c{constructor(e){super(),this.chainId=0,this.address="",r.util.initPartial(e,this)}static fromBinary(e,t){return new L().fromBinary(e,t)}static fromJson(e,t){return new L().fromJson(e,t)}static fromJsonString(e,t){return new L().fromJsonString(e,t)}static equals(e,t){return r.util.equals(L,e,t)}};oe.runtime=r;oe.typeName="data.v1.CreatePendingTokenFactoryTokenResponse";oe.fields=r.util.newFieldList(()=>[{no:1,name:"chain_id",kind:"scalar",T:13},{no:2,name:"address",kind:"scalar",T:9}]);var se=class U extends c{constructor(e){super(),this.requestId="",r.util.initPartial(e,this)}static fromBinary(e,t){return new U().fromBinary(e,t)}static fromJson(e,t){return new U().fromJson(e,t)}static fromJsonString(e,t){return new U().fromJsonString(e,t)}static equals(e,t){return r.util.equals(U,e,t)}};se.runtime=r;se.typeName="data.v1.SubmitTokenFactoryTokenRequest";se.fields=r.util.newFieldList(()=>[{no:1,name:"request_id",kind:"scalar",T:9}]);var ae=class A extends c{constructor(e){super(),this.chainId=0,this.address="",r.util.initPartial(e,this)}static fromBinary(e,t){return new A().fromBinary(e,t)}static fromJson(e,t){return new A().fromJson(e,t)}static fromJsonString(e,t){return new A().fromJsonString(e,t)}static equals(e,t){return r.util.equals(A,e,t)}};ae.runtime=r;ae.typeName="data.v1.SubmitTokenFactoryTokenResponse";ae.fields=r.util.newFieldList(()=>[{no:1,name:"chain_id",kind:"scalar",T:13},{no:2,name:"address",kind:"scalar",T:9}]);var ie=class D extends c{constructor(e){super(),this.platform=I.EVM,this.address="",r.util.initPartial(e,this)}static fromBinary(e,t){return new D().fromBinary(e,t)}static fromJson(e,t){return new D().fromJson(e,t)}static fromJsonString(e,t){return new D().fromJsonString(e,t)}static equals(e,t){return r.util.equals(D,e,t)}};ie.runtime=r;ie.typeName="data.v1.PlatformAddress";ie.fields=r.util.newFieldList(()=>[{no:1,name:"platform",kind:"enum",T:r.getEnumType(I)},{no:2,name:"address",kind:"scalar",T:9}]);var J=class E extends c{constructor(e){super(),this.platformAddresses=[],r.util.initPartial(e,this)}static fromBinary(e,t){return new E().fromBinary(e,t)}static fromJson(e,t){return new E().fromJson(e,t)}static fromJsonString(e,t){return new E().fromJsonString(e,t)}static equals(e,t){return r.util.equals(E,e,t)}};J.runtime=r;J.typeName="data.v1.WalletAccount";J.fields=r.util.newFieldList(()=>[{no:1,name:"platform_addresses",kind:"message",T:ie,repeated:!0}]);var ue=class V extends c{constructor(e){super(),this.chainId=0,this.address="",r.util.initPartial(e,this)}static fromBinary(e,t){return new V().fromBinary(e,t)}static fromJson(e,t){return new V().fromJson(e,t)}static fromJsonString(e,t){return new V().fromJsonString(e,t)}static equals(e,t){return r.util.equals(V,e,t)}};ue.runtime=r;ue.typeName="data.v1.GetTokenRequest";ue.fields=r.util.newFieldList(()=>[{no:1,name:"chain_id",kind:"scalar",T:13},{no:2,name:"address",kind:"scalar",T:9}]);var le=class N extends c{constructor(e){super(),r.util.initPartial(e,this)}static fromBinary(e,t){return new N().fromBinary(e,t)}static fromJson(e,t){return new N().fromJson(e,t)}static fromJsonString(e,t){return new N().fromJsonString(e,t)}static equals(e,t){return r.util.equals(N,e,t)}};le.runtime=r;le.typeName="data.v1.GetTokenResponse";le.fields=r.util.newFieldList(()=>[{no:1,name:"token",kind:"message",T:Ut}]);var ce=class O extends c{constructor(e){super(),this.chainIds=[],r.util.initPartial(e,this)}static fromBinary(e,t){return new O().fromBinary(e,t)}static fromJson(e,t){return new O().fromJson(e,t)}static fromJsonString(e,t){return new O().fromJsonString(e,t)}static equals(e,t){return r.util.equals(O,e,t)}};ce.runtime=r;ce.typeName="data.v1.GetPortfolioRequest";ce.fields=r.util.newFieldList(()=>[{no:1,name:"wallet_account",kind:"message",T:J},{no:2,name:"chain_ids",kind:"scalar",T:13,repeated:!0},{no:3,name:"modifier",kind:"message",T:Qe,opt:!0}]);var de=class M extends c{constructor(e){super(),r.util.initPartial(e,this)}static fromBinary(e,t){return new M().fromBinary(e,t)}static fromJson(e,t){return new M().fromJson(e,t)}static fromJsonString(e,t){return new M().fromJsonString(e,t)}static equals(e,t){return r.util.equals(M,e,t)}};de.runtime=r;de.typeName="data.v1.GetPortfolioResponse";de.fields=r.util.newFieldList(()=>[{no:1,name:"portfolio",kind:"message",T:He}]);var me=class G extends c{constructor(e){super(),this.walletAccounts=[],this.chainIds=[],this.modifiers=[],r.util.initPartial(e,this)}static fromBinary(e,t){return new G().fromBinary(e,t)}static fromJson(e,t){return new G().fromJson(e,t)}static fromJsonString(e,t){return new G().fromJsonString(e,t)}static equals(e,t){return r.util.equals(G,e,t)}};me.runtime=r;me.typeName="data.v1.ListPortfoliosRequest";me.fields=r.util.newFieldList(()=>[{no:1,name:"wallet_accounts",kind:"message",T:J,repeated:!0},{no:2,name:"chain_ids",kind:"scalar",T:13,repeated:!0},{no:3,name:"modifiers",kind:"message",T:Qe,repeated:!0}]);var fe=class x extends c{constructor(e){super(),this.portfolios=[],r.util.initPartial(e,this)}static fromBinary(e,t){return new x().fromBinary(e,t)}static fromJson(e,t){return new x().fromJson(e,t)}static fromJsonString(e,t){return new x().fromJsonString(e,t)}static equals(e,t){return r.util.equals(x,e,t)}};fe.runtime=r;fe.typeName="data.v1.ListPortfoliosResponse";fe.fields=r.util.newFieldList(()=>[{no:1,name:"portfolios",kind:"message",T:He,repeated:!0}]);var pe=class W extends c{constructor(e){super(),this.chainId=0,this.address="",this.event=je.UNSPECIFIED,this.details="",r.util.initPartial(e,this)}static fromBinary(e,t){return new W().fromBinary(e,t)}static fromJson(e,t){return new W().fromJson(e,t)}static fromJsonString(e,t){return new W().fromJsonString(e,t)}static equals(e,t){return r.util.equals(W,e,t)}};pe.runtime=r;pe.typeName="data.v1.SubmitReportRequest";pe.fields=r.util.newFieldList(()=>[{no:1,name:"chain_id",kind:"scalar",T:13},{no:2,name:"address",kind:"scalar",T:9},{no:3,name:"event",kind:"enum",T:r.getEnumType(je)},{no:4,name:"details",kind:"scalar",T:9}]);var he=class H extends c{constructor(e){super(),this.success=!1,r.util.initPartial(e,this)}static fromBinary(e,t){return new H().fromBinary(e,t)}static fromJson(e,t){return new H().fromJson(e,t)}static fromJsonString(e,t){return new H().fromJsonString(e,t)}static equals(e,t){return r.util.equals(H,e,t)}};he.runtime=r;he.typeName="data.v1.SubmitReportResponse";he.fields=r.util.newFieldList(()=>[{no:1,name:"success",kind:"scalar",T:8}]);var ye=class Q extends c{constructor(e){super(),this.chainId=0,this.hash="",r.util.initPartial(e,this)}static fromBinary(e,t){return new Q().fromBinary(e,t)}static fromJson(e,t){return new Q().fromJson(e,t)}static fromJsonString(e,t){return new Q().fromJsonString(e,t)}static equals(e,t){return r.util.equals(Q,e,t)}};ye.runtime=r;ye.typeName="data.v1.GetTransactionRequest";ye.fields=r.util.newFieldList(()=>[{no:1,name:"chain_id",kind:"scalar",T:13},{no:2,name:"hash",kind:"scalar",T:9},{no:3,name:"address",kind:"scalar",T:9,opt:!0}]);var ve=class j extends c{constructor(e){super(),r.util.initPartial(e,this)}static fromBinary(e,t){return new j().fromBinary(e,t)}static fromJson(e,t){return new j().fromJson(e,t)}static fromJsonString(e,t){return new j().fromJsonString(e,t)}static equals(e,t){return r.util.equals(j,e,t)}};ve.runtime=r;ve.typeName="data.v1.GetTransactionResponse";ve.fields=r.util.newFieldList(()=>[{no:1,name:"transaction",kind:"message",T:$e}]);var ke=class $ extends c{constructor(e){super(),this.chainIds=[],r.util.initPartial(e,this)}static fromBinary(e,t){return new $().fromBinary(e,t)}static fromJson(e,t){return new $().fromJson(e,t)}static fromJsonString(e,t){return new $().fromJsonString(e,t)}static equals(e,t){return r.util.equals($,e,t)}};ke.runtime=r;ke.typeName="data.v1.ListTransactionsRequest";ke.fields=r.util.newFieldList(()=>[{no:1,name:"chain_ids",kind:"scalar",T:13,repeated:!0},{no:2,name:"wallet_account",kind:"message",T:J},{no:3,name:"fiat_on_ramp_params",kind:"message",T:Te,opt:!0},{no:4,name:"page_token",kind:"scalar",T:9,opt:!0},{no:5,name:"page_size",kind:"scalar",T:13,opt:!0}]);var Te=class K extends c{constructor(e){super(),this.params={case:void 0},r.util.initPartial(e,this)}static fromBinary(e,t){return new K().fromBinary(e,t)}static fromJson(e,t){return new K().fromJson(e,t)}static fromJsonString(e,t){return new K().fromJsonString(e,t)}static equals(e,t){return r.util.equals(K,e,t)}};Te.runtime=r;Te.typeName="data.v1.FiatOnRampParams";Te.fields=r.util.newFieldList(()=>[{no:1,name:"transaction_ids",kind:"message",T:ge,oneof:"params"},{no:2,name:"auth",kind:"message",T:we,oneof:"params"}]);var we=class z extends c{constructor(e){super(),this.queryParams="",this.signature="",r.util.initPartial(e,this)}static fromBinary(e,t){return new z().fromBinary(e,t)}static fromJson(e,t){return new z().fromJson(e,t)}static fromJsonString(e,t){return new z().fromJsonString(e,t)}static equals(e,t){return r.util.equals(z,e,t)}};we.runtime=r;we.typeName="data.v1.FiatOnRampAuth";we.fields=r.util.newFieldList(()=>[{no:1,name:"query_params",kind:"scalar",T:9},{no:2,name:"signature",kind:"scalar",T:9}]);var ge=class X extends c{constructor(e){super(),this.transactionIds=[],r.util.initPartial(e,this)}static fromBinary(e,t){return new X().fromBinary(e,t)}static fromJson(e,t){return new X().fromJson(e,t)}static fromJsonString(e,t){return new X().fromJsonString(e,t)}static equals(e,t){return r.util.equals(X,e,t)}};ge.runtime=r;ge.typeName="data.v1.FiatOnRampTransactionIds";ge.fields=r.util.newFieldList(()=>[{no:1,name:"transaction_ids",kind:"scalar",T:9,repeated:!0}]);var Se=class Y extends c{constructor(e){super(),this.transactions=[],this.nextPageToken="",r.util.initPartial(e,this)}static fromBinary(e,t){return new Y().fromBinary(e,t)}static fromJson(e,t){return new Y().fromJson(e,t)}static fromJsonString(e,t){return new Y().fromJsonString(e,t)}static equals(e,t){return r.util.equals(Y,e,t)}};Se.runtime=r;Se.typeName="data.v1.ListTransactionsResponse";Se.fields=r.util.newFieldList(()=>[{no:1,name:"transactions",kind:"message",T:$e,repeated:!0},{no:2,name:"next_page_token",kind:"scalar",T:9}]);var Pe=class Z extends c{constructor(e){super(),this.fileName="",r.util.initPartial(e,this)}static fromBinary(e,t){return new Z().fromBinary(e,t)}static fromJson(e,t){return new Z().fromJson(e,t)}static fromJsonString(e,t){return new Z().fromJsonString(e,t)}static equals(e,t){return r.util.equals(Z,e,t)}};Pe.runtime=r;Pe.typeName="data.v1.CreateTokenFactoryPresignedUrlRequest";Pe.fields=r.util.newFieldList(()=>[{no:1,name:"file_name",kind:"scalar",T:9}]);var Re=class _ extends c{constructor(e){super(),this.url="",r.util.initPartial(e,this)}static fromBinary(e,t){return new _().fromBinary(e,t)}static fromJson(e,t){return new _().fromJson(e,t)}static fromJsonString(e,t){return new _().fromJsonString(e,t)}static equals(e,t){return r.util.equals(_,e,t)}};Re.runtime=r;Re.typeName="data.v1.CreateTokenFactoryPresignedUrlResponse";Re.fields=r.util.newFieldList(()=>[{no:1,name:"url",kind:"scalar",T:9}]);const Wt={typeName:"data.v1.DataApiService",methods:{createPendingTokenFactoryToken:{name:"CreatePendingTokenFactoryToken",I:re,O:oe,kind:S.Unary},submitTokenFactoryToken:{name:"SubmitTokenFactoryToken",I:se,O:ae,kind:S.Unary},getToken:{name:"GetToken",I:ue,O:le,kind:S.Unary},submitReport:{name:"SubmitReport",I:pe,O:he,kind:S.Unary},getPortfolio:{name:"GetPortfolio",I:ce,O:de,kind:S.Unary},listPortfolios:{name:"ListPortfolios",I:me,O:fe,kind:S.Unary},getTransaction:{name:"GetTransaction",I:ye,O:ve,kind:S.Unary},listTransactions:{name:"ListTransactions",I:ke,O:Se,kind:S.Unary},createTokenFactoryPresignedUrl:{name:"CreateTokenFactoryPresignedUrl",I:Pe,O:Re,kind:S.Unary}}};function An(n){if(!n)return;if(Object.values(qt).includes(n))return n;ee.warn("uniswap/data/rest/utils.ts","parseSafetyLevel",`Invalid safetyLevel from REST TokenRankings query: ${n}`)}function Dn(n){if(!n)return;let e;if(Object.values(It).includes(n.result.toUpperCase()))e=n.result.toUpperCase();else{ee.warn("uniswap/data/rest/utils.ts","parseProtectionInfo",`Invalid protectionResult from REST TokenRankings query: ${n.result}`);return}const o=Object.values(Rt),s=n.attackTypes.filter(a=>o.includes(a.toUpperCase())).map(a=>a.toUpperCase());return s.length!==n.attackTypes.length&&ee.warn("uniswap/data/rest/utils.ts","parseProtectionInfo",`Invalid attackTypes in REST TokenRankings query: ${n.attackTypes}`),{attackTypes:s,result:e}}function En(n){switch(n==null?void 0:n.toLowerCase()){case"v2":return Fe.V2;case"v3":return Fe.V3;case"v4":return Fe.V4;default:return}}function Ht({evmAddress:n,svmAddress:e}){const t=[];return n&&t.push({platform:I.EVM,address:n}),e&&t.push({platform:I.SVM,address:e}),{walletAccount:{platformAddresses:t}}}function Qt(n){if(!n)return;const{evmAddress:e,svmAddress:t,walletAccount:o,...s}=n;return{...Ht({evmAddress:e,svmAddress:t}),...s}}const jt=Mt(Wt,Gt);function Ze(n){return bt(Je(n))}const Je=({input:n,enabled:e=!0,refetchInterval:t,select:o})=>{var s;const a=Qt(n),{modifier:i,walletAccount:u,...l}=a??{},d=u==null||(s=u.platformAddresses[0])===null||s===void 0?void 0:s.address;return Ot({queryKey:[gt.GetPortfolio,d,l],queryFn:()=>a?jt.getPortfolio(a):Promise.resolve(void 0),placeholderData:m=>m,refetchInterval:t,enabled:e,subscribed:!!e,select:o})};function Ve(n){return n?[...n].sort((e,t)=>e.currencyInfo.currency.name?t.currencyInfo.currency.name?e.currencyInfo.currency.name.localeCompare(t.currencyInfo.currency.name):-1:1):[]}function _e(n){switch(n){case"success":return ne.ready;case"error":return ne.error;case"pending":return ne.loading;default:return ne.ready}}function $t(n,e){const t=n.chainId===e.chainId,o=e.isNative&&Ct(n.chainId,n.address)||e.isToken&&n.address===e.address;return t&&o}var h=Me(Tt());function Kt(){const[n,e]=(0,h.useState)(!0);return(0,h.useEffect)(()=>{if(!Ge)return;const t=St(),o=async()=>{const{focused:s}=await t.windows.getCurrent();e(s)};return o().catch(s=>{ee.error(s,{tags:{file:"useIsChromeWindowFocused.ts",function:"useIsChromeWindowFocused"}})}),t.windows.onFocusChanged.addListener(o),()=>{t.windows.onFocusChanged.removeListener(o)}},[]),n}function zt(n){const[e,t]=(0,h.useState)(!0),o=Kt();return(0,h.useEffect)(()=>{if(o){t(!0);return}const s=setTimeout(()=>t(!1),n);return()=>clearTimeout(s)},[o,n]),e}function Xt({defaultValue:n,web:e,extension:t}){const o=zt(30*Bt);return Ge?o?(t==null?void 0:t.defaultValue)??n:(t==null?void 0:t.windowNotFocused)??n:(e==null?void 0:e.defaultValue)??n}function Ie(n){return Xt({defaultValue:n,extension:{windowNotFocused:{fetchPolicy:"cache-only",pollInterval:0}}})}function Yt({evmAddress:n,...e}){const{chains:t}=R(),o=Ue(n),{pollInterval:s}=Ie({fetchPolicy:e.fetchPolicy,pollInterval:e.pollInterval}),a=Ce(f=>{var k;if(!(!(f==null||(k=f.portfolio)===null||k===void 0)&&k.balances))return;const y={};return f.portfolio.balances.forEach(p=>{const v=_t(p,n);v&&(y[v.currencyInfo.currencyId]=v)}),y}),{data:i,isFetching:u,refetch:l,error:d,status:m}=Ze({input:{evmAddress:n,chainIds:t,modifier:o},enabled:!!n&&!e.skip,refetchInterval:s,select:a});return{data:i,loading:u,networkStatus:_e(m),refetch:l,error:d||void 0}}function Zt(n){const e=(0,h.useMemo)(()=>n??[],[n]),t=Le(e),o=!Ye(),s=!Xe(),a=(0,h.useMemo)(()=>{const{includeOverrides:i,excludeOverrides:u}=Object.entries(t).reduce((l,[d,m])=>{const f=Dt(d);return m.isVisible?l.includeOverrides.push(f):l.excludeOverrides.push(f),l},{includeOverrides:[],excludeOverrides:[]});return e.map(l=>({address:l,includeOverrides:i,excludeOverrides:u,includeSmallBalances:s,includeSpamTokens:o}))},[t,e,s,o]);return a.length>0?a:void 0}function Ue(n){const e=(0,h.useMemo)(()=>n?[n]:void 0,[n]),t=Zt(e);return(t==null?void 0:t[0])??void 0}function _t(n,e){var t,o;const{token:s,amount:a,pricePercentChange1d:i,valueUsd:u,isHidden:l}=n;if(!s||!a)return;const{chainId:d,address:m,decimals:f,symbol:k,name:y,metadata:p}=s,{logoUrl:v,protectionInfo:q}=p||{},P=Ke({chainId:d,address:m,decimals:f,symbol:k,name:y,buyFeeBps:p==null||(t=p.feeData)===null||t===void 0||(t=t.feeDetector)===null||t===void 0?void 0:t.buyFeeBps,sellFeeBps:p==null||(o=p.feeData)===null||o===void 0||(o=o.feeDetector)===null||o===void 0?void 0:o.sellFeeBps});if(!P)return;const g=We(P).toLowerCase(),T=`${d}-${m.toLowerCase()}-${e}`,{isSpam:w,spamCodeValue:C,mappedSafetyLevel:te}=Nt(p),B=ze({currency:P,currencyId:g,logoUrl:v,isSpam:w,safetyInfo:Vt(te,q),spamCode:C});return tt({id:T,cacheId:`TokenBalance:${T}`,quantity:a.amount,balanceUSD:u,currencyInfo:B,relativeChange24:i,isHidden:l})}function en({balances:n,targetCurrency:e,isHidden:t}){return n.map(o=>{const s=o.token;return s&&$t(s,e)?{...o,isHidden:t}:o})}function tn({currentTotal:n,balanceValue:e,isHiding:t}){return t?n-e:n+e}const nn=n=>e=>t=>{var o;if(!t.portfolioBalance)return;const s=n.getCurrentData(e);if(!(!(s==null||(o=s.portfolio)===null||o===void 0)&&o.balances))return;const a=en({balances:s.portfolio.balances,targetCurrency:t.portfolioBalance.currencyInfo.currency,isHidden:t.hidden}),i=tn({currentTotal:s.portfolio.totalValueUsd||0,balanceValue:t.portfolioBalance.balanceUSD||0,isHiding:t.hidden});n.updateData(e,u=>({...u||s,portfolio:{...s.portfolio,balances:a,totalValueUsd:i}}))};function rn(n){const{chains:e}=R(),t=Lt(),o=Ue(n),s=(0,h.useMemo)(()=>nn({getCurrentData:i=>t.getQueryData(Je({input:i}).queryKey),updateData:(i,u)=>{t.setQueryData(Je({input:i}).queryKey,u)}})({evmAddress:n,chainIds:e,modifier:o}),[n,e,t,o]);return Ce((a,i)=>s({hidden:a,portfolioBalance:i}))}function on({address:n,pollInterval:e,fetchPolicy:t,enabled:o=!0}){const{chains:s}=R(),a=Ue(o?n:void 0),{pollInterval:i}=Ie({fetchPolicy:t,pollInterval:e}),u=Ce(y=>{if(!(y!=null&&y.portfolio))return;const p=y.portfolio;return{balanceUSD:p.totalValueUsd,percentChange:p.totalValuePercentChange1d,absoluteChangeUSD:p.totalValueAbsoluteChange1d}}),{data:l,isFetching:d,refetch:m,error:f,status:k}=Ze({input:{evmAddress:n,chainIds:s,modifier:a},enabled:!!n&&o,refetchInterval:i,select:u});return{data:l,loading:d,networkStatus:_e(k),refetch:m,error:f||void 0}}function et(n,e){const t=(0,h.useRef)();return(e||!n)&&(t.current=e),t.current}var sn=Me(xt());function an({address:n,...e}){const t=be(Be.GqlToRestBalances),o=un({address:n,...e,skip:t||e.skip}),s=Yt({evmAddress:n||"",...e,skip:!n||!t||e.skip});return t?s:o}function un({address:n,...e}){var t;const{fetchPolicy:o,pollInterval:s}=Ie({fetchPolicy:e.fetchPolicy,pollInterval:e.pollInterval}),a=nt(n),{gqlChains:i}=R(),{data:u,loading:l,networkStatus:d,refetch:m,error:f}=xe({...e,fetchPolicy:o,notifyOnNetworkStatusChange:!0,pollInterval:s,variables:n?{ownerAddress:n,valueModifiers:a,chains:i}:void 0,skip:!n||e.skip,errorPolicy:"none"}),k=et(l,f),y=u==null||(t=u.portfolios)===null||t===void 0||(t=t[0])===null||t===void 0?void 0:t.tokenBalances,p=(0,h.useMemo)(()=>{if(!y)return;const q={};return y.forEach(P=>{var g;if(!P)return;const{__typename:T,id:w,denominatedValue:C,token:te,tokenProjectMarket:B,quantity:Ae,isHidden:rt}=P;if(!Ae||!te)return;const{name:ot,address:st,chain:at,decimals:it,symbol:ut,project:lt,feeData:F,protectionInfo:ct}=te,{logoUrl:dt,isSpam:mt,safetyLevel:ft,spamCode:pt}=lt||{},ht=Ft(at),qe=Ke({chainId:ht,address:st,decimals:it,symbol:ut,name:ot,buyFeeBps:F==null?void 0:F.buyFeeBps,sellFeeBps:F==null?void 0:F.sellFeeBps});if(!qe)return;const De=We(qe),yt=ze({currency:qe,currencyId:De,logoUrl:dt,isSpam:mt,safetyInfo:Et(ft,ct),spamCode:pt}),vt=tt({id:w,cacheId:`${T}:${w}`,quantity:Ae,balanceUSD:C==null?void 0:C.value,currencyInfo:yt,relativeChange24:B==null||(g=B.relativeChange24)===null||g===void 0?void 0:g.value,isHidden:rt});q[De]=vt}),q},[y]),v=(0,h.useCallback)(()=>m({ownerAddress:n,valueModifiers:a}),[n,a,m]);return{data:p,loading:l,networkStatus:d,refetch:v,error:k}}const Ne=new Map;function tt(n){const e=Ne.get(n.cacheId);return e&&(0,sn.default)(e,n)?e:(Ne.set(n.cacheId,n),n)}function ln({address:n,pollInterval:e,fetchPolicy:t,enabled:o=!0}){var s;const{fetchPolicy:a,pollInterval:i}=Ie({fetchPolicy:t,pollInterval:e}),u=nt(n),{gqlChains:l}=R(),{data:d,loading:m,networkStatus:f,refetch:k,error:y}=xe({fetchPolicy:a,notifyOnNetworkStatusChange:!0,pollInterval:i,variables:n?{ownerAddress:n,valueModifiers:u,chains:l}:void 0,skip:!n||!o,errorPolicy:"none"}),p=et(m,y),v=d==null||(s=d.portfolios)===null||s===void 0?void 0:s[0],q=(0,h.useMemo)(()=>{var g,T,w;if(v)return{balanceUSD:(g=v.tokensTotalDenominatedValue)===null||g===void 0?void 0:g.value,percentChange:(T=v.tokensTotalDenominatedValueChange)===null||T===void 0||(T=T.percentage)===null||T===void 0?void 0:T.value,absoluteChangeUSD:(w=v.tokensTotalDenominatedValueChange)===null||w===void 0||(w=w.absolute)===null||w===void 0?void 0:w.value}},[v]),P=(0,h.useCallback)(()=>k({ownerAddress:n,valueModifiers:u}),[n,u,k]);return{data:q,loading:m,networkStatus:f,refetch:P,error:p}}function Vn({address:n,pollInterval:e,fetchPolicy:t}){const o=be(Be.GqlToRestBalances),s=ln({address:n,pollInterval:e,fetchPolicy:t,enabled:!o}),a=on({address:n,pollInterval:e,fetchPolicy:t,enabled:o});return o?a:s}function nt(n){const e=(0,h.useMemo)(()=>n?Array.isArray(n)?n:[n]:[],[n]),t=Le(e),o=Ye(),s=Xe(),a=(0,h.useMemo)(()=>{const{tokenIncludeOverrides:i,tokenExcludeOverrides:u}=Object.entries(t).reduce((l,[d,m])=>{const f=At(d);return m.isVisible?l.tokenIncludeOverrides.push(f):l.tokenExcludeOverrides.push(f),l},{tokenIncludeOverrides:[],tokenExcludeOverrides:[]});return e.map(l=>({ownerAddress:l,tokenIncludeOverrides:i,tokenExcludeOverrides:u,includeSmallBalances:!s,includeSpamTokens:!o}))},[e,t,s,o]);return a.length>0?a:void 0}function cn({balance:n,isTestnetModeEnabled:e,currencyIdToTokenVisibility:t}){if(e)return(n.currencyInfo.spamCode||Ee.LOW)>=Ee.HIGH;if(n.currencyInfo.currency.isNative){const o=t[n.currencyInfo.currencyId];return!((o!=null&&o.isVisible||!o)&&!n.isHidden)}else return!!n.isHidden}function dn({balancesById:n}){const{isTestnetModeEnabled:e}=R(),t=(0,h.useMemo)(()=>n?Object.keys(n):[],[n]),o=Le(t);return(0,h.useMemo)(()=>{if(!n)return{shownTokens:void 0,hiddenTokens:void 0};const{shown:s,hidden:a}=Object.values(n).reduce((i,u)=>(cn({balance:u,isTestnetModeEnabled:e,currencyIdToTokenVisibility:o})?i.hidden.push(u):i.shown.push(u),i),{shown:[],hidden:[]});return{shownTokens:s.length?s:void 0,hiddenTokens:a.length?a:void 0}},[n,o,e])}function Nn({address:n,pollInterval:e,onCompleted:t}){const{isTestnetModeEnabled:o}=R(),{data:s,loading:a,networkStatus:i,refetch:u}=an({address:n,pollInterval:e,onCompleted:t,fetchPolicy:"cache-and-network"}),{shownTokens:l,hiddenTokens:d}=dn({balancesById:s});return{data:{balances:Oe({balances:l||[],isTestnetModeEnabled:o}),hiddenBalances:Oe({balances:d||[],isTestnetModeEnabled:o})},loading:a,networkStatus:i,refetch:u}}function Oe({balances:n,isTestnetModeEnabled:e}){if(e){const s=n.filter(i=>i.currencyInfo.currency.isNative).sort((i,u)=>u.quantity-i.quantity),a=Ve(n.filter(i=>!i.currencyInfo.currency.isNative));return[...s,...a]}const t=n.filter(s=>s.balanceUSD),o=n.filter(s=>!s.balanceUSD);return[...t.sort((s,a)=>s.balanceUSD?a.balanceUSD?a.balanceUSD-s.balanceUSD:-1:1),...Ve(o)]}function On(n){const e=be(Be.GqlToRestBalances),t=rn(n),o=mn(n);return e?t:o}function mn(n){const e=Jt(),{gqlChains:t}=R();return(0,h.useCallback)((s,a)=>{var i;if(!a)return;const u=(i=e.readQuery({query:Pt,variables:{ownerAddress:n,chains:t}}))===null||i===void 0||(i=i.portfolios)===null||i===void 0?void 0:i[0];u&&(e.cache.modify({id:a.cacheId,fields:{isHidden(){return s}}}),e.cache.modify({id:e.cache.identify(u),fields:{tokensTotalDenominatedValue(l,{isReference:d}){if(d(l))return ee.error(new Error("Unable to modify cache for `tokensTotalDenominatedValue`"),{tags:{file:"balances.ts",function:"usePortfolioCacheUpdater"},extra:{portfolioId:e.cache.identify(u)}}),l;const m=a.balanceUSD?s?l.value-a.balanceUSD:l.value+a.balanceUSD:l.value;return{...l,value:m}}}}))},[e,n,t])}export{Dn as parseProtectionInfo,En as parseRestProtocolVersion,An as parseSafetyLevel,xt as require_isEqual,Oe as sortPortfolioBalances,et as usePersistedError,an as usePortfolioBalances,On as usePortfolioCacheUpdater,Vn as usePortfolioTotalValue,nt as usePortfolioValueModifiers,Nn as useSortedPortfolioBalances,dn as useTokenBalancesGroupedByVisibility};
