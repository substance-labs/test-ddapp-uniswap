import{__toESM as se}from"./chunk-DgAfPHQg.js";import{require_react as _e}from"./react-CNoFhWkx.js";import{useSporeColors as je}from"./src-DOOtfpHS.js";import{useTranslation as q}from"./useTranslation-BotBuoJf.js";import{require_jsx_runtime as Ve}from"./jsx-runtime-D7bMTQeG.js";import{useEnabledChains as ye}from"./useEnabledChains-DuB86c95.js";import{BIPS_BASE as Te,ProtocolVersion as Y,UniverseChainId as Se}from"./utils-BX1Fu73x.js";import{buildCurrencyId as ee,getNativeAddress as oe}from"./currencyId-Ci6selsx.js";import{ElementName as be}from"./element-Wnp4RkdY.js";import{ModalName as Ae}from"./modal-Dvm06CN4.js";import{FeatureFlags as Pe,useFeatureFlag as De}from"./hooks-Bp0VtWbX.js";import{UNI as ke}from"./objects-DlLkJwrJ.js";import{uniswapUrls as Ie}from"./urls-kwiZbYPW.js";import{ProtocolVersion as T}from"./types_pb-yZxlo4b1.js";import{NumberType as C}from"./types-JuyYLR0O.js";import{useLocalizationContext as ae}from"./LocalizationContext-B31peW1_.js";import{atom as $e,atomWithReset as ce,useAtom as de,useAtomValue as b,useResetAtom as re,useUpdateAtom as Ee}from"./utils-CDaPKk14.js";import{Flex as Ce,Text as $,styled as Fe,useMedia as ue}from"./Loader-D83W8G1W.js";import{PoolSortFields as l,exploreSearchStringAtom as Le}from"./state-DRfrbe8S.js";import{useCurrencyInfo as te}from"./useCurrencyInfo-Bxa3J04d.js";import{getChainUrlParam as Me}from"./chainParams-DIOvplzi.js";import{OrderDirection as F,gqlToCurrency as le,supportedChainIdFromGQLChain as Oe,unwrapToken as ie}from"./util-BZ6kLG7e.js";import{check_default as ze}from"./check-8ct4mC1b.js";import{Trace_default as Re}from"./Trace-DgHN3Ak9.js";import{LearnMoreLink as we}from"./LearnMoreLink-CrJtGK7U.js";import{TABLE_PAGE_SIZE as Ne,giveExploreStatDefaultValue as W}from"./explore-CL40v3_c.js";import{PortfolioLogo as He}from"./PortfolioLogo-C-reBpb6.js";import{CurrencyLogo as Ue}from"./CurrencyLogo-CvvmRzOI.js";import{MouseoverTooltip as me,TooltipSize as pe}from"./Tooltip-DPNhKWF2.js";import{Cell as x,ClickableHeaderRow as Be,EllipsisText as We,HeaderArrow as qe,HeaderCell as g,HeaderSortText as Ge,MAX_WIDTH_MEDIA_BREAKPOINT as Qe,Table as Xe,TableText as h,createColumnHelper as Ke,useSimplePagination_default as Ze}from"./Filter-Bbh2t7To.js";import{getProtocolVersionLabel as ne}from"./protocolVersion-Djp_Gxjw.js";import{LPIncentiveFeeStatTooltip_default as Je}from"./LPIncentiveFeeStatTooltip-CknsSvzz.js";import{isDynamicFeeTier as Ye}from"./feeTiers-D9BvLkmt.js";import{DropdownSelector as eo,InternalMenuItem as oo}from"./DropdownSelector-CYN_6AdC.js";import{useExploreContextTopPools as ro}from"./topPools-49_ZkMXb.js";var j=se(_e()),e=se(Ve());const to="  _display-flex _alignItems-stretch _flexBasis-auto _boxSizing-border-box _position-relative _minHeight-0px _minWidth-0px _flexShrink-0 _flexDirection-column ",ve=$e(T.UNSPECIFIED),lo=[T.UNSPECIFIED,T.V4,T.V3,T.V2];function io(){const{t:n}=q(),a=je(),[c,d]=(0,j.useState)(!1),[s,u]=de(ve),i=ue(),f=(0,j.useCallback)(m=>{u(m),d(!1)},[u]),p=(0,j.useMemo)(()=>lo.map(m=>(0,e.jsxs)(oo,{onPress:()=>f(m),children:[m===T.UNSPECIFIED?n("common.all"):ne(m),s===m&&(0,e.jsx)(ze,{size:16,color:a.accent1.val})]},`ExplorePools-version-${m}`)),[s,f,a,n]);return(0,e.jsx)("div",{className:to,children:(0,e.jsx)(Re,{modal:Ae.ExploreProtocolFilter,children:(0,e.jsx)(eo,{isOpen:c,toggleOpen:()=>d(m=>!m),menuLabel:(0,e.jsx)($,{variant:"buttonLabel3",width:"max-content",children:s===T.UNSPECIFIED?n("common.protocol"):ne(s)}),dropdownStyle:{width:160},buttonStyle:{height:40,width:"max-content"},allowFlip:!0,alignRight:!i.lg,children:p})})})}var Zo=io;const no="  _display-flex _alignItems-stretch _flexBasis-auto _boxSizing-border-box _position-relative _minHeight-0px _minWidth-0px _flexShrink-0 _flexDirection-column _width-10037 ",so="  _display-flex _flexBasis-auto _boxSizing-border-box _position-relative _minHeight-0px _minWidth-0px _flexShrink-0 _flexDirection-row _gap-t-space-gap56 _alignItems-center _maxWidth-10037 ",ao=Fe(Ce,{m:"0 auto",maxWidth:Qe});function co({token0:n,token1:a,chainId:c}){const d=[n?le(n):void 0,a?le(a):void 0];return(0,e.jsxs)("div",{className:so,children:[(0,e.jsx)(He,{currencies:d,chainId:c,size:24}),(0,e.jsxs)(We,{children:[n==null?void 0:n.symbol,"/",a==null?void 0:a.symbol]})]})}const L=ce(l.TVL),M=ce(!1);function uo(n){const[a,c]=de(L),d=Ee(M);return(0,j.useCallback)(()=>{a===n?d(s=>!s):(c(n),d(!1))},[a,c,d,n])}function S({category:n,isCurrentSortMethod:a,direction:c}){const d=uo(n),{t:s}=q(),u={[l.TVL]:s("stats.tvl"),[l.Volume24h]:s("stats.volume.1d"),[l.Volume30D]:s("pool.volume.thirtyDay"),[l.VolOverTvl]:void 0,[l.Apr]:s("pool.apr.description"),[l.RewardApr]:(0,e.jsxs)(e.Fragment,{children:[s("pool.incentives.merklDocs"),(0,e.jsx)(we,{textVariant:"buttonLabel4",url:Ie.merklDocsUrl})]})},i={[l.TVL]:s("common.totalValueLocked"),[l.Volume24h]:s("stats.volume.1d.short"),[l.Volume30D]:s("pool.volume.thirtyDay.short"),[l.Apr]:s("pool.aprText"),[l.VolOverTvl]:s("pool.volOverTvl"),[l.RewardApr]:s("pool.apr.reward")};return(0,e.jsx)("div",{className:no,children:(0,e.jsx)(me,{disabled:!u[n],size:pe.Small,text:u[n],placement:"top",children:(0,e.jsxs)(Be,{justifyContent:"flex-end",onPress:d,group:!0,children:[(0,e.jsx)(qe,{orderDirection:c,size:14,opacity:a?1:0}),(0,e.jsx)(Ge,{active:a,variant:"body3",children:i[n]})]})})})}const Jo=(0,j.memo)(function(){const a=b(L),c=b(M),d=b(ve),s=re(L),u=re(M);(0,j.useEffect)(()=>{s(),u()},[u,s]);const{topPools:i,isLoading:f,isError:p}=ro({sortBy:a,sortDirection:c?F.Asc:F.Desc},d);return(0,e.jsx)(mo,{topPoolData:{topPools:i,isLoading:f,isError:p}})}),mo=(0,j.memo)(function({topPoolData:a,pageSize:c=Ne,staticSize:d=!1,forcePinning:s=!1}){const{topPools:u,isLoading:i,isError:f}=a,{page:p,loadMore:m}=Ze();return(0,e.jsx)(ao,{"data-testid":"top-pools-explore-table",children:(0,e.jsx)(po,{pools:u==null?void 0:u.slice(0,p*c),loading:i,error:f,loadMore:d?void 0:m,maxWidth:1200,forcePinning:s,maxHeight:d?1e3:void 0})})});function po({pools:n,loading:a,error:c,loadMore:d,maxWidth:s,maxHeight:u,hiddenColumns:i,forcePinning:f}){const{formatPercent:p,formatNumberOrString:m,convertFiatAmountFormatted:E}=ae(),V=b(M)?F.Asc:F.Desc,y=b(L),G=b(Le),{defaultChainId:Q}=ye(),{t:A}=q(),X=De(Pe.LpIncentives),xe=(0,j.useMemo)(()=>(n==null?void 0:n.map((t,z)=>{var o,r,P,D,k,R,w,N,H,U,B;const K=z+1,I="hash"in t,_=Oe((o=t.token0)===null||o===void 0?void 0:o.chain)??Q,Z=((r=t.token0)===null||r===void 0?void 0:r.address)||oe(_),J=((P=t.token1)===null||P===void 0?void 0:P.address)||oe(_),fe=t.protocolVersion===Y.V4&&Z?ee(_,Z):void 0,ge=t.protocolVersion===Y.V4&&J?ee(_,J):void 0;return{index:K,poolDescription:(0,e.jsx)(co,{token0:ie(_,t.token0),token1:ie(_,t.token1),chainId:_}),protocolVersion:(D=t.protocolVersion)===null||D===void 0?void 0:D.toLowerCase(),feeTier:t.feeTier,tvl:I?t.tvl:W((k=t.totalLiquidity)===null||k===void 0?void 0:k.value),volume24h:I?t.volume24h:W((R=t.volume1Day)===null||R===void 0?void 0:R.value),volume30d:I?t.volume30d:W((w=t.volume30Day)===null||w===void 0?void 0:w.value),volOverTvl:t.volOverTvl,apr:t.apr,rewardApr:t.boostedApr,link:`/explore/pools/${Me(_)}/${I?t.hash:t.id}`,token0CurrencyId:fe,token1CurrencyId:ge,analytics:{elementName:be.PoolsTableRow,properties:{chain_id:_,pool_address:I?t.hash:t.id,token0_address:(N=t.token0)===null||N===void 0?void 0:N.address,token0_symbol:(H=t.token0)===null||H===void 0?void 0:H.symbol,token1_address:(U=t.token1)===null||U===void 0?void 0:U.address,token1_symbol:(B=t.token1)===null||B===void 0?void 0:B.symbol,pool_list_index:z,pool_list_rank:K,pool_list_length:n.length,search_pool_input:G}}}}))??[],[Q,G,n]),v=a||!!c,O=ue(),he=(0,j.useMemo)(()=>{const t=Ke();return[O.lg?null:t.accessor(o=>o.index,{id:"index",size:60,header:()=>(0,e.jsx)(g,{justifyContent:"flex-start",children:(0,e.jsx)($,{variant:"body3",color:"$neutral2",children:"#"})}),cell:o=>{var r;return(0,e.jsx)(x,{justifyContent:"flex-start",loading:v,children:(0,e.jsx)(h,{children:(r=o.getValue)===null||r===void 0?void 0:r.call(o)})})}}),t.accessor(o=>o.poolDescription,{id:"poolDescription",size:O.lg?170:180,header:()=>(0,e.jsx)(g,{justifyContent:"flex-start",children:(0,e.jsx)($,{variant:"body3",color:"$neutral2",children:A("common.pool")})}),cell:o=>{var r;return(0,e.jsx)(x,{justifyContent:"flex-start",loading:v,children:(r=o.getValue)===null||r===void 0?void 0:r.call(o)})}}),t.accessor(o=>o.protocolVersion,{id:"protocolVersion",size:80,header:()=>(0,e.jsx)(g,{justifyContent:"flex-end",children:(0,e.jsx)($,{variant:"body3",color:"$neutral2",children:A("common.protocol")})}),cell:o=>{var r;return(0,e.jsx)(x,{justifyContent:"flex-end",loading:v,children:(0,e.jsx)(h,{children:((r=o.getValue)===null||r===void 0?void 0:r.call(o))??"-"})})}}),t.accessor(o=>o.feeTier,{id:"feeTier",size:80,header:()=>(0,e.jsx)(g,{children:(0,e.jsx)($,{variant:"body3",color:"$neutral2",children:A("fee.tier")})}),cell:o=>{var r;return(0,e.jsx)(x,{loading:v,children:(0,e.jsx)(h,{children:!((r=o.getValue)===null||r===void 0)&&r.call(o)?`${Ye(o.getValue())?A("common.dynamic"):p(o.getValue().feeAmount/Te,4)}`:"-"})})}}),i!=null&&i.includes(l.TVL)?null:t.accessor(o=>o.tvl,{id:"tvl",size:110,header:()=>(0,e.jsx)(g,{children:(0,e.jsx)(S,{category:l.TVL,isCurrentSortMethod:y===l.TVL,direction:V})}),cell:o=>{var r;return(0,e.jsx)(x,{loading:v,children:(0,e.jsx)(h,{children:E((r=o.getValue)===null||r===void 0?void 0:r.call(o),C.FiatTokenStats)})})}}),i!=null&&i.includes(l.Apr)?null:t.accessor(o=>o.apr,{id:"apr",size:120,header:()=>(0,e.jsx)(g,{children:(0,e.jsx)(S,{category:l.Apr,isCurrentSortMethod:y===l.Apr,direction:V})}),cell:o=>{var r;return(0,e.jsx)(x,{loading:v,children:(0,e.jsx)(h,{children:p((r=o.getValue)===null||r===void 0||(r=r.call(o))===null||r===void 0?void 0:r.toSignificant())})})}}),!(i!=null&&i.includes(l.RewardApr))&&X?t.accessor(o=>o.rewardApr,{id:l.RewardApr,size:130,header:()=>(0,e.jsx)(g,{children:(0,e.jsx)(S,{category:l.RewardApr,isCurrentSortMethod:y===l.RewardApr,direction:V})}),sortingFn:"basic",cell:({row:o})=>{if(!(o!=null&&o.original))return null;const{apr:r,token0CurrencyId:P,token1CurrencyId:D,rewardApr:k}=o.original;return(0,e.jsx)(vo,{apr:r,rewardApr:k,token0CurrencyId:P,token1CurrencyId:D,isLoading:v})}}):null,i!=null&&i.includes(l.Volume24h)?null:t.accessor(o=>o.volume24h,{id:"volume24h",size:120,header:()=>(0,e.jsx)(g,{children:(0,e.jsx)(S,{category:l.Volume24h,isCurrentSortMethod:y===l.Volume24h,direction:V})}),cell:o=>{var r;return(0,e.jsx)(x,{loading:v,children:(0,e.jsx)(h,{children:E(o==null||(r=o.getValue)===null||r===void 0?void 0:r.call(o),C.FiatTokenStats)})})}}),i!=null&&i.includes(l.Volume30D)?null:t.accessor(o=>o.volume30d,{id:"volume30Day",size:120,header:()=>(0,e.jsx)(g,{children:(0,e.jsx)(S,{category:l.Volume30D,isCurrentSortMethod:y===l.Volume30D,direction:V})}),cell:o=>{var r;return(0,e.jsx)(x,{loading:v,children:(0,e.jsx)(h,{children:E((r=o.getValue)===null||r===void 0?void 0:r.call(o),C.FiatTokenStats)})})}}),i!=null&&i.includes(l.VolOverTvl)?null:t.accessor(o=>o.volOverTvl,{id:"volOverTvl",size:120,header:()=>(0,e.jsx)(g,{children:(0,e.jsx)(S,{category:l.VolOverTvl,isCurrentSortMethod:y===l.VolOverTvl,direction:V})}),cell:o=>{var r;return(0,e.jsx)(x,{loading:v,children:(0,e.jsx)(h,{children:m({value:(r=o.getValue)===null||r===void 0?void 0:r.call(o),type:C.TokenQuantityStats,placeholder:"-"})})})}})].filter(o=>!!o)},[O.lg,i,X,v,A,y,V,m,p,E]);return(0,e.jsx)(Xe,{columns:he,data:xe,loading:a,error:c,loadMore:d,maxWidth:s,maxHeight:u,defaultPinnedColumns:["index","poolDescription"],forcePinning:f})}function vo({apr:n,isLoading:a,rewardApr:c,token0CurrencyId:d,token1CurrencyId:s}){const{formatPercent:u}=ae(),i=te(d),f=te(s),p=parseFloat(n.toFixed(2)),m=p+(c??0);return c?(0,e.jsx)(me,{padding:0,text:(0,e.jsx)(Je,{currency0Info:i,currency1Info:f,poolApr:p,lpIncentiveRewardApr:c,totalApr:m}),size:pe.Small,placement:"top",children:(0,e.jsxs)(x,{loading:a,gap:"$spacing2",children:[(0,e.jsx)(h,{color:"$neutral3",children:"+"}),(0,e.jsx)(h,{color:"$accent1",mr:"$spacing4",children:u(c)}),(0,e.jsx)(Ue,{currency:ke[Se.Mainnet],size:16})]})}):(0,e.jsx)(x,{loading:a,gap:"$spacing2",children:(0,e.jsx)(h,{color:"$neutral3",children:"-"})})}export{Jo as ExploreTopPoolTable,po as PoolsTable,Zo as ProtocolFilter_default,M as sortAscendingAtom,L as sortMethodAtom};
