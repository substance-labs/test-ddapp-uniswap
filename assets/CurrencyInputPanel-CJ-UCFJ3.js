import{__toESM as Ne}from"./chunk-DgAfPHQg.js";import{require_react as ft}from"./react-CNoFhWkx.js";import{Button as ht,Easing as Se,PRESS_SCALE as gt,RotatableChevron as vt,ScrollView as xt,Tooltip as X,TouchableArea as R,getContrastPassingTextColor as _t,getHoverCssFilter as St,init_module as Ue,spacing as W,useAnimatedStyle as De,useIsDarkMode as It,useIsShortMobileDevice as bt,useSharedValue as Re,useSporeColors as yt,validColor as Tt,withRepeat as Ct,withSequence as Pt,withTiming as Ie}from"./src-DOOtfpHS.js";import{useTranslation as J}from"./useTranslation-BotBuoJf.js";import{isExtension as Le,isHoverable as F,isInterface as At,isInterfaceDesktop as U,isMobileWeb as pe,isWeb as V}from"./index.web-BqgtOHN3.js";import{useDispatch as wt}from"./es-Iwj7vF3u.js";import{require_jsx_runtime as Mt}from"./jsx-runtime-D7bMTQeG.js";import{useEnabledChains as kt}from"./useEnabledChains-DuB86c95.js";import{logger as Ft,useEvent as Y,usePrevious as $t}from"./hooks-BXO4d1DJ.js";import{DEFAULT_NATIVE_ADDRESS_LEGACY as jt,UniverseChainId as S,init_jsbi as ze,jsbi_default as C}from"./utils-BX1Fu73x.js";import{areAddressesEqual as Et,areCurrencyIdsEqual as be,currencyAddress as ye,currencyId as B}from"./currencyId-Ci6selsx.js";import{ONE_SECOND_MS as Ge}from"./time-D_OqcZ4M.js";import{SwapEventName as Ot}from"./features-yACC1hVw.js";import{ElementName as K}from"./element-Wnp4RkdY.js";import{ModalName as Nt}from"./modal-Dvm06CN4.js";import{UniswapEventName as Ut}from"./uniswap-Bm-6KILn.js";import{useQueryClient as Dt}from"./useQuery-D_ZCw8XG.js";import{ValueType as He,getCurrencyAmount as Be}from"./getCurrencyAmount-vvZpAzIm.js";import{getSymbolDisplayText as Q}from"./currency-DIOEzjz2.js";import{DynamicConfigs as We,SwapConfigKey as w}from"./configs-B4dDdw82.js";import{useDynamicConfigValue as Ve}from"./hooks-Bp0VtWbX.js";import{sendAnalyticsEvent as Ye}from"./send.web-CrSXW2rw.js";import{MAX_FIAT_INPUT_DECIMALS as Rt,SwapEventType as Te,getTokenAddressFromChainForTradingApi as Ce,timestampTracker as Pe,toTradingApiSupportedChainId as Ae,tradingApiToUniverseChainId as we}from"./TradingApiClient-Cp_0ez5S.js";import{useUSDCPrice as Lt}from"./useUSDCPrice-HO7Wgroz.js";import{TransactionType as zt}from"./transactionDetails-BsNW_jus.js";import{NumberType as ce}from"./types-JuyYLR0O.js";import{useAppFiatCurrencyInfo as ee,useLocalizationContext as te}from"./LocalizationContext-B31peW1_.js";import{WarningSeverity as Gt}from"./getAlertColor-J5DrJWHv.js";import{CurrencyField as f}from"./currency-xm5i4cH7.js";import{useWallet as me}from"./useWallet-CL5owP9P.js";import{useTrace as qe}from"./TraceContext-Ddfk7zjz.js";import{noop as Xe}from"./noop-BDbB2pLB.js";import{getRateToDisplay as Ht}from"./AccountDetails-pkaz6EG4.js";import{Flex as D,Text as $,concatClassName as fe,fonts as Bt,iconSizes as Z}from"./Loader-D83W8G1W.js";import{errorShakeAnimation as Wt}from"./getTradeSettingsDeadline-B3uZN4NF.js";import{AnimatedFlex as Me}from"./AnimatedFlex-BgzbJK30.js";import{useSwapFormStore as Vt,useSwapFormStoreDerivedSwapInfo as Ke}from"./useSwapFormStore-D1oVGbBf.js";import{pushNotification as Yt}from"./slice-Crjw990S.js";import{CurrencyLogo as ke,TokenLogo as qt}from"./TokenLogo-JlSSDr3Q.js";import{TestID as G}from"./testIDs-CxYpwoP6.js";import{getSwappableTokensQueryData as Fe,useCommonTokensOptionsWithFallback as Xt,useTokenProjects as $e}from"./useCommonTokensOptionsWithFallback-7qZUIHia.js";import{Trace_default as Qe}from"./Trace-DgHN3Ak9.js";import{WarningModal as Kt}from"./WarningModal-f8Gfhd_G.js";import{InfoTooltip as Qt}from"./InfoTooltip.web-CkgGEmd3.js";import{AssetType as je,usePriceUXEnabled as Ze}from"./assets-D-uPpcBZ.js";import{AppNotificationType as Zt}from"./types-Ds0gKmju.js";import{dismissNativeKeyboard as Jt}from"./dismissNativeKeyboard.web-99F1bxCR.js";import{TextInput as Je}from"./TextInput-3sqL_9ZJ.js";import{useDynamicFontSizing as en}from"./useDynamicFontSizing-DOxjEhTh.js";var l=Ne(ft());Ue();const tn=()=>{const e=Re(0),t=De(()=>({transform:[{translateX:e.value}]}),[e.value]),n=Y(()=>{e.value=Wt(e)});return(0,l.useMemo)(()=>({shakeStyle:t,triggerShakeAnimation:n}),[t,n])};var a=Ne(Mt());let yi=(function(e){return e.Form="Form",e.Review="Review",e.UnichainInstantBalance="UnichainInstantBalance",e})({});const et=(0,l.createContext)(void 0);function Ti({children:e,renderBiometricsIcon:t,authTrigger:n,bottomSheetViewStyles:r,onClose:i,onCurrencyChange:o,openWalletRestoreModal:s,walletNeedsRestore:c,screen:u,setScreen:d,swapRedirectCallback:p,passkeyAuthStatus:h}){const v=(0,l.useMemo)(()=>({renderBiometricsIcon:t,authTrigger:n,bottomSheetViewStyles:r,onClose:i,onCurrencyChange:o,openWalletRestoreModal:s,screen:u,setScreen:d,swapRedirectCallback:p,walletNeedsRestore:c,passkeyAuthStatus:h}),[t,n,r,i,o,s,u,d,p,c,h]);return(0,a.jsx)(et.Provider,{value:v,children:e})}const nn=()=>{const e=(0,l.useContext)(et);if(e===void 0)throw new Error("`useTransactionModalContext` must be used inside of `TransactionModalContextProvider`");return e},tt=[1,40,80,120,160,200,240],on=1,nt=e=>`200msDelayed${e}ms`,Ci={...tt.reduce((e,t)=>(e[nt(t)]={type:"spring",stiff:150,damping:30,delay:t,duration:200},e),{})},ot=e=>nt(tt[e]||on),rn=100,Ee=[25,50,75,100];function ue(e){return e===rn||e==="max"}ze();const sn=18,an=sn-4;function cn({currencyAmount:e,txType:t,isExtraTx:n=!1}){const r=un(e==null?void 0:e.currency.chainId,t),i=gn();if(!e||!r)return;const o=C.divide(C.multiply(r,C.BigInt(n?i:100)),C.BigInt(100));if(!e.currency.isNative)return e;const s=C.greaterThan(e.quotient,o)?C.subtract(e.quotient,o).toString():"0";return Be({value:s,valueType:He.Raw,currency:e.currency})}function un(e,t){const n=ln(t),r=dn(t),i=pn(t),o=mn(t),s=fn(t),c=hn(t);if(e)switch(e){case S.Mainnet:return n;case S.Sepolia:return n;case S.Polygon:return r;case S.Avalanche:return i;case S.Celo:return o;case S.MonadTestnet:return s;case S.ArbitrumOne:case S.Optimism:case S.Base:case S.Bnb:case S.Blast:case S.WorldChain:case S.Zora:case S.Zksync:case S.Unichain:case S.UnichainSepolia:case S.Soneium:case S.Solana:return c;default:return Ft.error(new Error("unhandled chain when getting min gas amount"),{tags:{file:"useMaxAmountSpend.ts",function:"getMinAmount"}}),c}}function ln(e){return H(j(e)?w.EthSendMinGasAmount:w.EthSwapMinGasAmount,j(e)?20:150)}function dn(e){return H(j(e)?w.PolygonSendMinGasAmount:w.PolygonSwapMinGasAmount,j(e)?75:600)}function pn(e){return H(j(e)?w.AvalancheSendMinGasAmount:w.AvalancheSwapMinGasAmount,j(e)?25:200)}function mn(e){return H(j(e)?w.CeloSendMinGasAmount:w.CeloSwapMinGasAmount,j(e)?13:2e3)}function fn(e){return H(j(e)?w.MonSendMinGasAmount:w.MonSwapMinGasAmount,j(e)?20:150)}function hn(e){return H(j(e)?w.GenericL2SendMinGasAmount:w.GenericL2SwapMinGasAmount,j(e)?1:8)}function gn(){return Ve({config:We.Swap,key:w.LowBalanceWarningGasPercentage,defaultValue:100})}function H(e,t){const n=Ve({config:We.Swap,key:e,defaultValue:t});return C.multiply(C.exponentiate(C.BigInt(10),C.BigInt(an)),C.BigInt(n))}function j(e){return e===zt.Send}function vn({isMax:e,children:t,isModalOpen:n,isTooltipEnabled:r,currencySymbol:i,onClose:o}){const{t:s}=J();return V?r?(0,a.jsx)(Qt,{text:(0,a.jsx)($,{variant:"body4",textAlign:"left",color:"$neutral2",children:e?s("transaction.networkCost.maxNativeBalance.description"):s("swap.warning.insufficientGas.button",{currencySymbol:i||""})}),placement:"top",trigger:t}):(0,a.jsx)(a.Fragment,{children:t}):(0,a.jsxs)(a.Fragment,{children:[t,(0,a.jsx)(Kt,{caption:s("transaction.networkCost.maxNativeBalance.description"),isOpen:n,modalName:Nt.NativeBalanceInfo,severity:Gt.Low,title:s("transaction.networkCost.maxNativeBalance.title"),rejectText:s("common.button.close"),onClose:o,onReject:o})]})}ze();function xn({currency:e,rawBalanceAmount:t,percent:n,rawMaxAmount:r}){if(!t)return;const i=C.divide(C.multiply(t,C.BigInt(n)),C.BigInt(100)),o=C.GT(i,r)?r:i;return Be({value:(o==null?void 0:o.toString())??"0",valueType:He.Raw,currency:e})}function it({currencyAmount:e,currencyBalance:t,percentage:n,elementName:r,onSetPresetValue:i,currencyField:o,transactionType:s,buttonProps:c}){const u=!!(t!=null&&t.currency.isNative),[d,p]=(0,l.useState)(!1),h=cn({currencyAmount:t,txType:s}),v=(0,l.useMemo)(()=>ue(n)?h:xn({currency:t==null?void 0:t.currency,rawBalanceAmount:t==null?void 0:t.quotient,percent:n,rawMaxAmount:h==null?void 0:h.quotient}),[t==null?void 0:t.currency,t==null?void 0:t.quotient,n,h]),m=!v||!v.greaterThan(0)||ue(n)&&(e==null?void 0:e.toExact())===v.toExact(),g=(0,l.useRef)(v);g.current=v;const P=Y(_=>{_.stopPropagation(),g.current&&i(g.current.toExact(),n)}),A=Y(_=>{_.stopPropagation(),u&&p(!0)});return(0,a.jsx)(_n,{percentage:n,isShowingMaxNativeBalanceModal:d,disabled:m,currencyField:o,elementName:r,isNativeAsset:u,currencySymbol:t==null?void 0:t.currency.symbol,setIsShowingMaxNativeBalanceModal:p,...c,onPress:P,onDisabledPress:A})}const _n=(0,l.memo)(function({percentage:t,disabled:n,onPress:r,onDisabledPress:i,currencyField:o,isShowingMaxNativeBalanceModal:s,isNativeAsset:c,currencySymbol:u,elementName:d,setIsShowingMaxNativeBalanceModal:p,size:h="xxsmall",variant:v="branded",emphasis:m="secondary",fill:g=!1,...P}){const{t:A}=J(),_=(0,l.useCallback)(()=>{p(!1)},[p]),I=ue(t);return(0,a.jsx)(vn,{isMax:I,isModalOpen:s,isTooltipEnabled:c&&n,currencySymbol:u,onClose:_,children:(0,a.jsx)(Qe,{logPress:!0,element:d??(o===f.INPUT?K.SetPercentageInput:K.SetPercentageOutput),properties:{percentage:t},children:(0,a.jsx)(ht,{fill:g,variant:v,emphasis:m,size:h,isDisabled:n,testID:o===f.INPUT?G.SetMaxInput:G.SetMaxOutput,borderColor:"$surface3",pressStyle:{scale:.99},hoverStyle:{scale:1.02},onPress:r,onDisabledPress:i,...P,children:I?A("swap.button.max"):`${t}%`})})})});function rt({hoverLtr:e,currencyAmount:t,currencyBalance:n,transactionType:r,buttonProps:i,onSetPresetValue:o,...s}){return(0,a.jsx)(D,{row:!0,gap:"$gap4",...F?{opacity:0,transform:[{translateY:-4}],"$group-hover":{opacity:1,transform:[{translateY:0}]}}:{},animation:"100ms",...s,children:Ee.map((c,u)=>(0,a.jsx)(D,{grow:!0,...F?{opacity:0,transform:[{translateY:-4},{scale:.95}],"$group-hover":{opacity:1,transform:[{translateY:0}],scale:1},animation:ot(e?u:Ee.length-u-1)}:{},children:(0,a.jsx)(it,{percentage:c,currencyAmount:t,currencyBalance:n,currencyField:f.INPUT,transactionType:r,elementName:K.PresetPercentage,buttonProps:{...i,variant:"default",py:"$spacing4"},onSetPresetValue:o})},c))})}function Sn({currencyBalance:e,currencyInfo:t,currencyField:n,showInsufficientBalanceWarning:r}){const{formatCurrencyAmount:i}=te(),o=me().evmAccount,c=n===f.OUTPUT&&(e==null?void 0:e.equalTo(0))||!o;return!t||c?null:(0,a.jsxs)($,{color:r?"$statusCritical":"$neutral2",variant:"body3",children:[i({value:e,type:ce.TokenTx})," ",Q(t.currency.symbol)]})}const In=U?5:4,st=1.1,at=U?Z.icon20:Z.icon24,bn=F?Math.ceil(at*(st-1)):0;function yn({currencyField:e}){const{page:t}=qe();return(0,l.useCallback)(({position:n,suggestion_count:r,currencyInfo:i})=>{Ye(Ut.TokenSelected,{name:i.currency.name,address:i.currency.isToken?i.currency.address:jt,chain:i.currency.chainId,page:t,field:e,position:n,suggestion_count:r,preselect_asset:!0})},[t,e])}const Tn=(e,t)=>{var n,r,i,o,s,c;const u=e.exactCurrencyField===f.INPUT,d=e.exactCurrencyField===f.OUTPUT,p=((n=t.input)===null||n===void 0?void 0:n.address)??((r=e.input)===null||r===void 0?void 0:r.address),h=((i=t.output)===null||i===void 0?void 0:i.address)??((o=e.output)===null||o===void 0?void 0:o.address),v=u&&((s=e.input)===null||s===void 0?void 0:s.address)!==p,m=d&&((c=e.output)===null||c===void 0?void 0:c.address)!==h;return v||m};function Cn(e){if(Pe.hasTimestamp(Te.FirstSwapAction))return;const t=Pe.setElapsedTime(Te.FirstSwapAction);Ye(Ot.SwapFirstAction,{time_to_first_swap_action:t,...e})}function Pn(e){const t=(0,l.useRef)(e);return t.current=e,t}function An({onSelect:e}){const{onCurrencyChange:t}=nn(),{output:n,input:r,exactCurrencyField:i,filteredChainIds:o,updateSwapForm:s}=Vt(m=>({output:m.output,input:m.input,exactCurrencyField:m.exactCurrencyField,filteredChainIds:m.filteredChainIds,updateSwapForm:m.updateSwapForm})),c=Pn(qe()),u=(0,l.useMemo)(()=>r?[B(r)]:[],[r]),d=$e(u),p=(0,l.useMemo)(()=>n?[B(n)]:[],[n]),h=$e(p),v=Dt();return Y(({currency:m,field:g,forceIsBridgePair:P,isPreselectedAsset:A})=>{var _;const I={address:ye(m),chainId:m.chainId,type:je.Currency},x={};g===f.OUTPUT&&(x.preselectAsset=A);const b=g===f.INPUT?f.OUTPUT:f.INPUT,T=g===f.INPUT?n:r,N=b===f.INPUT?d:h,E=P||(T?wn({queryClient:v,input:g===f.INPUT?I:T,output:g===f.OUTPUT?I:T}):!1);if(T&&be(B(m),B(T))){const y=g===f.INPUT?r:n;x.exactCurrencyField=i===f.INPUT?f.OUTPUT:f.INPUT,x.focusOnCurrencyField=x.exactCurrencyField,x[b]=y}else if(T&&m.chainId!==T.chainId&&!E){var O;const y=(O=N.data)===null||O===void 0?void 0:O.find(k=>k.currency.chainId===m.chainId),z=y&&{address:ye(y.currency),chainId:y.currency.chainId,type:je.Currency};x[b]=z&&y&&!be(B(m),y.currencyId)?z:void 0}if(!E){const y={...o??{}};y[f.INPUT]=m.chainId,y[f.OUTPUT]=m.chainId,x.filteredChainIds=y}x[g]=I,Tn({input:r,output:n,exactCurrencyField:i},x)&&(x.exactAmountToken="",x.exactAmountFiat="");const M=(_=N.data)===null||_===void 0?void 0:_.find(y=>y.currency.chainId===m.chainId),L={inputCurrency:f.INPUT===g?m:M==null?void 0:M.currency,outputCurrency:f.OUTPUT===g?m:M==null?void 0:M.currency};e==null||e(),s(x),Cn(c.current),t==null||t(L,E)})}function wn({queryClient:e,input:t,output:n}){if(t.chainId===n.chainId)return!1;const r=Ce(t.address,t.chainId),i=Ae(t.chainId),o=Ce(n.address,n.chainId),s=Ae(n.chainId);if(!r||!i||!o||!s)return!1;const c=Fe({params:{tokenIn:r,tokenInChainId:i},queryClient:e}),u=Fe({params:{tokenIn:o,tokenInChainId:s},queryClient:e}),d=!!c&&Oe({bridgePairs:c,tokenAddress:o,tokenChainId:s}),p=!!u&&Oe({bridgePairs:u,tokenAddress:r,tokenChainId:i});return d||p}function Oe({bridgePairs:e,tokenAddress:t,tokenChainId:n}){const r=we(n);return!!e.tokens.find(i=>{const o=we(i.chainId);return r&&o&&Et({addressInput1:{address:i.address,chainId:o},addressInput2:{address:t,chainId:r}})&&r===o})}const Mn=[{translateY:-4},{scale:.95}],kn={opacity:1,transform:[{translateY:0}],scale:1},Fn={backgroundColor:"$surface3Hovered",scale:st},$n=(0,l.memo)(({currencyInfo:e,index:t,numOptions:n,currencyField:r=f.OUTPUT})=>{const{logoUrl:i,currency:o}=e,s=An({}),c=yn({currencyField:r}),u=n-t-1,d=Y(v=>{v.stopPropagation(),s({currency:e.currency,field:r,forceIsBridgePair:!1,isPreselectedAsset:!0}),c({currencyInfo:e,position:t+1,suggestion_count:n||0})}),p=(0,l.useMemo)(()=>{if(F)return ot(u)},[u]),h=(0,l.useMemo)(()=>({chain_id:o.chainId,token_symbol:o.symbol}),[o.chainId,o.symbol]);return(0,a.jsx)(D,{"$group-hover":F?kn:void 0,opacity:F?0:void 0,transform:F?Mn:void 0,animation:p,children:(0,a.jsx)(Qe,{logPress:!0,element:K.PreselectAsset,properties:h,children:(0,a.jsx)(R,{hoverable:!0,p:"$spacing4",borderRadius:"$roundedFull",backgroundColor:"$surface3",hoverStyle:F?Fn:void 0,animation:F?"simple":void 0,onPress:d,children:(0,a.jsx)(qt,{url:i,symbol:o.symbol,chainId:o.chainId,size:at})})})})}),jn={close:0,open:0},En=({currencyInfo:e,index:t,numOptions:n,currencyField:r})=>{const{currency:{symbol:i}}=e;return(0,a.jsxs)(X,{delay:jn,restMs:0,placement:"top",children:[(0,a.jsx)(X.Trigger,{children:(0,a.jsx)($n,{currencyInfo:e,index:t,numOptions:n,currencyField:r},t)}),(0,a.jsxs)(X.Content,{children:[(0,a.jsx)($,{variant:"body4",children:i}),(0,a.jsx)(X.Arrow,{})]})]})},On=e=>e.isNative?`${e.chainId}-native`:`${e.chainId}-${e.address}`,Nn=()=>{const e=me().evmAccount,t=Ke(o=>o.chainId),{data:n}=Xt(e==null?void 0:e.address,t),r=(n==null?void 0:n.length)??0;return{allCurrencyInfos:(0,l.useMemo)(()=>(n==null?void 0:n.slice(0,In).map(({currencyInfo:o})=>o))??[],[n]),numberOfCommonTokenOptions:r}},Un=({currencyField:e})=>{const{allCurrencyInfos:t,numberOfCommonTokenOptions:n}=Nn();return(0,a.jsx)(a.Fragment,{children:t.map((r,i)=>{const{currency:o}=r,s=On(o);return(0,a.jsx)(En,{currencyField:e,currencyInfo:r,index:i,numOptions:n},s)})})};function Dn({currencyField:e}){return(0,a.jsx)(xt,{horizontal:!0,showsVerticalScrollIndicator:!1,children:(0,a.jsx)(D,{row:!0,m:bn,gap:U?"$gap4":"$gap8",flex:1,...F?{opacity:0,transform:[{translateY:-4}],"$group-hover":{opacity:1,transform:[{translateY:0}]}}:{},animation:"100ms",children:(0,a.jsx)(Un,{currencyField:e})})})}const ct=(0,l.memo)(Dn);function Rn({initialInverse:e=!1}){const[t,n]=(0,l.useState)(e),r=te(),i=Ke(o=>o.trade).trade;return i?(0,a.jsx)(R,{...F&&{"$group-hover":{opacity:1},opacity:0,animation:"simple"},style:{userSelect:"none"},onPress:()=>n(!t),children:(0,a.jsx)($,{adjustsFontSizeToFit:!0,...F&&{hoverStyle:{color:"$neutral1"},animation:"simple"},color:"$neutral2",numberOfLines:1,variant:"body3",children:Ht({formatter:r,trade:i,showInverseRate:t})})}):null}const Ln="  _display-flex _alignItems-stretch _flexBasis-auto _boxSizing-border-box _position-relative _minHeight-0px _minWidth-0px _flexShrink-0 _flexDirection-row _justifyContent-space-betwe3241 ";function zn({headerLabel:e,currencyField:t,currencyBalance:n,currencyAmount:r,currencyInfo:i,onSetPresetValue:o,showDefaultTokenOptions:s}){const c=Ze(),u=t===f.OUTPUT,d=c&&u&&!!i;if(!e&&!s)return null;const p=(U||Le)&&t===f.INPUT&&n;return(0,a.jsxs)("div",{className:Ln,children:[(0,a.jsx)($,{color:"$neutral2",variant:"subheading2",fontSize:V?"$micro":"$small",children:e}),p&&(0,a.jsx)(D,{position:"absolute",right:0,top:-W.spacing2,children:(0,a.jsx)(rt,{currencyAmount:r,currencyBalance:n,buttonProps:{py:"$spacing4"},onSetPresetValue:o})}),s&&U&&(0,a.jsx)(D,{position:"absolute",right:0,top:-W.spacing6,children:(0,a.jsx)(ct,{currencyField:f.OUTPUT})}),d&&U&&(0,a.jsx)(Rn,{})]})}const Gn=["ar","ckb","fa","he","ks","lrc","mzn","ps","ug","ur","yi"],Hn=!!(typeof window<"u"&&window.document&&window.document.createElement);function ut(e){return e==="419"?"UN":e.toUpperCase()}function lt(e){const[t,n]=e.split("-");return{languageCode:t,countryCode:n}}function Bn(e,t){let{languageCode:n,countryCode:r}=lt(e);return n=n.toLowerCase(),r=ut(r||t),{languageCode:n,countryCode:r,languageTag:`${n}-${r}`,isRTL:Gn.includes(n)}}function Wn(){return Bn(navigator.language,Vn())}function Vn(){const{languages:e=[navigator.language]}=navigator;for(let t=0;t<e.length;t++){const{countryCode:n}=lt(e[t]);if(n)return ut(n)}return"US"}function Yn(){const{languageTag:e}=Wn(),n=new Intl.NumberFormat(e).format(10000001e-1).replace(/\d/g,"");return{decimalSeparator:n[n.length-1],groupingSeparator:n[0]}}const qn=new Set;Hn&&window.addEventListener("languagechange",()=>{qn.forEach(e=>e())});const Xn=RegExp("^\\d*(\\.\\d*)?$");function Kn(e){return!e||Xn.test(e)}function le({value:e,groupingSeparator:t,decimalSeparator:n,groupingOverride:r,decimalOverride:i}){let o=e.split(n);return t&&r!=null&&(o=o.map(s=>s.replace(new RegExp(`\\${t}`,"g"),r))),o.join(i)}function Qn({value:e,maxDecimals:t,decimalSeparator:n="."}){const[r,i]=e.split(n);return i===void 0?e:`${r}.${i.substring(0,t)}`}function Zn({value:e,decimalSeparator:t,groupingSeparator:n,showSoftInputOnFocus:r,nativeKeyboardDecimalSeparator:i,maxDecimals:o}){let s=(e==null?void 0:e.trim())??"";return s=s.replace(/[^0-9.,]/g,""),pe?s=s.replace(/,/g,"."):(r&&i!==t&&(s=le({value:s,decimalSeparator:i,decimalOverride:t})),s=le({value:s,groupingSeparator:n,decimalSeparator:t,groupingOverride:"",decimalOverride:"."})),o===void 0?s:Qn({value:s,maxDecimals:o})}const Jn=Xe,eo=(0,l.forwardRef)(function({onChangeText:t,value:n,adjustWidthToContent:r,dimTextColor:i,showSoftInputOnFocus:o,maxDecimals:s,fiatCurrencyInfo:c,inputEnforcer:u=Kn,...d},p){const h=ee(),v=c||h,{groupingSeparator:m,decimalSeparator:g}=v,{decimalSeparator:P}=Yn();(0,l.useEffect)(()=>{u(n)||t==null||t("")},[u,t,n]);const A=(0,l.useCallback)(N=>{t==null||t(Zn({value:N,decimalSeparator:g,groupingSeparator:m,showSoftInputOnFocus:o,nativeKeyboardDecimalSeparator:P,maxDecimals:s}))},[g,m,s,P,t,o]),_=le({value:n??"",groupingSeparator:",",decimalSeparator:".",groupingOverride:"",decimalOverride:g}),[I,x]=(0,l.useState)(0),b=(0,l.useMemo)(()=>({ref:p,color:!n||i?"$neutral2":"$neutral1",keyboardType:"decimal-pad",value:_,onChangeText:A,...d,...r?{width:I}:{}}),[p,n,i,_,A,d,I,r]);Jn("active",o?Xe:Jt);const T=o?(0,a.jsx)(to,{...b}):(0,a.jsx)(Je,{...b,showSoftInputOnFocus:!1});return r?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($,{fontFamily:"$heading",fontSize:b.fontSize,fontWeight:"500",height:0,numberOfLines:1,overflow:"hidden",position:"absolute",onLayout:N=>x(Math.min(N.nativeEvent.layout.width,typeof b.maxWidth=="number"?b.maxWidth:1/0)),children:n||b.placeholder}),T]}):T}),to=(0,l.forwardRef)(function(t,n){return(0,a.jsx)(Je,{ref:n,...t})}),no="  _display-flex _alignItems-center _flexBasis-auto _boxSizing-border-box _position-relative _minHeight-0px _minWidth-0px _flexShrink-0 _flexDirection-row _justifyContent-center _gap-t-space-spa94665591 _pr-t-space-spa1360334080 _pl-t-space-spa1360334080 _height-t-size-spac100347333 ",oo="  _pr-t-space-spa1360334080",io=" _display-flex _alignItems-center _flexBasis-auto _boxSizing-border-box _position-relative _minHeight-0px _minWidth-0px _flexShrink-0 _flexDirection-row _justifyContent-center _gap-t-space-spa94665589 _pt-t-space-spa94665589 _pr-t-space-spa94665589 _pb-t-space-spa94665589 _pl-t-space-spa94665589  ",ro=(0,l.memo)(function({selectedCurrencyInfo:t,onPress:n,testID:r,tokenColor:i}){const{t:o}=J(),s=It(),c=Tt(i),u=(0,l.useMemo)(()=>({backgroundColor:t?"$surface1Hovered":c??"$accent1Hovered",filter:c?St({isDarkMode:s}):void 0}),[t,c,s]),d=!At||pe;if(!n&&t)return(0,a.jsxs)("div",{className:fe(""+(io+(V?" ":oo))),children:[(0,a.jsx)(ke,{currencyInfo:t,size:Z.icon28}),(0,a.jsx)($,{color:"$neutral1",pl:"$spacing4",testID:`${r}-label`,variant:"buttonLabel1",children:Q(t.currency.symbol)})]});const p=t?"$neutral1":i?_t(i):"$white",h=t?"$neutral2":p;return(0,a.jsx)(R,{backgroundColor:t?"$surface1":c??"$accent1",borderRadius:"$roundedFull",testID:r,borderColor:"$surface3Solid",borderWidth:"$spacing1",shadowColor:"$surface3",shadowRadius:10,shadowOpacity:.04,scaleTo:gt,hoverable:!!t,hoverStyle:u,onPress:n,children:(0,a.jsxs)("div",{className:no,children:[t&&(0,a.jsx)(D,{ml:-W.spacing8,children:(0,a.jsx)(ke,{currencyInfo:t,size:Z.icon28})}),(0,a.jsx)($,{color:p,testID:`${r}-label`,variant:"buttonLabel2",children:t?Q(t.currency.symbol):o("tokens.selector.button.choose")}),!d&&(0,a.jsx)(vt,{color:h,direction:"down",height:"$spacing24",mx:-W.spacing2})]})})}),so=36,de=24,ao=23;function co({value:e,focus:t,options:n}){const r=(n==null?void 0:n.maxFontSize)??so,i=(n==null?void 0:n.minFontSize)??de,o=(n==null?void 0:n.maxCharWidthAtMaxFontSize)??ao,{onLayout:s,fontSize:c,onSetFontSize:u}=en({maxCharWidthAtMaxFontSize:o,maxFontSize:r,minFontSize:i}),d=c*1.2;return(0,l.useEffect)(()=>{e?u(e):t&&u("0")},[t,u,e]),{onLayout:s,fontSize:c,lineHeight:d}}function uo({inputRef:e,focus:t,value:n,currencyField:r,resetSelection:i}){var o;const s=(o=e.current)===null||o===void 0?void 0:o.isFocused();(0,l.useEffect)(()=>{var c;t!==void 0&&(t&&!s?(i==null||i({start:(n==null?void 0:n.length)??0,end:(n==null?void 0:n.length)??0,currencyField:r}),setTimeout(()=>{var u;(u=e.current)===null||u===void 0||u.focus()},Ge/2)):!t&&s&&((c=e.current)===null||c===void 0||c.blur()))},[e,r,t,s,i,n==null?void 0:n.length])}Ue();function lo({currencyAmount:e,isLoading:t,isIndicativeLoading:n,valueIsIndicative:r}){const i=Re(1);i.value=Ct(Pt(Ie(.4,{duration:400,easing:Se.ease}),Ie(1,{duration:400,easing:Se.ease})),-1,!0);const o=$t(e),s=e&&(o==null?void 0:o.equalTo(e)),u=t&&s&&(!n&&!r);return De(()=>({opacity:u?i.value:1}),[u,i])}const po="  _display-flex _flexBasis-auto _boxSizing-border-box _position-relative _minHeight-0px _minWidth-0px _flexShrink-0 _flexDirection-row _alignItems-center ",mo=" _flexShrink-0",fo=" _flexShrink-1",ho=" _display-flex _alignItems-stretch _flexBasis-auto _boxSizing-border-box _position-relative _minHeight-0px _minWidth-0px _flexShrink-0 _flexDirection-column _flexGrow-1  ",go=(0,l.memo)((0,l.forwardRef)(function(t,n){const{autoFocus:r,currencyField:i,currencyInfo:o,focus:s,isFiatMode:c=!1,onPressIn:u,onSelectionChange:d,onSetExactAmount:p,onShowTokenSelector:h,showSoftInputOnFocus:v=!1,resetSelection:m,disabled:g=!1,onPressDisabledWithShakeAnimation:P,tokenColor:A,shakeAnimation:_,showInsufficientBalanceWarning:I,showDefaultTokenOptions:x,indicativeQuoteTextDisplay:b}=t,T=yt(),{symbol:N}=ee(),{value:E,color:O}=b,M=(0,l.useRef)(null),{shakeStyle:L,triggerShakeAnimation:y}=_;(0,l.useImperativeHandle)(n,()=>({textInputRef:M,triggerShakeAnimation:y}));const z=i===f.OUTPUT;uo({inputRef:M,focus:s,value:E,currencyField:i,resetSelection:m});const k=co({value:E,focus:s}),ne=(0,l.useCallback)(({nativeEvent:{selection:{start:oe,end:ie}}})=>d==null?void 0:d(oe,ie),[d]),q=lo(t);return(0,a.jsxs)(Me,{row:!0,alignItems:"center",justifyContent:o?"space-between":"flex-end",py:"$spacing8",minHeight:de*1.2+2*W.spacing8,style:L,children:[c&&(0,a.jsx)($,{allowFontScaling:!0,color:I?"$statusCritical":O,fontSize:k.fontSize,lineHeight:k.lineHeight,mr:V?"$spacing2":void 0,children:N}),(0,a.jsx)(Me,{fill:!0,grow:!0,row:!0,alignItems:"center",minHeight:de,mr:"$spacing8",style:q,onLayout:k.onLayout,children:o?(0,a.jsxs)("div",{className:fe(""+(ho+(V?fo:mo))),children:[g&&(0,a.jsx)(R,{style:{position:"absolute",width:"100%",height:"100%",zIndex:1},onPress:P}),(0,a.jsx)(eo,{ref:M,autoFocus:r??s,backgroundColor:"$transparent",borderWidth:"$none",color:I?"$statusCritical":O,disabled:g||!o,flex:1,focusable:!g&&!!o,fontFamily:"$heading",fontSize:k.fontSize,lineHeight:k.lineHeight,fontWeight:"$book",maxDecimals:c?Rt:o.currency.decimals,maxFontSizeMultiplier:Bt.heading2.maxFontSizeMultiplier,minHeight:k.lineHeight,overflow:"visible",placeholder:"0",placeholderTextColor:T.neutral3.val,borderRadius:0,px:"$none",py:"$none",returnKeyType:v?"done":void 0,showSoftInputOnFocus:v,testID:z?G.AmountInputOut:G.AmountInputIn,value:E,onChangeText:p,onPressIn:u,onSelectionChange:ne})]}):x&&!U?(0,a.jsx)(ct,{currencyField:f.OUTPUT}):(0,a.jsx)(R,{onPress:h,children:(0,a.jsx)($,{color:"$neutral3",fontSize:k.fontSize,variant:"heading2",style:{lineHeight:k.fontSize},children:"0"})})}),(0,a.jsx)("div",{className:po,children:(0,a.jsx)(ro,{selectedCurrencyInfo:o,testID:i===f.INPUT?G.ChooseInputToken:G.ChooseOutputToken,tokenColor:A,onPress:h})})]})}));function vo({value:e,currencyInfo:t,currencyAmount:n,usdValue:r,isFiatMode:i}){const o=ee(),{convertFiatAmountFormatted:s,formatCurrencyAmount:c,addFiatSymbolToNumber:u}=te(),d=n?c({value:n,type:ce.TokenTx}):"",p=r?s(r.toExact(),ce.FiatTokenQuantity):"-";return(0,l.useMemo)(()=>{const h=t?Q(t.currency.symbol):"";if(!e)return i?`0 ${h}`:u({value:0,currencyCode:o.code,currencySymbol:o.symbol}).toString();if(i){if(d)return`${d} ${h}`}else if(p)return p;return"0"},[u,o.code,o.symbol,t,d,p,i,e])}const xo="  _display-flex _alignItems-center _flexBasis-auto _boxSizing-border-box _position-relative _minHeight-0px _minWidth-0px _flexShrink-1 _flexDirection-row _justifyContent-center _gap-t-space-spa94665589 _width-max-content ",_o=(0,l.memo)(function({disabled:t,value:n,usdValue:r,priceDifferencePercentage:i,onPressDisabledWithShakeAnimation:o,onToggleIsFiatMode:s,currencyField:c,currencyInfo:u,currencyAmount:d,isFiatMode:p}){const{t:h}=J(),v=wt(),{formatPercent:m}=te(),{isTestnetModeEnabled:g}=kt(),P=Ze(),_=c===f.OUTPUT&&!!u&&!!d,{price:I}=Lt(u==null?void 0:u.currency),{code:x}=ee(),b=(0,l.useCallback)(()=>{I?s(c):v(Yt({type:Zt.Error,errorMessage:h("swap.error.fiatInputUnavailable",{fiatCurrencyCode:x}),hideDelay:Ge*3}))},[c,v,x,s,h,I]),T=vo({value:n,currencyInfo:u,currencyAmount:d,usdValue:r,isFiatMode:p});return(0,a.jsx)(R,{group:"item",flexShrink:1,onPress:t||g?o:b,children:!g&&(0,a.jsxs)("div",{className:xo,children:[(0,a.jsx)($,{color:"$neutral2","$group-item-hover":{color:"$neutral2Hovered"},numberOfLines:1,variant:"body3",children:T}),P&&_&&(0,a.jsxs)($,{color:"$neutral3",variant:"body3",children:["(",m(i),")"]})]})})});function So({currencyAmount:e,focus:t,isLoading:n,usdValue:r,value:i,valueIsIndicative:o}){const s=(0,l.useRef)({value:i,color:"$neutral3",usdValue:r}),c=!!(n||e);return(0,l.useEffect)(()=>{c||(s.current={value:void 0,color:"$neutral3"})},[c]),(0,l.useMemo)(()=>{if(t)return{value:i,color:"$neutral1",usdValue:r};if(!i)return c?s.current:{value:i,color:"$neutral3"};const d={value:i,color:o?"$neutral3":"$neutral1",usdValue:r};return s.current=d,d},[t,i,r,c,o])}const Io="  _display-flex _alignItems-center _flexBasis-auto _boxSizing-border-box _position-relative _minHeight-0px _minWidth-0px _flexShrink-0 _flexDirection-row _justifyContent-flex-end _ml-auto _gap-t-space-spa94665589 ",bo="  _display-flex _alignItems-stretch _flexBasis-auto _boxSizing-border-box _minHeight-0px _minWidth-0px _flexShrink-0 _flexDirection-column _position-absolute ",yo="  _opacity-0 _pointerEvents-none",To="  _mb-t-space-spa94665591",Co=" _display-flex _flexBasis-auto _boxSizing-border-box _position-relative _minHeight-0px _minWidth-0px _flexShrink-0 _flexDirection-row _alignItems-center _gap-t-space-spa94665593  ",Pi=(0,l.memo)((0,l.forwardRef)(function(t,n){const{autoFocus:r,currencyAmount:i,currencyBalance:o,currencyField:s,currencyInfo:c,focus:u,isFiatMode:d=!1,showMaxButtonOnly:p=!1,showSoftInputOnFocus:h=!1,tokenColor:v,onPressIn:m,isLoading:g,valueIsIndicative:P,isIndicativeLoading:A,onSelectionChange:_,onSetExactAmount:I,onSetPresetValue:x,onShowTokenSelector:b,onToggleIsFiatMode:T,resetSelection:N,disabled:E=!1,onPressDisabled:O,priceDifferencePercentage:M,headerLabel:L,transactionType:y,customPanelStyle:z}=t,k=me().evmAccount,ne=bt(),q=So(t),{value:oe,usdValue:ie}=q,re=s===f.OUTPUT,he=re&&!c,ge=!re&&!!o&&!!i&&o.lessThan(i),dt=p&&!re&&k,ve=!p&&s===f.INPUT&&(pe||(U||Le)&&!L),xe=tn(),{triggerShakeAnimation:_e}=xe,se=(0,l.useCallback)(()=>{O==null||O(),_e()},[O,_e]),ae=(0,l.useCallback)((pt,mt)=>{x==null||x(pt,mt)},[x]);return(0,a.jsx)(R,{group:!0,disabledStyle:{cursor:"default"},onPress:E?se:c?m:b,children:(0,a.jsxs)(D,{...z,overflow:"hidden",px:"$spacing16",py:ne?"$spacing8":"$spacing16",children:[(0,a.jsx)(zn,{headerLabel:L,currencyField:s,currencyBalance:o,currencyAmount:i,currencyInfo:c,showDefaultTokenOptions:he,onSetPresetValue:ae}),(0,a.jsx)(go,{ref:n,autoFocus:r,currencyAmount:i,currencyBalance:o,currencyField:s,currencyInfo:c,shakeAnimation:xe,focus:u,isLoading:g,isFiatMode:d,isIndicativeLoading:A,valueIsIndicative:P,showSoftInputOnFocus:h,resetSelection:N,disabled:E,tokenColor:v,indicativeQuoteTextDisplay:q,showInsufficientBalanceWarning:ge,showDefaultTokenOptions:he,onPressIn:m,onSelectionChange:_,onSetExactAmount:I,onShowTokenSelector:b,onPressDisabledWithShakeAnimation:se}),(0,a.jsxs)("div",{className:fe(Co+(ve?To:" ")+(" "+(c?" ":yo))),children:[ve&&o&&!i?(0,a.jsx)("div",{className:bo,children:(0,a.jsx)(rt,{hoverLtr:!0,buttonProps:{py:"$spacing4"},currencyAmount:i,currencyBalance:o,onSetPresetValue:ae})}):(0,a.jsx)(_o,{disabled:E,value:oe,usdValue:ie,isFiatMode:d,priceDifferencePercentage:M,currencyInfo:c,currencyAmount:i,currencyField:s,onPressDisabledWithShakeAnimation:se,onToggleIsFiatMode:T}),c&&(0,a.jsxs)("div",{className:Io,children:[(0,a.jsx)(Sn,{currencyField:s,currencyBalance:o,currencyInfo:c,showInsufficientBalanceWarning:ge}),dt&&x&&(0,a.jsx)(it,{percentage:"max",currencyAmount:i,currencyBalance:o,currencyField:s,transactionType:y,buttonProps:{borderWidth:0},onSetPresetValue:ae})]})]})]})})}));export{eo as AmountInput,Pi as CurrencyInputPanel,Ti as TransactionModalContextProvider,yi as TransactionScreen,Ci as delayAnimations200ms,Vn as getCountry,ue as isMaxPercentage,Cn as maybeLogFirstSwapAction,Xn as numericInputRegex,co as useCurrencyInputFontSize,cn as useMaxAmountSpend,An as useOnSelectCurrency,nn as useTransactionModalContext,Pn as useValueAsRef};
