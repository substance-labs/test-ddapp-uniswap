import{logger as R}from"./hooks-BXO4d1DJ.js";import{CurrencyAmount as o,Token as U,ZERO_ADDRESS as v,init_sdk_core_esm as q}from"./utils-BX1Fu73x.js";import{Pool as A,Position as F,init_v4_sdk_esm as T}from"./V3DutchOrderTrade-Cl7yELmp.js";import{FeeAmount as b,Pool as P,Position as g,init_v3_sdk_esm as N}from"./v3-sdk.esm-CHH6GWR1.js";import{Pair as h,init_v2_sdk_esm as S}from"./v2-sdk.esm-CIiDMO7F.js";import{nativeOnChain as L}from"./objects-DlLkJwrJ.js";import{Pool as V,PoolPosition as D,ProtocolVersion as a}from"./types_pb-yZxlo4b1.js";import{DEFAULT_TICK_SPACING as _}from"./pools-5GjP-hMy.js";import{DYNAMIC_FEE_DATA as H}from"./feeTiers-D9BvLkmt.js";q();S();N();T();function y(e){const r=parseInt(e||"");return r in b?{feeAmount:r,tickSpacing:_,isDynamic:!1}:void 0}function w({pool:e,token0:r,token1:u,protocolVersion:m,hooks:l}){if(!(!e||!r||!u)){if(e instanceof V)return m===a.V3?new P(r,u,e.fee,e.sqrtPriceX96,e.liquidity,e.tick):new A(r,u,e.fee,e.tickSpacing,l||v,e.sqrtPriceX96,e.liquidity,e.tick);if(e instanceof D){if(m===a.V3){const i=y(e.feeTier);return i?new P(r,u,i.feeAmount,e.currentPrice,e.currentLiquidity,parseInt(e.currentTick)):void 0}const t=parseInt(e.feeTier);return new A(r,u,t,parseInt(e.tickSpacing),l||v,e.currentPrice,e.currentLiquidity,parseInt(e.currentTick))}}}function s(e){if(e)return e.address===v?L(e.chainId):new U(e.chainId,e.address,e.decimals,e.symbol,e.name)}function C({pair:e,token0:r,token1:u}){if(e)return new h(o.fromRawAmount(r,e.reserve0),o.fromRawAmount(u,e.reserve1))}function j(e){try{if((e==null?void 0:e.position.case)==="v2Pair"){const t=e.position.value,i=s(t.token0),n=s(t.token1),c=s(t.liquidityToken);if(!i||!n||!c)return;const d=C({pair:e.position.value,token0:i,token1:n});return{status:e.status,version:a.V2,poolOrPair:d,liquidityToken:c,chainId:i.chainId,poolId:c.address,currency0Amount:o.fromRawAmount(i,t.liquidity0),currency1Amount:o.fromRawAmount(n,t.liquidity1),totalSupply:o.fromRawAmount(c,t.totalSupply),liquidityAmount:o.fromRawAmount(c,t.liquidity),apr:t.apr,v4hook:void 0,feeTier:void 0,owner:void 0,isHidden:e.isHidden}}else if((e==null?void 0:e.position.case)==="v3Position"){const t=e.position.value,i=s(t.token0),n=s(t.token1);if(!i||!n)return;const c=w({pool:e.position.value,token0:i,token1:n,protocolVersion:a.V3}),d=c?new g({pool:c,liquidity:t.liquidity,tickLower:Number(t.tickLower),tickUpper:Number(t.tickUpper)}):void 0,f=o.fromRawAmount(i,t.token0UncollectedFees),k=o.fromRawAmount(n,t.token1UncollectedFees);return{status:e.status,feeTier:y(t.feeTier),version:a.V3,chainId:i.chainId,poolOrPair:c,poolId:e.position.value.poolId,position:d,tickLower:Number(t.tickLower),tickUpper:Number(t.tickUpper),tickSpacing:Number(t.tickSpacing),liquidity:t.liquidity,tokenId:t.tokenId,token0UncollectedFees:t.token0UncollectedFees,token1UncollectedFees:t.token1UncollectedFees,fee0Amount:f,fee1Amount:k,currency0Amount:o.fromRawAmount(i,t.amount0),currency1Amount:o.fromRawAmount(n,t.amount1),apr:t.apr,v4hook:void 0,owner:t.owner,isHidden:e.isHidden}}else if((e==null?void 0:e.position.case)==="v4Position"){var r,u,m,l;const t=e.position.value.poolPosition,i=s(t==null?void 0:t.token0),n=s(t==null?void 0:t.token1);if(!t||!i||!n)return;const c=(r=e.position.value.hooks[0])===null||r===void 0?void 0:r.address,d=w({pool:t,token0:i,token1:n,hooks:c,protocolVersion:a.V4}),f=d?new F({pool:d,liquidity:t.liquidity,tickLower:Number(t.tickLower),tickUpper:Number(t.tickUpper)}):void 0,k=A.getPoolId(i,n,Number(t.feeTier),Number(t.tickSpacing),c),p=o.fromRawAmount(i,t.token0UncollectedFees),I=o.fromRawAmount(n,t.token1UncollectedFees);return{status:e.status,feeTier:{feeAmount:t.isDynamicFee?H.feeAmount:Number(t.feeTier),tickSpacing:Number(t.tickSpacing),isDynamic:t.isDynamicFee},version:a.V4,position:f,chainId:i.chainId,poolOrPair:d,poolId:k,v4hook:c,tokenId:t.tokenId,tickLower:Number(t.tickLower),tickUpper:Number(t.tickUpper),tickSpacing:Number(t.tickSpacing),currency0Amount:o.fromRawAmount(i,t.amount0),currency1Amount:o.fromRawAmount(n,t.amount1),token0UncollectedFees:t.token0UncollectedFees,token1UncollectedFees:t.token1UncollectedFees,fee0Amount:p,fee1Amount:I,liquidity:t.liquidity,apr:t.apr,owner:t.owner,isHidden:e.isHidden,totalApr:(u=e.position.value.poolPosition)===null||u===void 0?void 0:u.totalApr,unclaimedRewardsAmountUni:(m=e.position.value.poolPosition)===null||m===void 0?void 0:m.unclaimedRewardsAmountUni,boostedApr:(l=e.position.value.poolPosition)===null||l===void 0?void 0:l.boostedApr}}else return}catch(t){R.error(t,{tags:{file:"Liquidity/utils.tsx",function:"parseRestPosition"},extra:{...e}});return}}export{w as getPoolFromRest,j as parseRestPosition};
