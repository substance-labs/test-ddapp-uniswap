import{__toESM as ot}from"./chunk-DgAfPHQg.js";import{require_react as rt}from"./react-CNoFhWkx.js";var v=ot(rt()),st=Object.defineProperty,ct=Object.defineProperties,it=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertySymbols,ut=Object.prototype.hasOwnProperty,ft=Object.prototype.propertyIsEnumerable,j=(e,c,s)=>c in e?st(e,c,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[c]=s,lt=(e,c)=>{for(var s in c||(c={}))ut.call(c,s)&&j(e,s,c[s]);if(U)for(var s of U(c))ft.call(c,s)&&j(e,s,c[s]);return e},at=(e,c)=>ct(e,it(c));const R=e=>"init"in e,b=Symbol(),W=Symbol(),dt=e=>!!e[W],mt=e=>{let c;const s=new Promise((i,a)=>{c=i,e.then(i,a)});return s[b]=i=>s===i||e===i||dt(e)&&e[b](i),s[W]=c,s},J="r",B="w",L="c",q="s",pt="h",wt=e=>{const c=new WeakMap,s=new WeakMap,i=new Map;let a,w;if(e)for(const[t,n]of e){const u={v:n,r:0,d:new Map};c.set(t,u)}const m=t=>c.get(t),A=(t,n,u)=>{const f=!c.has(t);c.set(t,n),i.has(t)||i.set(t,[u,f])},p=(t,n)=>{const u=m(t);return[at(lt({r:0},u),{d:n?new Map(Array.from(n).map(d=>{var r,o;return[d,(o=(r=m(d))==null?void 0:r.r)!=null?o:0]})):(u==null?void 0:u.d)||new Map}),(u==null?void 0:u.d)||new Map]},O=(t,n,u,f)=>{var d,r;const[o,l]=p(t,u);f&&!((d=o.p)!=null&&d[b](f))||((r=o.c)==null||r.call(o),("e"in o||o.p||!("v"in o)||!Object.is(o.v,n))&&(++o.r,o.d.has(t)&&o.d.set(t,o.r)),o.v=n,delete o.e,delete o.p,delete o.c,delete o.i,A(t,o,u&&l))},y=(t,n,u,f)=>{var d,r;const[o,l]=p(t,u);f&&!((d=o.p)!=null&&d[b](f))||((r=o.c)==null||r.call(o),delete o.p,delete o.c,delete o.i,o.e=n,A(t,o,l))},N=(t,n,u)=>{var f,d;const[r,o]=p(t,u);if((f=r.p)!=null&&f[b](n))return;(d=r.c)==null||d.call(r),delete r.e;const l=mt(n);r.p=l,r.c=l[W],A(t,r,o)},F=t=>{const[n]=p(t);n.i=n.r,A(t,n)},V=(t,n,u)=>{const[f]=p(t);n?f.w=n:f.w===u&&delete f.w,A(t,f)},H=(t,n)=>{n.finally(()=>{P(t,!0)})},P=(t,n)=>{if(!n){const o=m(t);if(o&&(o.d.forEach((l,S)=>{if(S!==t){const h=m(S);h&&!("e"in h)&&!h.p&&h.r===h.i&&P(S,!0)}}),Array.from(o.d.entries()).every(([l,S])=>{const h=m(l);return h&&!("e"in h)&&!h.p&&h.r!==h.i&&h.r===S})))return o}let u,f,d;const r=new Set;try{const o=t.read(l=>{r.add(l);const S=l===t?m(l):P(l);if(S){if("e"in S)throw S.e;if(S.p)throw S.p;return S.v}if(R(l))return l.init;throw new Error("no atom init")});o instanceof Promise?f=o.then(l=>{O(t,l,r,f),_()}).catch(l=>{if(l instanceof Promise)return H(t,l),l;y(t,l,r,f),_()}):d=o}catch(o){o instanceof Promise?f=o:u=o}return u?y(t,u,r):f?N(t,f,r):O(t,d,r),m(t)},K=t=>P(t),X=t=>{let n=s.get(t);return n||(n=I(t)),n},g=(t,n)=>!n.l.size&&(!n.d.size||n.d.size===1&&n.d.has(t)),Y=t=>{const n=s.get(t);n&&g(t,n)&&C(t)},M=t=>{const n=s.get(t);n==null||n.d.forEach(u=>{u!==t&&(F(u),M(u))})},k=(t,n)=>{const u=(r,o=!1)=>{const l=P(r);if("e"in l)throw l.e;if(l.p){if(o)return l.p.then(()=>u(r,o));throw l.p}if("v"in l)return l.v;throw new Error("no value found")},f=(r,o)=>{let l;if(r===t){if(!R(r))throw new Error("no atom init");o instanceof Promise?(l=o.then(S=>{O(r,S),M(r),_()}).catch(S=>{y(t,S),_()}),N(t,l)):O(r,o),M(r),_()}else l=k(r,o);return l},d=t.write(u,f,n);if(d instanceof Promise){const r=d.finally(()=>{V(t,null,r),_()});V(t,r)}return _(),d},D=(t,n)=>k(t,n),Z=t=>!!t.write,I=(t,n)=>{P(t).d.forEach((d,r)=>{if(r!==t){const o=s.get(r);o?o.d.add(t):I(r,t)}});const f={d:new Set(n&&[n]),l:new Set,u:void 0};if(s.set(t,f),Z(t)&&t.onMount){const d=r=>D(t,r);f.u=t.onMount(d)}return f},C=t=>{var n;const u=(n=s.get(t))==null?void 0:n.u;u&&u(),s.delete(t);const f=m(t);f&&f.d.forEach((d,r)=>{if(r!==t){const o=s.get(r);o&&(o.d.delete(t),g(r,o)&&C(r))}})},$=(t,n,u)=>{const f=new Set(n.d.keys());u.forEach((d,r)=>{if(f.has(r)){f.delete(r);return}const o=s.get(r);o&&(o.d.delete(t),g(r,o)&&C(r))}),f.forEach(d=>{const r=s.get(d);r?r.d.add(t):I(d,t)})},_=()=>{const t=Array.from(i);i.clear(),t.forEach(([n,[u,f]])=>{if(u){const r=m(n);r&&$(n,r,u)}const d=s.get(n);d==null||d.l.forEach(r=>r())})},tt=t=>{_()},et=(t,n)=>{const f=X(t).l;return f.add(n),()=>{f.delete(n),Y(t)}},nt=t=>{for(const[n,u]of t)R(n)&&(O(n,u),M(n));_()};return{[J]:K,[B]:D,[L]:tt,[q]:et,[pt]:nt}},St=e=>({s:wt(e)}),x=new Map,z=e=>(x.has(e)||x.set(e,(0,v.createContext)(St())),x.get(e));let At=0;function T(e,c){const s=`atom${++At}`,i={toString:()=>s};return typeof e=="function"?i.read=e:(i.init=e,i.read=a=>a(i),i.write=(a,w,m)=>{w(i,typeof m=="function"?m(a(i)):m)}),c&&(i.write=c),i}const ht=e=>!!e.write;function vt(e,c){"scope"in e&&(console.warn("atom.scope is deprecated. Please do useAtom(atom, scope) instead."),c=e.scope);const s=z(c),i=(0,v.useContext)(s).s,a=(0,v.useCallback)(()=>{const p=i[J](e);if("e"in p)throw p.e;if(p.p)throw p.p;if(p.w)throw p.w;if("v"in p)return p.v;throw new Error("no atom value")},[i,e]),[w,m]=(0,v.useReducer)(a,void 0,a);(0,v.useEffect)(()=>{const p=i[q](e,m);return m(),p},[i,e]),(0,v.useEffect)(()=>{i[L](e)});const A=(0,v.useCallback)(p=>{if(ht(e))return i[B](e,p);throw new Error("not writable atom")},[i,e]);return(0,v.useDebugValue)(w),[w,A]}const G=Symbol(),Q="w";function yt(e,c){const s=z(c),i=(0,v.useContext)(s).s;return(0,v.useCallback)(w=>i[Q](e,w),[i,e])}function gt(e,c){return vt(e,c)[0]}function It(e){const c=T(e,(s,i,a)=>{a===G?i(c,e):i(c,typeof a=="function"?a(s(c)):a)});return c}function Ct(e,c){const s=z(c),i=(0,v.useContext)(s).s;return(0,v.useCallback)(()=>i[Q](e,G),[i,e])}const _t=(e,c)=>{for(;;){const[s,...i]=c,a=e.get(s);if(!a)return;if(!i.length)return a[1];e=a[0],c=i}},Ot=(e,c,s)=>{for(;;){const[i,...a]=c;let w=e.get(i);if(w||(w=[new WeakMap],e.set(i,w)),!a.length){w[1]=s;return}e=w[0],c=a}},E=()=>{const e=new WeakMap;return(s,i)=>{const a=_t(e,i);if(a)return a;const w=s();return Ot(e,i,w),w}},Rt=E(),xt=E(),Tt=E(),Wt=E(),Pt=e=>({getItem:c=>{const s=e().getItem(c);return s instanceof Promise?s.then(i=>JSON.parse(i||"")):JSON.parse(s||"")},setItem:(c,s)=>{e().setItem(c,JSON.stringify(s))}}),bt=Pt(()=>localStorage);function zt(e,c,s=bt){const i=()=>{try{const m=s.getItem(e);return m instanceof Promise?m.catch(()=>c):m}catch{return c}},a=T(s.delayInit?c:i());return a.onMount=m=>{let A;if(s.subscribe&&(A=s.subscribe(e,m)),s.delayInit){const p=i();p instanceof Promise?p.then(m):m(p)}return A},T(m=>m(a),(m,A,p)=>{const O=typeof p=="function"?p(m(a)):p;A(a,O),s.setItem(e,O)})}const Nt=E();export{T as atom,It as atomWithReset,zt as atomWithStorage,Pt as createJSONStorage,vt as useAtom,gt as useAtomValue,Ct as useResetAtom,yt as useUpdateAtom};
