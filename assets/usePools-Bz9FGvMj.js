import{__toESM as I}from"./chunk-DgAfPHQg.js";import{require_react as k}from"./react-CNoFhWkx.js";import{logger as X}from"./hooks-BXO4d1DJ.js";import{V3_CORE_FACTORY_ADDRESSES as A,init_jsbi as P,init_sdk_core_esm as M,jsbi_default as v}from"./utils-BX1Fu73x.js";import{Pool as O,computePoolAddress as C,init_v3_sdk_esm as R}from"./v3-sdk.esm-CHH6GWR1.js";import{useReadContracts as E}from"./useReadContracts-Orb8TypL.js";import{assume0xAddress as g}from"./wagmi-CsUiFCSO.js";var T=(function(t){function e(n){"@babel/helpers - typeof";return e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},e(n)}function i(n,r){if(e(n)!="object"||!n)return n;var u=n[Symbol.toPrimitive];if(u!==void 0){var o=u.call(n,r||"default");if(e(o)!="object")return o;throw TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)}function s(n){var r=i(n,"string");return e(r)=="symbol"?r:r+""}function l(n,r,u){return(r=s(r))in n?Object.defineProperty(n,r,{value:u,enumerable:!0,configurable:!0,writable:!0}):n[r]=u,n}return t.defineProperty=l,t})({}),y;M();R();P();var c=I(k()),N=(y=class{static getPoolAddress({factoryAddress:t,tokenA:e,tokenB:i,fee:s,chainId:l}){this.addresses.length>this.MAX_ENTRIES&&(this.addresses=this.addresses.slice(0,this.MAX_ENTRIES/2));const{address:n}=e,{address:r}=i,u=`${t}:${n}:${r}:${s.toString()}`,o=this.addresses.find(d=>d.key===u);if(o)return o.address;const a={key:u,address:C({factoryAddress:t,tokenA:e,tokenB:i,fee:s,chainId:l})};return this.addresses.unshift(a),a.address}static getPool({tokenA:t,tokenB:e,fee:i,sqrtPriceX96:s,liquidity:l,tick:n}){this.pools.length>this.MAX_ENTRIES&&(this.pools=this.pools.slice(0,this.MAX_ENTRIES/2));const r=this.pools.find(o=>o.token0===t&&o.token1===e&&o.fee===i&&v.EQ(o.sqrtRatioX96,s)&&v.EQ(o.liquidity,l)&&o.tickCurrent===n);if(r)return r;const u=new O(t,e,i,s,l,n);return this.pools.unshift(u),u}},T.defineProperty(y,"MAX_ENTRIES",128),T.defineProperty(y,"pools",[]),T.defineProperty(y,"addresses",[]),y);let m=(function(t){return t[t.LOADING=0]="LOADING",t[t.NOT_EXISTS=1]="NOT_EXISTS",t[t.EXISTS=2]="EXISTS",t[t.INVALID=3]="INVALID",t})({});function w(t,e){const i=(0,c.useMemo)(()=>e?t.map(([o,a,d])=>{if(o&&a&&d){const f=o.wrapped,p=a.wrapped;return f.equals(p)?void 0:f.sortsBefore(p)?[f,p,d]:[p,f,d]}}):new Array(t.length),[e,t]),s=(0,c.useMemo)(()=>{const o=e&&A[e];return o?i.map(a=>a&&N.getPoolAddress({factoryAddress:o,tokenA:a[0],tokenB:a[1],fee:a[2],chainId:e})):Array(i.length).fill(void 0)},[e,i]),{data:l,isLoading:n}=E({contracts:(0,c.useMemo)(()=>s.map(o=>({address:g(o)??"0x",abi:[{inputs:[],name:"slot0",outputs:[{internalType:"uint160",name:"sqrtPriceX96",type:"uint160"},{internalType:"int24",name:"tick",type:"int24"},{internalType:"uint16",name:"observationIndex",type:"uint16"},{internalType:"uint16",name:"observationCardinality",type:"uint16"},{internalType:"uint16",name:"observationCardinalityNext",type:"uint16"},{internalType:"uint8",name:"feeProtocol",type:"uint8"},{internalType:"bool",name:"unlocked",type:"bool"}],stateMutability:"view",type:"function"}],functionName:"slot0",chainId:e})),[s,e])}),{data:r,isLoading:u}=E({contracts:(0,c.useMemo)(()=>s.map(o=>({address:g(o)??"0x",abi:[{inputs:[],name:"liquidity",outputs:[{internalType:"uint128",name:"",type:"uint128"}],stateMutability:"view",type:"function"}],functionName:"liquidity",chainId:e})),[s,e])});return D({poolKeys:t,slot0s:l,slot0sLoading:n,liquidities:r,liquiditiesLoading:u,poolTokens:i})}function D({poolKeys:t,slot0s:e,slot0sLoading:i,liquidities:s,liquiditiesLoading:l,poolTokens:n}){return(0,c.useMemo)(()=>t.map((r,u)=>{if(i||l)return[m.LOADING,null];const o=n[u],a=e==null?void 0:e[u],d=s==null?void 0:s[u];if(!o||!a||!d)return[m.INVALID,null];if(!a.result)return[m.NOT_EXISTS,null];if(typeof d.result!="bigint")return[m.NOT_EXISTS,null];const[f,p,_]=o,[b,h]=a.result;if(!b||b===0n)return[m.NOT_EXISTS,null];try{const S=N.getPool({tokenA:f,tokenB:p,fee:_,sqrtPriceX96:b.toString(),liquidity:d.result.toString(),tick:h});return[m.EXISTS,S]}catch(S){return X.error(S,{tags:{file:"usePools",function:"usePools"},extra:{token0:f.address,token1:p.address,chainId:f.chainId,fee:_}}),[m.NOT_EXISTS,null]}}),[t,i,l,n,e,s])}function Q({currencyA:t,currencyB:e,feeAmount:i}){const s=(0,c.useMemo)(()=>[[t,e,i]],[t,e,i]);return w(s,t==null?void 0:t.chainId)[0]}export{N as PoolCache,m as PoolState,Q as usePool,w as usePools};
