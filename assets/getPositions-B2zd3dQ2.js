import{__toESM as K}from"./chunk-DgAfPHQg.js";import{require_react as J}from"./react-CNoFhWkx.js";import{QueryObserver as E,Subscribable as X,ensurePreventErrorBoundaryRetry as Y,ensureSuspenseTimers as Z,fetchOptimistic as x,getHasError as $,keepPreviousData as j,noop as ee,notifyManager as _,replaceEqualDeep as te,shouldSuspend as N,useBaseQuery as se,useClearResetErrorBoundary as re,useIsRestoring as ie,useQueryClient as ae,useQueryErrorResetBoundary as ne,willFetch as oe}from"./useQuery-D_ZCw8XG.js";import{Pair as ce,init_v2_sdk_esm as le}from"./v2-sdk.esm-CIiDMO7F.js";import{deserializeToken as W}from"./currency-DIOEzjz2.js";import{hasNextPage as ue,hasPreviousPage as he,infiniteQueryBehavior as q}from"./infiniteQueryBehavior-C10I_UVS.js";import{assert as T,callUnaryMethod as de,createConnectInfiniteQueryKey as fe,createUseQueryOptions as ve,disableQuery as Q,useQuery as pe}from"./use-query-8AOGtvlP.js";import{uniswapPostTransport as I}from"./base-DVpWJ4NW.js";import{ProtocolVersion as Pe}from"./types_pb-yZxlo4b1.js";import{useTransport as be}from"./use-transport-CPomNX05.js";import{getPosition as ge,listPositions as L}from"./api-PoolsService_connectquery-N1pfS4Yc.js";var s=(function(e){function t(i,o,u){if(typeof i=="function"?i===o:i.has(o))return arguments.length<3?o:u;throw TypeError("Private element is not present on this object")}function r(i,o,u){return i.set(t(i,o),u),u}function n(i,o){if(o.has(i))throw TypeError("Cannot initialize the same private elements twice on an object")}function a(i,o,u){n(i,o),o.set(i,u)}function c(i,o){n(i,o),o.add(i)}function l(i,o){return i.get(t(i,o))}return e.assertClassBrand=t,e.classPrivateFieldGet2=l,e.classPrivateFieldInitSpec=a,e.classPrivateFieldSet2=r,e.classPrivateMethodInitSpec=c,e})({}),w,v,S,O,f,b,k,M,C,d;function D(e,t){return e.filter(r=>!t.includes(r))}function me(e,t,r){const n=e.slice(0);return n[t]=r,n}var Fe=(w=new WeakMap,v=new WeakMap,S=new WeakMap,O=new WeakMap,f=new WeakMap,b=new WeakMap,k=new WeakMap,M=new WeakMap,C=new WeakMap,d=new WeakSet,class extends X{constructor(e,t,r){super(),s.classPrivateMethodInitSpec(this,d),s.classPrivateFieldInitSpec(this,w,void 0),s.classPrivateFieldInitSpec(this,v,void 0),s.classPrivateFieldInitSpec(this,S,void 0),s.classPrivateFieldInitSpec(this,O,void 0),s.classPrivateFieldInitSpec(this,f,void 0),s.classPrivateFieldInitSpec(this,b,void 0),s.classPrivateFieldInitSpec(this,k,void 0),s.classPrivateFieldInitSpec(this,M,void 0),s.classPrivateFieldInitSpec(this,C,[]),s.classPrivateFieldSet2(w,this,e),s.classPrivateFieldSet2(O,this,r),s.classPrivateFieldSet2(S,this,[]),s.classPrivateFieldSet2(f,this,[]),s.classPrivateFieldSet2(v,this,[]),this.setQueries(t)}onSubscribe(){this.listeners.size===1&&s.classPrivateFieldGet2(f,this).forEach(e=>{e.subscribe(t=>{s.assertClassBrand(d,this,A).call(this,e,t)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,s.classPrivateFieldGet2(f,this).forEach(e=>{e.destroy()})}setQueries(e,t){s.classPrivateFieldSet2(S,this,e),s.classPrivateFieldSet2(O,this,t),_.batch(()=>{const r=s.classPrivateFieldGet2(f,this),n=s.assertClassBrand(d,this,U).call(this,s.classPrivateFieldGet2(S,this));s.classPrivateFieldSet2(C,this,n),n.forEach(i=>i.observer.setOptions(i.defaultedQueryOptions));const a=n.map(i=>i.observer),c=a.map(i=>i.getCurrentResult()),l=a.some((i,o)=>i!==r[o]);r.length===a.length&&!l||(s.classPrivateFieldSet2(f,this,a),s.classPrivateFieldSet2(v,this,c),this.hasListeners()&&(D(r,a).forEach(i=>{i.destroy()}),D(a,r).forEach(i=>{i.subscribe(o=>{s.assertClassBrand(d,this,A).call(this,i,o)})}),s.assertClassBrand(d,this,z).call(this)))})}getCurrentResult(){return s.classPrivateFieldGet2(v,this)}getQueries(){return s.classPrivateFieldGet2(f,this).map(e=>e.getCurrentQuery())}getObservers(){return s.classPrivateFieldGet2(f,this)}getOptimisticResult(e,t){const r=s.assertClassBrand(d,this,U).call(this,e),n=r.map(a=>a.observer.getOptimisticResult(a.defaultedQueryOptions));return[n,a=>s.assertClassBrand(d,this,V).call(this,a??n,t),()=>s.assertClassBrand(d,this,H).call(this,n,r)]}});function H(e,t){return t.map((r,n)=>{const a=e[n];return r.defaultedQueryOptions.notifyOnChangeProps?a:r.observer.trackResult(a,c=>{t.forEach(l=>{l.observer.trackProp(c)})})})}function V(e,t){return t?((!s.classPrivateFieldGet2(b,this)||s.classPrivateFieldGet2(v,this)!==s.classPrivateFieldGet2(M,this)||t!==s.classPrivateFieldGet2(k,this))&&(s.classPrivateFieldSet2(k,this,t),s.classPrivateFieldSet2(M,this,s.classPrivateFieldGet2(v,this)),s.classPrivateFieldSet2(b,this,te(s.classPrivateFieldGet2(b,this),t(e)))),s.classPrivateFieldGet2(b,this)):e}function U(e){const t=new Map(s.classPrivateFieldGet2(f,this).map(n=>[n.options.queryHash,n])),r=[];return e.forEach(n=>{const a=s.classPrivateFieldGet2(w,this).defaultQueryOptions(n),c=t.get(a.queryHash);c?r.push({defaultedQueryOptions:a,observer:c}):r.push({defaultedQueryOptions:a,observer:new E(s.classPrivateFieldGet2(w,this),a)})}),r}function A(e,t){const r=s.classPrivateFieldGet2(f,this).indexOf(e);r!==-1&&(s.classPrivateFieldSet2(v,this,me(s.classPrivateFieldGet2(v,this),r,t)),s.assertClassBrand(d,this,z).call(this))}function z(){if(this.hasListeners()){var e;const t=s.classPrivateFieldGet2(b,this),r=s.assertClassBrand(d,this,H).call(this,s.classPrivateFieldGet2(v,this),s.classPrivateFieldGet2(C,this)),n=s.assertClassBrand(d,this,V).call(this,r,(e=s.classPrivateFieldGet2(O,this))===null||e===void 0?void 0:e.combine);t!==n&&_.batch(()=>{this.listeners.forEach(a=>{a(s.classPrivateFieldGet2(v,this))})})}}var ye=class extends E{constructor(e,t){super(e,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e){super.setOptions({...e,behavior:q()})}getOptimisticResult(e){return e.behavior=q(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,t){var r;const{state:n}=e,a=super.createResult(e,t),{isFetching:c,isRefetching:l,isError:i,isRefetchError:o}=a,u=(r=n.fetchMeta)===null||r===void 0||(r=r.fetchMore)===null||r===void 0?void 0:r.direction,R=i&&u==="forward",m=c&&u==="forward",G=i&&u==="backward",F=c&&u==="backward";return{...a,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:ue(t,n.data),hasPreviousPage:he(t,n.data),isFetchNextPageError:R,isFetchingNextPage:m,isFetchPreviousPageError:G,isFetchingPreviousPage:F,isRefetchError:o&&!R&&!G,isRefetching:l&&!m&&!F}}},g=K(J());function Se({queries:e,...t},r){const n=ae(r),a=ie(),c=ne(),l=g.useMemo(()=>e.map(h=>{const P=n.defaultQueryOptions(h);return P._optimisticResults=a?"isRestoring":"optimistic",P}),[e,n,a]);l.forEach(h=>{Z(h),Y(h,c)}),re(c);const[i]=g.useState(()=>new Fe(n,l,t)),[o,u,R]=i.getOptimisticResult(l,t.combine),m=!a&&t.subscribed!==!1;g.useSyncExternalStore(g.useCallback(h=>m?i.subscribe(_.batchCalls(h)):ee,[i,m]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),g.useEffect(()=>{i.setQueries(l,t)},[l,t,i]);const F=o.some((h,P)=>N(l[P],h))?o.flatMap((h,P)=>{const p=l[P];if(p){const B=new E(n,p);if(N(p,h))return x(p,B,c);oe(h,a)&&x(p,B,c)}return[]}):[];if(F.length>0)throw Promise.all(F);const y=o.find((h,P)=>{const p=l[P];return p&&$({result:h,errorResetBoundary:c,throwOnError:p.throwOnError,query:n.getQueryCache().get(p.queryHash),suspense:p.suspense})});if(y!=null&&y.error)throw y.error;return u(R())}function Oe(e,t){return se(e,ye,t)}function we(e,t,{callOptions:r,transport:n,pageParamKey:a}){return async c=>{T(t!==Q,"Disabled query cannot be fetched"),T("pageParam"in c,"pageParam must be part of context");const l={...t,[a]:c.pageParam};return de(e,l,{callOptions:{...r,signal:(r==null?void 0:r.signal)??c.signal},transport:n})}}function Re(e,t,{transport:r,getNextPageParam:n,pageParamKey:a,callOptions:c}){const l=fe(e,t===Q?void 0:{...t,[a]:void 0});return{getNextPageParam:n,initialPageParam:t===Q?void 0:t[a],queryKey:l,queryFn:we(e,t,{transport:r,callOptions:c,pageParamKey:a}),enabled:t!==Q}}function Qe(e,t,{transport:r,callOptions:n,pageParamKey:a,getNextPageParam:c,...l}){const i=be(),o=Re(e,t,{transport:r??i,getNextPageParam:c,pageParamKey:a,callOptions:n}),u=o.enabled&&(l.enabled??!0);return Oe({...l,...o,enabled:u})}le();function Te(e,t){return pe(L,e,{transport:I,enabled:!!e&&!t,placeholderData:j})}function De(e,t){return Qe(L,e,{transport:I,enabled:!t,pageParamKey:"pageToken",getNextPageParam:r=>r.nextPageToken,placeholderData:j})}function Ue(e,t){const r=(0,g.useMemo)(()=>Object.keys(e).flatMap(n=>{const a=e[Number(n)];return a?Object.keys(a).map(c=>{const l=a[c];if(!l)return;const[i,o]=[W(l.token0),W(l.token1)],u=ce.getAddress(i,o);return ve(ge,t?{chainId:Number(n),protocolVersion:Pe.V2,pairAddress:u,owner:t}:void 0,{transport:I})}):[]}).filter(Ce),[e,t]);return Se({queries:r})}function Ce(e){return e!==void 0}export{Ue as useGetPositionsForPairs,De as useGetPositionsInfiniteQuery,Te as useGetPositionsQuery};
