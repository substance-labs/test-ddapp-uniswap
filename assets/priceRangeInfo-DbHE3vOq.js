import{CurrencyAmount as q,Price as w,ZERO_ADDRESS as L,init_jsbi as U,init_sdk_core_esm as j,jsbi_default as v}from"./utils-BX1Fu73x.js";import{Pool as F,init_v4_sdk_esm as Z,priceToClosestTick as x}from"./V3DutchOrderTrade-Cl7yELmp.js";import{Pool as z,TickMath as a,encodeSqrtRatioX96 as X,init_v3_sdk_esm as G,nearestUsableTick as P,priceToClosestTick as H}from"./v3-sdk.esm-CHH6GWR1.js";import{Pair as J,init_v2_sdk_esm as W}from"./v2-sdk.esm-CIiDMO7F.js";import{ProtocolVersion as f}from"./types_pb-yZxlo4b1.js";import{tryParseCurrencyAmount as S}from"./tryParseCurrencyAmount-Bt3FPZDG.js";import{getBaseAndQuoteCurrencies as h}from"./currency-Brc-ymXr.js";import{getTickToPrice as V,getV4TickToPrice as M,tryParsePrice as Y,tryParseTick as A}from"./getTickToPrice-BudeFeQp.js";j();W();G();Z();U();function B({lowerTick:e,upperTick:n,tickSpaceLimits:r,priceInverted:i,fullRange:t}){return t?[!0,!0]:i?[n===r[1],e===r[0]]:[e===r[0],n===r[1]]}function _({priceInverted:e,sortedCurrencies:n,initialPrice:r}){const{TOKEN0:i,TOKEN1:t}=n,c=S(r,e?i:t);if(!c)return;const l=S("1",e?t:i),o=l?new w(l.currency,c.currency,l.quotient,c.quotient):void 0;return e?o==null?void 0:o.invert():o}function Q(e){const{type:n,pool:r,currency0:i,priceInverted:t}=e;if(!r||!i)return;const c=(n===f.V4,r.priceOf(i));return t?c.invert():c}function $(e){const n=e?X(e.numerator,e.denominator):void 0;return!!e&&!!n&&!(v.greaterThanOrEqual(n,a.MIN_SQRT_RATIO)&&v.lessThan(n,a.MAX_SQRT_RATIO))}function ee({baseToken:e,quoteToken:n,fee:r,price:i,invalidPrice:t}){if(!e||!n||!i||t)return;const c=new w(i.baseCurrency.wrapped,i.quoteCurrency.wrapped,i.denominator,i.numerator),l=H(c),o=a.getSqrtRatioAtTick(l);return new z(e,n,r,o,v.BigInt(0),l,[])}function ne({baseToken:e,quoteToken:n,fee:r,hook:i,price:t,invalidPrice:c}){if(!e||!n||!t||c)return;const l=x(t),o=a.getSqrtRatioAtTick(l);return new F(e,n,r.feeAmount,r.tickSpacing,i??L,o,v.BigInt(0),l)}function re(e){if(e)return new J(q.fromRawAmount(e.quoteCurrency.wrapped,e.numerator),q.fromRawAmount(e.baseCurrency.wrapped,e.denominator))}function me({ticks:e,poolOrPair:n}){if(!e||!n||!("tickCurrent"in n))return{TOKEN0:!1,TOKEN1:!1};const[r,i]=e,t=typeof i=="number"&&n.tickCurrent>=i,c=typeof r=="number"&&n.tickCurrent<=r;return{TOKEN0:t,TOKEN1:c}}function ve({derivedPositionInfo:e,state:n,positionState:r}){return e.protocolVersion===f.V2?ie({state:n,derivedPositionInfo:e}):e.protocolVersion===f.V3?oe({state:n,positionState:r,derivedPositionInfo:e}):ce({state:n,positionState:r,derivedPositionInfo:e})}function ie({state:e,derivedPositionInfo:n}){const{currencies:{sdk:r}}=n,i=_({priceInverted:e.priceInverted,sortedCurrencies:r,initialPrice:e.initialPrice});return{protocolVersion:f.V2,price:i,mockPair:re(i)}}function oe({state:e,positionState:n,derivedPositionInfo:r}){var i,t;const{fee:c}=n,{protocolVersion:l,currencies:{sdk:o}}=r,{baseCurrency:g,quoteCurrency:s}=h(o,e.priceInverted),k=r.creatingPoolOrPair?_({priceInverted:e.priceInverted,sortedCurrencies:o,initialPrice:e.initialPrice}):Q({type:f.V3,pool:r.pool,currency0:o.TOKEN0,priceInverted:e.priceInverted}),E=$(k),N=ee({baseToken:g,quoteToken:s,fee:c.feeAmount,price:k,invalidPrice:E}),p=[P(a.MIN_TICK,c.tickSpacing),P(a.MAX_TICK,c.tickSpacing)],[R,I]=e.priceInverted?[e.maxPrice,e.minPrice]:[e.minPrice,e.maxPrice],u=R===""||e.fullRange?p[0]:e.priceInverted?A({baseToken:o.TOKEN1,quoteToken:o.TOKEN0,feeAmount:c.feeAmount,value:e.maxPrice}):A({baseToken:o.TOKEN0,quoteToken:o.TOKEN1,feeAmount:c.feeAmount,value:e.minPrice}),d=I===""||e.fullRange?p[1]:e.priceInverted?A({baseToken:o.TOKEN1,quoteToken:o.TOKEN0,feeAmount:c.feeAmount,value:e.minPrice}):A({baseToken:o.TOKEN0,quoteToken:o.TOKEN1,feeAmount:c.feeAmount,value:e.maxPrice}),O=[u,d],y=B({lowerTick:u,upperTick:d,tickSpaceLimits:p,fullRange:e.fullRange,priceInverted:e.priceInverted});let T=[V({baseToken:o.TOKEN0,quoteToken:o.TOKEN1,tick:O[0]}),V({baseToken:o.TOKEN0,quoteToken:o.TOKEN1,tick:O[1]})];return T=e.priceInverted?[(i=T[1])===null||i===void 0?void 0:i.invert(),(t=T[0])===null||t===void 0?void 0:t.invert()]:[T[0],T[1]],{protocolVersion:l,ticks:O,ticksAtLimit:y,price:k,pricesAtTicks:T,mockPool:N}}function K({baseToken:e,quoteToken:n,value:r,tickSpacing:i}){if(!e||!n||!r||!i)return;const t=Y({baseToken:e,quoteToken:n,value:r});if(!t)return;let c;const l=X(t.numerator,t.denominator);return v.greaterThanOrEqual(l,a.MAX_SQRT_RATIO)?c=a.MAX_TICK:v.lessThanOrEqual(l,a.MIN_SQRT_RATIO)?c=a.MIN_TICK:c=x(t),P(c,i)}function ce({state:e,positionState:n,derivedPositionInfo:r}){var i,t;const{fee:c,hook:l,initialPosition:o}=n,{protocolVersion:g,currencies:{sdk:s},pool:k}=r,{baseCurrency:E,quoteCurrency:N}=h(s,e.priceInverted),p=r.creatingPoolOrPair?_({priceInverted:e.priceInverted,sortedCurrencies:s,initialPrice:e.initialPrice}):Q({type:f.V4,pool:k,currency0:s.TOKEN0,priceInverted:e.priceInverted}),R=$(p),I=ne({baseToken:E,quoteToken:N,fee:c,hook:l,price:p,invalidPrice:R}),u=k??I,d=o!=null&&o.tickLower&&o.tickUpper?[o.tickLower,o.tickUpper]:[u?P(a.MIN_TICK,u.tickSpacing):void 0,u?P(a.MAX_TICK,u.tickSpacing):void 0],[O,y]=e.priceInverted?[e.maxPrice,e.minPrice]:[e.minPrice,e.maxPrice],T=O===""||o!=null&&o.isOutOfRange||e.fullRange?d[0]:e.priceInverted?K({baseToken:s.TOKEN1,quoteToken:s.TOKEN0,value:e.maxPrice,tickSpacing:u==null?void 0:u.tickSpacing}):K({baseToken:s.TOKEN0,quoteToken:s.TOKEN1,value:e.minPrice,tickSpacing:u==null?void 0:u.tickSpacing}),b=y===""||o!=null&&o.isOutOfRange||e.fullRange?d[1]:e.priceInverted?K({baseToken:s.TOKEN1,quoteToken:s.TOKEN0,value:e.minPrice,tickSpacing:u==null?void 0:u.tickSpacing}):K({baseToken:s.TOKEN0,quoteToken:s.TOKEN1,value:e.maxPrice,tickSpacing:u==null?void 0:u.tickSpacing}),C=[T,b],D=B({lowerTick:T,upperTick:b,tickSpaceLimits:d,fullRange:e.fullRange,priceInverted:e.priceInverted});let m=[M({baseCurrency:s.TOKEN0,quoteCurrency:s.TOKEN1,tick:C[0]}),M({baseCurrency:s.TOKEN0,quoteCurrency:s.TOKEN1,tick:C[1]})];return m=e.priceInverted?[(i=m[1])===null||i===void 0?void 0:i.invert(),(t=m[0])===null||t===void 0?void 0:t.invert()]:[m[0],m[1]],{protocolVersion:g,ticks:C,ticksAtLimit:D,price:p,pricesAtTicks:m,mockPool:I}}function te(e,n){return typeof e=="number"&&typeof n=="number"&&e>=n}function fe({poolOrPair:e,lowerTick:n,upperTick:r}){const i=e&&"tickCurrent"in e?e.tickCurrent:void 0;return te(n,r)||typeof i!="number"||typeof n!="number"||typeof r!="number"?!1:i<n||i>r}export{me as getFieldsDisabled,ve as getPriceRangeInfo,$ as isInvalidPrice,te as isInvalidRange,fe as isOutOfRange};
