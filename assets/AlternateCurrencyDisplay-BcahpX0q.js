import{__toESM as A}from"./chunk-DgAfPHQg.js";import{require_react as x}from"./react-CNoFhWkx.js";import{Path as _,Svg as I,ThemeableStack as P,createIcon as b,useSporeColors as j}from"./src-DOOtfpHS.js";import{ReactQueryCacheKey as k}from"./cache-BFZkIToX.js";import{require_jsx_runtime as R}from"./jsx-runtime-D7bMTQeG.js";import{logger as q}from"./hooks-BXO4d1DJ.js";import{getPrimaryStablecoin as U}from"./utils-BX1Fu73x.js";import{currencyAddress as L,currencyId as M,isSVMChain as N}from"./currencyId-Ci6selsx.js";import{InterfaceEventName as D}from"./interface-BdpC4qOF.js";import{useQuery as $}from"./useQuery-D_ZCw8XG.js";import{erc20_default as F}from"./erc20-CdGGKIp0.js";import{getContract as W}from"./getContract-CMwwszTa.js";import{sendAnalyticsEvent as z}from"./send.web-CrSXW2rw.js";import{useUSDCPrice as V}from"./useUSDCPrice-HO7Wgroz.js";import{TransactionType as B}from"./transactionDetails-BsNW_jus.js";import{NumberType as C}from"./types-JuyYLR0O.js";import{useAppFiatCurrency as H,useLocalizationContext as g}from"./LocalizationContext-B31peW1_.js";import{useSupportedChainId as S}from"./useSupportedChainId-DskHoisQ.js";import{useEthersProvider as K}from"./useEthersProvider-CBgc_azi.js";import{useAccount as Q}from"./useAccount-C5hwiBwN.js";import{useSwitchChain as Z}from"./useSwitchChain-CY8eYAUF.js";import{UserRejectedRequestError as y,toReadableError as Y}from"./errors-BaezSPLl.js";import{didUserReject as G}from"./swapErrorToUserReadableMessage-DgHZMHU-.js";import{Flex as J,Text as O,styled as X}from"./Loader-D83W8G1W.js";import{useTransactionAdder as rr}from"./hooks-BA_A7Su9.js";import{ClickableTamaguiStyle as tr}from"./clickable-D5qUCIhr.js";import{AssetType as or}from"./assets-D-uPpcBZ.js";import{tryParseCurrencyAmount as T}from"./tryParseCurrencyAmount-Bt3FPZDG.js";import{ReversedArrowsIcon as er}from"./iconExports-DR2SoqU0.js";const w=(r,{tokens:e})=>{const t=e.size[r]??r,o=e.size[r]??r;return{width:t,height:o,minWidth:t,maxWidth:t,maxHeight:o,minHeight:o}},$r=X(P,{name:"Square",alignItems:"center",justifyContent:"center",variants:{size:{"...size":w,":number":w}}});var f=A(R());const[Fr,Wr]=b({name:"TimePast",getIcon:r=>(0,f.jsx)(I,{viewBox:"0 0 16 16",fill:"none",...r,children:(0,f.jsx)(_,{d:"M8.66643 5.33325V7.72388L9.80445 8.8619C10.0651 9.12256 10.0651 9.54394 9.80445 9.80461C9.67445 9.93461 9.50376 9.99992 9.3331 9.99992C9.16243 9.99992 8.99174 9.93461 8.86174 9.80461L7.52841 8.47127C7.40307 8.34594 7.3331 8.17659 7.3331 7.99992V5.33325C7.3331 4.96525 7.6311 4.66659 7.99976 4.66659C8.36843 4.66659 8.66643 4.96525 8.66643 5.33325ZM8.01701 1.33325C6.23701 1.33325 4.56576 2.05187 3.33309 3.28654V1.99992C3.33309 1.63192 3.03509 1.33325 2.66643 1.33325C2.29776 1.33325 1.99976 1.63192 1.99976 1.99992L1.99976 4.66659C1.99976 5.03459 2.29776 5.33325 2.66643 5.33325L5.3331 5.33325C5.70176 5.33325 5.99976 5.03459 5.99976 4.66659C5.99976 4.29859 5.70176 3.99992 5.3331 3.99992H4.50709C5.46575 3.15125 6.70635 2.66659 8.01701 2.66659C10.9477 2.66659 13.3331 5.05925 13.3331 7.99992C13.3331 10.9406 10.9483 13.3333 8.01701 13.3333C5.98035 13.3333 4.15974 12.1993 3.26441 10.3733C3.10308 10.0426 2.70382 9.90529 2.37248 10.068C2.04182 10.23 1.9058 10.6292 2.0678 10.9599C3.18846 13.2465 5.46835 14.6666 8.01701 14.6666C11.683 14.6666 14.6664 11.6759 14.6664 7.99992C14.6664 4.32392 11.683 1.33325 8.01701 1.33325Z",fill:"currentColor"})})});var v=A(x());function zr({currencyAmount:r,recipient:e,transactionRequest:t,gasFee:o}){const n=Q(),i=(0,v.useRef)(n);i.current=n;const c=K({chainId:n.chainId}),a=(0,v.useRef)(c);a.current=c;const s=rr(),p=Z(),u=S(t==null?void 0:t.chainId);return(0,v.useCallback)(async()=>{if(!t)throw new Error("missing to transaction to execute");if(!r)throw new Error("missing currency amount to send");if(!e)throw new Error("missing recipient");if(!u)throw new Error("missing chainId in transactionRequest");if(N(u))throw new Error("Solana send is not supported");try{const d=await(async()=>{try{const m=i.current;let l=a.current;if(m.status!=="connected")throw new Error("wallet must be connected to send");if(m.chainId!==u&&(await p(u),l=a.current),!l)throw new Error("missing provider");return await l.getSigner().sendTransaction({...t,...o==null?void 0:o.params})}catch(m){throw G(m)?new y("Transfer failed: User rejected signature"):m}})(),h={type:B.Send,tokenAddress:L(r.currency),assetType:or.Currency,currencyAmountRaw:r.quotient.toString(),recipient:e};s(d,h),z(D.SendInitiated,{currencyId:M(r.currency),amount:h.currencyAmountRaw??"",recipient:h.recipient})}catch(d){throw d instanceof y?d:Y("Transfer failed:",d)}},[s,r,o==null?void 0:o.params,e,u,p,t])}const nr=2,ir=2;function Vr({isFiatInput:r,exactAmount:e,exactCurrency:t}){const{price:o,isLoading:n}=V(t),{convertFiatAmount:i,formatCurrencyAmount:c}=g(),a=i(1).amount,s=S(t==null?void 0:t.chainId);return(0,v.useMemo)(()=>{if(!t||!o)return{formattedAmount:void 0,loading:n};if(r){const m=(parseFloat(e||"0")/a).toFixed(nr),l=s?T(m,U(s)):void 0,E=l?o.invert().quote(l):void 0;return{formattedAmount:c({value:E,type:C.SwapTradeAmount,placeholder:""}),loading:n}}const p=T(e||"0",t),u=p?o.quote(p):void 0,d=i(parseFloat((u==null?void 0:u.toExact())??"0")).amount;return{formattedAmount:d?d.toFixed(ir):"0",loading:n}},[a,i,e,t,c,r,o,n,s])}function Br(r){var e,t;const o=(0,v.useCallback)(()=>cr(r),[r]);return $({queryFn:o,queryKey:[k.CreateTransferTransaction,r==null?void 0:r.account,r==null?void 0:r.chainId,r==null||(e=r.currencyAmount)===null||e===void 0?void 0:e.toExact(),r==null||(t=r.currencyAmount)===null||t===void 0?void 0:t.currency,r==null?void 0:r.toAddress]}).data}async function cr(r){if(!r)return null;const{provider:e,account:t,chainId:o,currencyAmount:n,toAddress:i}=r;if(!e||!t||!o||!n||!i)return null;const c=n.currency,a={provider:e,account:t,chainId:o,toAddress:i,tokenAddress:c.isNative?"":c.address,amountInWei:n.quotient.toString()};return c.isNative?ar(a):sr(a)}function ar(r){const{account:e,toAddress:t,amountInWei:o,chainId:n}=r;return{from:e,to:t,value:o,chainId:n}}async function sr(r){const{provider:e,account:t,chainId:o,toAddress:n,tokenAddress:i,amountInWei:c}=r,a=W({address:i,ABI:F,provider:e,account:t});try{return{...await a.populateTransaction.transfer(n,c,{from:t}),chainId:o}}catch(s){q.error(s,{tags:{file:"transfer",function:"getTokenTransferRequest"},extra:{transferParams:r}})}return null}const Hr=({inputCurrency:r,inputInFiat:e,exactAmountOut:t,disabled:o,onToggle:n})=>{const{formatNumberOrString:i}=g(),c=H(),a=j(),s=e?`${i({value:t||"0",type:C.TokenNonTx})} ${r==null?void 0:r.symbol}`:i({value:t||"0",type:C.PortfolioBalance,currencyCode:c});return r?(0,f.jsxs)(J,{row:!0,alignItems:"center",justifyContent:"center",gap:"$gap4",onPress:o?void 0:n,...o?{}:tr,children:[(0,f.jsx)(O,{variant:"body2",color:"$neutral2",children:s}),(0,f.jsx)(er,{color:a.neutral2.val,size:"16px"})]}):null};export{Hr as AlternateCurrencyDisplay,$r as Square,Fr as TimePast,w as getShapeSize,Br as useCreateTransferTransaction,zr as useSendCallback,Vr as useUSDTokenUpdater};
