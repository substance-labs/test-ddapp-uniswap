import{__toESM as Te}from"./chunk-DgAfPHQg.js";import{require_react as ye}from"./react-CNoFhWkx.js";import{Trans as F}from"./src-DOOtfpHS.js";import{useTranslation as Ie}from"./useTranslation-BotBuoJf.js";import{useSearchParams as Se}from"./chunk-QMGIS6GS-B91ZVkXt.js";import{require_jsx_runtime as ge}from"./jsx-runtime-D7bMTQeG.js";import{CurrencyAmount as Ye,Price as Me,Rounding as ke,init_jsbi as Be,init_sdk_core_esm as Le,jsbi_default as oe}from"./utils-BX1Fu73x.js";import{BIG_INT_ZERO as Ce}from"./misc-BMnlqqV4.js";import{init_v4_sdk_esm as we,tickToPrice as Oe}from"./V3DutchOrderTrade-Cl7yELmp.js";import{Pool as he,Position as te,TICK_SPACINGS as re,TickMath as W,encodeSqrtRatioX96 as Fe,init_v3_sdk_esm as We,nearestUsableTick as fe,priceToClosestTick as De,tickToPrice as je}from"./v3-sdk.esm-CHH6GWR1.js";import{useAccount as xe}from"./useAccount-C5hwiBwN.js";import{useCurrencyBalances as Ke}from"./useCurrencyBalance-BuHM_Z2M.js";import{Bound as k,Field as t,setFullRange as $e,typeInput as ve,typeLeftRangeInput as Ve,typeRightRangeInput as Xe,typeStartPriceInput as Qe}from"./actions-Budqlwp-.js";import{useAppDispatch as _e,useAppSelector as Ge}from"./hooks-Muz170pO.js";import{tryParseCurrencyAmount as ne}from"./tryParseCurrencyAmount-Bt3FPZDG.js";import{PoolState as ie,usePool as He}from"./usePools-Bz9FGvMj.js";import{getTickToPrice as X,tryParseTick as Q}from"./getTickToPrice-BudeFeQp.js";import{useSwapTaxes as Ze}from"./useSwapTaxes-CDZk7xg5.js";Le();We();we();Be();var i=Te(ye()),D=Te(ge());function ze(){return Ge(o=>o.mintV3)}function vo(o){const e=_e(),r=(0,i.useCallback)(d=>{e(ve({field:t.CURRENCY_A,typedValue:d,noLiquidity:o===!0}))},[e,o]),f=(0,i.useCallback)(d=>{e(ve({field:t.CURRENCY_B,typedValue:d,noLiquidity:o===!0}))},[e,o]),[s,a]=Se(),n=(0,i.useCallback)(d=>{e(Ve({typedValue:d}));const T=s.get("minPrice");(!T||T&&T!==d)&&(s.set("minPrice",d),a(s))},[e,s,a]),c=(0,i.useCallback)(d=>{e(Xe({typedValue:d}));const T=s.get("maxPrice");(!T||T&&T!==d)&&(s.set("maxPrice",d),a(s))},[e,s,a]),S=(0,i.useCallback)(d=>{e(Qe({typedValue:d}))},[e]);return{onFieldAInput:r,onFieldBInput:f,onLeftRangeInput:n,onRightRangeInput:c,onStartPriceInput:S}}function To({currencyA:o,currencyB:e,feeAmount:r,baseCurrency:f,existingPosition:s}){var a,n,c,S;const{t:d}=Ie(),T=xe(),{independentField:g,typedValue:L,leftRangeTypedValue:m,rightRangeTypedValue:M,startPriceTypedValue:j}=ze(),w=g===t.CURRENCY_A?t.CURRENCY_B:t.CURRENCY_A,N=(0,i.useMemo)(()=>({[t.CURRENCY_A]:o,[t.CURRENCY_B]:e}),[o,e]),[R,C,G]=(0,i.useMemo)(()=>[o==null?void 0:o.wrapped,e==null?void 0:e.wrapped,f==null?void 0:f.wrapped],[o,e,f]),[l,v]=(0,i.useMemo)(()=>R&&C?R.sortsBefore(C)?[R,C]:[C,R]:[void 0,void 0],[R,C]),se=Ke(T.address,(0,i.useMemo)(()=>[N[t.CURRENCY_A],N[t.CURRENCY_B]],[N])),H={[t.CURRENCY_A]:se[0],[t.CURRENCY_B]:se[1]},[x,O]=He({currencyA:N[t.CURRENCY_A],currencyB:N[t.CURRENCY_B],feeAmount:r}),Z=x===ie.NOT_EXISTS,P=!!(G&&l&&!G.equals(l)),b=(0,i.useMemo)(()=>{if(Z){const p=ne(j,P?l:v);if(p&&l&&v){const U=ne("1",P?v:l),I=U?new Me(U.currency,p.currency,U.quotient,p.quotient):void 0;return(P?I==null?void 0:I.invert():I)??void 0}return}else return O&&l?O.priceOf(l):void 0},[Z,j,P,v,l,O]),z=(0,i.useMemo)(()=>{const p=b?Fe(b.numerator,b.denominator):void 0;return b&&p&&!(oe.greaterThanOrEqual(p,W.MIN_SQRT_RATIO)&&oe.lessThan(p,W.MAX_SQRT_RATIO))},[b]),Ee=(0,i.useMemo)(()=>{if(R&&C&&r&&b&&!z){const p=De(b),U=W.getSqrtRatioAtTick(p);return new he(R,C,r,U,oe.BigInt(0),p,[])}else return},[r,z,b,R,C]),u=O??Ee,A=(0,i.useMemo)(()=>({[k.LOWER]:r?fe(W.MIN_TICK,re[r]):void 0,[k.UPPER]:r?fe(W.MAX_TICK,re[r]):void 0}),[r]),h=(0,i.useMemo)(()=>({[k.LOWER]:typeof(s==null?void 0:s.tickLower)=="number"?s.tickLower:P&&typeof M=="boolean"||!P&&typeof m=="boolean"?A[k.LOWER]:P?Q({baseToken:v,quoteToken:l,feeAmount:r,value:M.toString()}):Q({baseToken:l,quoteToken:v,feeAmount:r,value:m.toString()}),[k.UPPER]:typeof(s==null?void 0:s.tickUpper)=="number"?s.tickUpper:!P&&typeof M=="boolean"||P&&typeof m=="boolean"?A[k.UPPER]:P?Q({baseToken:v,quoteToken:l,feeAmount:r,value:m.toString()}):Q({baseToken:l,quoteToken:v,feeAmount:r,value:M.toString()})}),[s,r,P,m,M,l,v,A]),{[k.LOWER]:_,[k.UPPER]:E}=h,Pe=(0,i.useMemo)(()=>({[k.LOWER]:r&&_===A.LOWER,[k.UPPER]:r&&E===A.UPPER}),[A,_,E,r]),Y=typeof _=="number"&&typeof E=="number"&&_>=E,be=(0,i.useMemo)(()=>({[k.LOWER]:X({baseToken:l,quoteToken:v,tick:A.LOWER}),[k.UPPER]:X({baseToken:l,quoteToken:v,tick:A.UPPER})}),[l,v,A.LOWER,A.UPPER]),ue=(0,i.useMemo)(()=>({[k.LOWER]:X({baseToken:l,quoteToken:v,tick:h[k.LOWER]}),[k.UPPER]:X({baseToken:l,quoteToken:v,tick:h[k.UPPER]})}),[l,v,h]),{[k.LOWER]:ae,[k.UPPER]:ce}=ue,J=!!(!Y&&b&&ae&&ce&&(b.lessThan(ae)||b.greaterThan(ce))),q=ne(L,N[g]),ee=(0,i.useMemo)(()=>{const p=q==null?void 0:q.wrapped,U=w===t.CURRENCY_B?e:o;if(q&&p&&typeof _=="number"&&typeof E=="number"&&u){if(J||Y)return;const I=p.currency.equals(u.token0)?te.fromAmount0({pool:u,tickLower:_,tickUpper:E,amount0:q.quotient,useFullPrecision:!0}):te.fromAmount1({pool:u,tickLower:_,tickUpper:E,amount1:q.quotient}),V=p.currency.equals(u.token0)?I.amount1:I.amount0;return U&&Ye.fromRawAmount(U,V.quotient)}},[q,J,w,e,o,_,E,u,Y]),B=(0,i.useMemo)(()=>({[t.CURRENCY_A]:g===t.CURRENCY_A?q:ee,[t.CURRENCY_B]:g===t.CURRENCY_A?ee:q}),[ee,q,g]),K=!!(typeof E=="number"&&u&&u.tickCurrent>=E),$=!!(typeof _=="number"&&u&&u.tickCurrent<=_),le=Y||!!(K&&u&&R&&u.token0.equals(R)||$&&u&&R&&u.token1.equals(R)),de=Y||!!(K&&u&&C&&u.token0.equals(C)||$&&u&&C&&u.token1.equals(C)),{inputTax:Ue,outputTax:Ne}=Ze({inputTokenAddress:o!=null&&o.isToken?o.address:void 0,outputTokenAddress:e!=null&&e.isToken?e.address:void 0,tokenChainId:T.chainId}),Ae=(0,i.useMemo)(()=>{var p,U;if(!u||!R||!C||typeof _!="number"||typeof E!="number"||Y)return;const I=K?Ce:(p=B[R.equals(u.token0)?t.CURRENCY_A:t.CURRENCY_B])===null||p===void 0?void 0:p.quotient,V=$?Ce:(U=B[R.equals(u.token0)?t.CURRENCY_B:t.CURRENCY_A])===null||U===void 0?void 0:U.quotient;if(I!==void 0&&V!==void 0)return te.fromAmounts({pool:u,tickLower:_,tickUpper:E,amount0:I,amount1:V,useFullPrecision:!0})},[B,u,R,C,K,$,Y,_,E]);let y;T.isConnected||(y=d("common.connectWallet.button")),x===ie.INVALID&&(y=y??(0,D.jsx)(F,{i18nKey:"common.invalidPair"})),z&&(y=y??(0,D.jsx)(F,{i18nKey:"mint.v3.input.invalidPrice.error"})),(!B[t.CURRENCY_A]&&!le||!B[t.CURRENCY_B]&&!de)&&(y=y??(0,D.jsx)(F,{i18nKey:"common.noAmount.error"}));const{[t.CURRENCY_A]:me,[t.CURRENCY_B]:Re}=B;me&&(!((a=H[t.CURRENCY_A])===null||a===void 0)&&a.lessThan(me))&&(y=(0,D.jsx)(F,{i18nKey:"common.insufficientTokenBalance.error",values:{tokenSymbol:(n=N[t.CURRENCY_A])===null||n===void 0?void 0:n.symbol}})),Re&&(!((c=H[t.CURRENCY_B])===null||c===void 0)&&c.lessThan(Re))&&(y=(0,D.jsx)(F,{i18nKey:"common.insufficientTokenBalance.error",values:{tokenSymbol:(S=N[t.CURRENCY_B])===null||S===void 0?void 0:S.symbol}}));const pe=Ue.greaterThan(0)||Ne.greaterThan(0),qe=x===ie.INVALID||pe;return{dependentField:w,currencies:N,pool:O,poolState:x,currencyBalances:H,parsedAmounts:B,ticks:h,price:b,pricesAtTicks:ue,pricesAtLimit:be,position:Ae,noLiquidity:Z,errorMessage:y,invalidPool:qe,invalidRange:Y,outOfRange:J,depositADisabled:le,depositBDisabled:de,invertPrice:P,ticksAtLimit:Pe,isTaxed:pe}}function _o(o){const{baseCurrency:e,quoteCurrency:r,tickLower:f,tickUpper:s,pool:a}=o;let n,c;if("feeAmount"in o)c=o.feeAmount,n=o.feeAmount?re[o.feeAmount]:void 0;else if("fee"in o){var S,d;c=(S=o.fee)===null||S===void 0?void 0:S.feeAmount,n=(d=o.fee)===null||d===void 0?void 0:d.tickSpacing}const T=_e(),g=(0,i.useMemo)(()=>e==null?void 0:e.wrapped,[e]),L=(0,i.useMemo)(()=>r==null?void 0:r.wrapped,[r]),m=(0,i.useCallback)(C=>"feeAmount"in o?!g||!L?"":je(g,L,C).toSignificant(5,void 0,ke.ROUND_UP):!e||!r?"":Oe(e,r,C).toSignificant(5,void 0,ke.ROUND_UP),[e,g,o,r,L]),M=(0,i.useCallback)(()=>typeof f=="number"&&c&&n?m(f-n):typeof f!="number"&&c&&a&&n?m(a.tickCurrent-n):"",[f,c,n,a,m]),j=(0,i.useCallback)(()=>typeof f=="number"&&c&&n?m(f+n):typeof f!="number"&&c&&a&&n?m(a.tickCurrent+n):"",[f,c,n,a,m]),w=(0,i.useCallback)(()=>typeof s=="number"&&c&&n?m(s-n):typeof s!="number"&&c&&a&&n?m(a.tickCurrent-n):"",[s,c,n,a,m]),N=(0,i.useCallback)(()=>typeof s=="number"&&c&&n?m(s+n):typeof s!="number"&&c&&a&&n?m(a.tickCurrent+n):"",[s,c,n,a,m]),R=(0,i.useCallback)(()=>{T($e())},[T]);return{getDecrementLower:M,getIncrementLower:j,getDecrementUpper:w,getIncrementUpper:N,getSetFullRange:R}}export{_o as useRangeHopCallbacks,To as useV3DerivedMintInfo,vo as useV3MintActionHandlers};
