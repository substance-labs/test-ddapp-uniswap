import{__toESM as v}from"./chunk-DgAfPHQg.js";import{logger as h}from"./hooks-BXO4d1DJ.js";import{RPCType as l,UniverseChainId as P,getChainInfo as d}from"./utils-BX1Fu73x.js";import{BigNumber as E,init_lib$5 as R}from"./lib-DPFIyRke.js";import{id as _,init_lib as A,init_lib$2 as N,resolveProperties as T}from"./lib-CKG8APVv.js";import{fetchJson as w,init_lib as U}from"./lib-BncBk3QF.js";import{JsonRpcProvider as F,init_lib as L}from"./lib-Dj-AwQVD.js";import{getExperimentValue as m}from"./hooks-Bp0VtWbX.js";import{require_ethers as S}from"./ethers-D2SIY1xg.js";import{z as i}from"./timing-DsWr56iv.js";import{Experiments as p,PrivateRpcProperties as b}from"./experiments-rc6XUB0U.js";const g="https://rpc.flashbots.net/fast?originId=uniswapwallet",C=50,x="X-Flashbots-Signature",k=!0,D=10,B=4e3,rr=25*12e3/B,tr=i.object({status:i.enum(["UNKNOWN","PENDING","INCLUDED","FAILED","CANCELLED"]),hash:i.string(),maxBlockNumber:i.number(),transaction:i.object({from:i.string(),to:i.string(),gasLimit:i.string(),maxFeePerGas:i.string(),maxPriorityFeePerGas:i.string(),nonce:i.string(),value:i.string()}),fastMode:i.boolean(),seenInMempool:i.boolean(),simError:i.string().optional()});function $({baseUrl:r=g,address:e,refundPercent:o}){const t=O(e,o),n=`&blockRange=${D}`;return`${r}${t}${n}`}function O(r,e){return!r||!e||e<0||e>100?"":`&refund=${r}:${e}`}R();A();N();L();U();var H=class extends F{constructor(r){super(r.url,r.network),this.signer=r.signer}},M=class extends H{constructor({signerInfo:r,refundPercent:e,network:o}){const t=$({address:r==null?void 0:r.address,refundPercent:e});super({url:t,signer:r==null?void 0:r.signer,network:o}),this.signatureHeaderName=x}async getTransactionCount(r,e){var o;const t=await T({address:this._getAddress(r),blockTag:this._getBlockTag(e||"latest")}),n=await((o=this.signer)===null||o===void 0?void 0:o.getAddress());if(!this.signer||n!==t.address||t.blockTag!=="pending")return super.getTransactionCount(t.address,t.blockTag);await this.getNetwork();const s=JSON.stringify({jsonrpc:"2.0",method:"eth_getTransactionCount",params:[t.address,t.blockTag],id:this._nextId++});this.emit("debug",{action:"request",request:s,provider:this});const a=await this.signer.signMessage(_(s)),u={...this.connection,headers:{...this.connection.headers,[this.signatureHeaderName]:`${t.address}:${a}`}},f=await w(u,s,G).then(c=>(this.emit("debug",{action:"response",request:s,response:c,provider:this}),c),c=>{throw this.emit("debug",{action:"response",error:c,request:s,provider:this}),c});return E.from(f).toNumber()}};function G(r){if(r.error){const e=new Error(r.error.message);throw e.code=r.error.code,e.data=r.error.data,e}return r.result}function J(r,e=l.Public){try{if(e===l.Private){var o;const s=(o=d(r).rpcUrls[l.Private])===null||o===void 0?void 0:o.http[0];if(!s)throw new Error(`No private RPC available for chain ${r}`);const a=m({experiment:p.PrivateRpc,param:b.FlashbotsEnabled,defaultValue:k});if(r===P.Mainnet&&a){const u=m({experiment:p.PrivateRpc,param:b.RefundPercent,defaultValue:C});return{rpcUrl:g,shouldUseFlashbots:!0,flashbotsConfig:{refundPercent:u}}}return{rpcUrl:s}}try{var t;const s=(t=d(r).rpcUrls[l.Public])===null||t===void 0?void 0:t.http[0];if(s)return{rpcUrl:s};throw new Error(`No public RPC available for chain ${r}`)}catch(s){var n;const a=(n=d(r).rpcUrls[l.PublicAlt])===null||n===void 0?void 0:n.http[0];if(a)return{rpcUrl:a};throw s}}catch(s){return h.error(s,{tags:{file:"rpcUrlSelector",function:"selectRpcUrl"},extra:{chainId:r,rpcType:e}}),null}}var V=v(S());function er({chainId:r,rpcType:e=l.Public,signerInfo:o}){try{const t=J(r,e);if(!t)return null;if(t.shouldUseFlashbots&&t.flashbotsConfig){const{refundPercent:n}=t.flashbotsConfig;return new M({signerInfo:o,refundPercent:n,network:r})}return new V.providers.JsonRpcProvider(t.rpcUrl,r)}catch(t){return h.error(t,{tags:{file:"createEthersProvider",function:"createProvider"},extra:{chainId:r,rpcType:e}}),null}}export{er as createEthersProvider};
