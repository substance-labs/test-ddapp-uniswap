import{blobsToCommitments as yn,blobsToProofs as wn,commitmentsToVersionedHashes as xn,formatBlock as It,formatLog as O,formatTransaction as kn,formatTransactionReceipt as In,getTransactionType as Pn,toBlobSidecars as An,toRlp as Nn}from"./utils-BX1Fu73x.js";import{BaseError as S,bytesToHex as pe,getAddress as En,hexToBigInt as Q,hexToBool as Bn,hexToBytes as qe,hexToNumber as be,init_sha3 as Tn,isAddress as Fn,isHex as Pt,keccak256 as Y,keccak_256 as Cn,numberToHex as T,size as Rn,stringToBytes as se,toBytes as Ge,toHex as he,trim as $n}from"./isAddress-P2vaZgmG.js";import{PositionOutOfBoundsError as Sn,TransactionNotFoundError as At,TransactionReceiptNotFoundError as Nt,WaitForTransactionReceiptTimeoutError as _n,formatEther as Un,formatTransactionRequest as Le,prettyPrint as qn}from"./chain-ghiO403o.js";import{concat as Gn,concatHex as Et,sliceHex as Ln}from"./slice-cfC6NcyN.js";import{UnknownNodeError as Bt,formatGwei as fe}from"./node-C_BraYgX.js";import{BaseError as _,CallExecutionError as zn,ContractFunctionRevertedError as ot,IntegerOutOfRangeError as Mn,InvalidAbiItemError as On,RawContractError as Dn,addressResolverAbi as it,assertRequest as ve,call as ze,concat as L,decodeAbiParameters as Tt,decodeFunctionResult as ge,deploylessCallViaBytecodeBytecode as Hn,encodeDeployData as jn,extract as Ft,from as Vn,fromBoolean as Ct,fromBytes as Wn,fromNumber as ee,fromString as Me,fromString$1 as Zn,getCallError as Jn,getChainContractAddress as ye,getNodeError as Rt,isStructSignature as Kn,padLeft as ae,padRight as oe,panicReasons as Qn,parseSignature as ct,parseStructs as Yn,serializeStateOverride as $t,size as X,slice as Oe,textResolverAbi as ut,toRpc as Xn,universalResolverResolveAbi as St,universalResolverReverseAbi as er,universalSignatureValidatorAbi as dt,universalSignatureValidatorByteCode as tr,validate as nr}from"./call-CTDbaN-t.js";import{parseAccount as W}from"./parseAccount-CRyN5swV.js";import{AbiDecodingDataSizeTooSmallError as rr,AbiDecodingZeroDataError as sr,AbiEventNotFoundError as lt,AbiEventSignatureEmptyTopicsError as ar,AbiEventSignatureNotFoundError as _t,DecodeLogDataMismatch as ie,DecodeLogTopicsMismatch as we,encodeAbiParameters as Ut,encodeFunctionData as Z,formatAbiItem as Be,formatAbiItem$1 as qt,getAbiItem as Gt,toEventSelector as De}from"./encodeFunctionData-CD63gkvM.js";import{stringify as D}from"./stringify-B82RFruy.js";import{InvalidInputRpcError as Lt}from"./rpc-nQR4Ijs4.js";import{getAction as x,getContractError as He,readContract as H}from"./readContract-Cae4hIjn.js";import{recoverAddress as zt}from"./recoverAddress-oPdWABRo.js";import{getBalance as Mt}from"./getBalance-TsPVbzB5.js";import{isAddressEqual as je,localBatchGatewayUrl as Ot}from"./localBatchGatewayRequest-CdT4Kija.js";import{withResolvers as or}from"./createBatchScheduler-BJBpfhFD.js";import{wait as ft,withRetry as mt}from"./createTransport-WEDNYdh5.js";import{hashMessage as Dt,hashTypedData as ir}from"./hashMessage-DdzTBpWL.js";import{multicall as cr}from"./multicall-BYS6jvE9.js";import{secp256k1 as ur}from"./secp256k1-fbKD5lyl.js";function pt(e){let t;if(typeof e=="string")t=ct(e);else{const n=Yn(e),r=e.length;for(let a=0;a<r;a++){const s=e[a];if(!Kn(s)){t=ct(s,n);break}}}if(!t)throw new On({signature:e});return t}var dr=class extends S{constructor(e){super(`Filter type "${e}" is not supported.`,{name:"FilterTypeNotSupportedError"})}};const bt="/docs/contract/encodeEventTopics";function ce(e){const{abi:t,eventName:n,args:r}=e;let a=t[0];if(n){const c=Gt({abi:t,name:n});if(!c)throw new lt(n,{docsPath:bt});a=c}if(a.type!=="event")throw new lt(void 0,{docsPath:bt});const s=qt(a),o=De(s);let i=[];if(r&&"inputs"in a){var u;const c=(u=a.inputs)===null||u===void 0?void 0:u.filter(d=>"indexed"in d&&d.indexed),l=Array.isArray(r)?r:Object.values(r).length>0?(c==null?void 0:c.map(d=>r[d.name]))??[]:[];l.length>0&&(i=(c==null?void 0:c.map((d,f)=>Array.isArray(l[f])?l[f].map((h,p)=>ht({param:d,value:l[f][p]})):typeof l[f]<"u"&&l[f]!==null?ht({param:d,value:l[f]}):null))??[])}return[o,...i]}function ht({param:e,value:t}){if(e.type==="string"||e.type==="bytes")return Y(Ge(t));if(e.type==="tuple"||e.type.match(/^(.*)\[(\d+)?\]$/))throw new dr(e.type);return Ut([e],[t])}function xe(e,{method:t}){var n,r;const a={};return e.transport.type==="fallback"&&((n=(r=e.transport).onResponse)===null||n===void 0||n.call(r,({method:s,response:o,status:i,transport:u})=>{i==="success"&&t===s&&(a[o]=u.request)})),s=>a[s]||e.request}async function Ht(e,t){const{address:n,abi:r,args:a,eventName:s,fromBlock:o,strict:i,toBlock:u}=t,c=xe(e,{method:"eth_newFilter"}),l=s?ce({abi:r,args:a,eventName:s}):void 0,d=await e.request({method:"eth_newFilter",params:[{address:n,fromBlock:typeof o=="bigint"?T(o):o,toBlock:typeof u=="bigint"?T(u):u,topics:l}]});return{abi:r,args:a,eventName:s,id:d,request:c(d),strict:!!i,type:"event"}}function lr(e){const{chainId:t,nonce:n,to:r}=e,a=e.contractAddress??e.address,s=Y(Et(["0x05",Nn([t?T(t):"0x",a,n?T(n):"0x"])]));return r==="bytes"?qe(s):s}async function fr(e){const{authorization:t,signature:n}=e;return zt({hash:lr(t),signature:n??t})}var mr=class extends S{constructor(e,{account:t,docsPath:n,chain:r,data:a,gas:s,gasPrice:o,maxFeePerGas:i,maxPriorityFeePerGas:u,nonce:c,to:l,value:d}){var f;const h=qn({from:t==null?void 0:t.address,to:l,value:typeof d<"u"&&`${Un(d)} ${(r==null||(f=r.nativeCurrency)===null||f===void 0?void 0:f.symbol)||"ETH"}`,data:a,gas:s,gasPrice:typeof o<"u"&&`${fe(o)} gwei`,maxFeePerGas:typeof i<"u"&&`${fe(i)} gwei`,maxPriorityFeePerGas:typeof u<"u"&&`${fe(u)} gwei`,nonce:c});super(e.shortMessage,{cause:e,docsPath:n,metaMessages:[...e.metaMessages?[...e.metaMessages," "]:[],"Estimate Gas Arguments:",h].filter(Boolean),name:"EstimateGasExecutionError"}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cause=e}};function pr(e,{docsPath:t,...n}){const r=(()=>{const a=Rt(e,n);return a instanceof Bt?e:a})();return new mr(r,{docsPath:t,...n})}var br=class extends S{constructor(){super("`baseFeeMultiplier` must be greater than 1.",{name:"BaseFeeScalarError"})}},Ve=class extends S{constructor(){super("Chain does not support EIP-1559 fees.",{name:"Eip1559FeesNotSupportedError"})}},hr=class extends S{constructor({maxPriorityFeePerGas:e}){super(`\`maxFeePerGas\` cannot be less than the \`maxPriorityFeePerGas\` (${fe(e)} gwei).`,{name:"MaxFeePerGasTooLowError"})}},jt=class extends S{constructor({blockHash:e,blockNumber:t}){let n="Block";e&&(n=`Block at hash "${e}"`),t&&(n=`Block at number "${t}"`),super(`${n} could not be found.`,{name:"BlockNotFoundError"})}};async function G(e,{blockHash:t,blockNumber:n,blockTag:r,includeTransactions:a}={}){var s;const o=r??"latest",i=a??!1,u=n!==void 0?T(n):void 0;let c=null;if(t?c=await e.request({method:"eth_getBlockByHash",params:[t,i]},{dedupe:!0}):c=await e.request({method:"eth_getBlockByNumber",params:[u||o,i]},{dedupe:!!u}),!c)throw new jt({blockHash:t,blockNumber:n});return(((s=e.chain)===null||s===void 0||(s=s.formatters)===null||s===void 0||(s=s.block)===null||s===void 0?void 0:s.format)||It)(c)}async function We(e){const t=await e.request({method:"eth_gasPrice"});return BigInt(t)}async function vr(e,t){return Vt(e,t)}async function Vt(e,t){const{block:n,chain:r=e.chain,request:a}=t||{};try{var s,o;const i=(r==null||(s=r.fees)===null||s===void 0?void 0:s.maxPriorityFeePerGas)??(r==null||(o=r.fees)===null||o===void 0?void 0:o.defaultPriorityFee);if(typeof i=="function"){const c=n||await x(e,G,"getBlock")({}),l=await i({block:c,client:e,request:a});if(l===null)throw new Error;return l}if(typeof i<"u")return i;const u=await e.request({method:"eth_maxPriorityFeePerGas"});return Q(u)}catch{const[i,u]=await Promise.all([n?Promise.resolve(n):x(e,G,"getBlock")({}),x(e,We,"getGasPrice")({})]);if(typeof i.baseFeePerGas!="bigint")throw new Ve;const c=u-i.baseFeePerGas;return c<0n?0n:c}}async function gr(e,t){return Te(e,t)}async function Te(e,t){var n,r;const{block:a,chain:s=e.chain,request:o,type:i="eip1559"}=t||{},u=await(async()=>{var p,m;return typeof(s==null||(p=s.fees)===null||p===void 0?void 0:p.baseFeeMultiplier)=="function"?s.fees.baseFeeMultiplier({block:a,client:e,request:o}):(s==null||(m=s.fees)===null||m===void 0?void 0:m.baseFeeMultiplier)??1.2})();if(u<1)throw new br;const l=10**(((n=u.toString().split(".")[1])===null||n===void 0?void 0:n.length)??0),d=p=>p*BigInt(Math.ceil(u*l))/BigInt(l),f=a||await x(e,G,"getBlock")({});if(typeof(s==null||(r=s.fees)===null||r===void 0?void 0:r.estimateFeesPerGas)=="function"){const p=await s.fees.estimateFeesPerGas({block:a,client:e,multiply:d,request:o,type:i});if(p!==null)return p}if(i==="eip1559"){if(typeof f.baseFeePerGas!="bigint")throw new Ve;const p=typeof(o==null?void 0:o.maxPriorityFeePerGas)=="bigint"?o.maxPriorityFeePerGas:await Vt(e,{block:f,chain:s,request:o}),m=d(f.baseFeePerGas);return{maxFeePerGas:(o==null?void 0:o.maxFeePerGas)??m+p,maxPriorityFeePerGas:p}}return{gasPrice:(o==null?void 0:o.gasPrice)??d(await x(e,We,"getGasPrice")({}))}}async function Wt(e,{address:t,blockTag:n="latest",blockNumber:r}){const a=await e.request({method:"eth_getTransactionCount",params:[t,typeof r=="bigint"?T(r):n]},{dedupe:!!r});return be(a)}async function Zt(e){const t=await e.request({method:"eth_chainId"},{dedupe:!0});return be(t)}const yr=["blobVersionedHashes","chainId","fees","gas","nonce","type"],vt=new Map;async function Jt(e,t){const{account:n=e.account,blobs:r,chain:a,gas:s,kzg:o,nonce:i,nonceManager:u,parameters:c=yr,type:l}=t,d=n&&W(n),f={...t,...d?{from:d==null?void 0:d.address}:{}};let h;async function p(){return h||(h=await x(e,G,"getBlock")({blockTag:"latest"}),h)}let m;async function y(){return m||(a?a.id:typeof t.chainId<"u"?t.chainId:(m=await x(e,Zt,"getChainId")({}),m))}if(c.includes("nonce")&&typeof i>"u"&&d)if(u){const b=await y();f.nonce=await u.consume({address:d.address,chainId:b,client:e})}else f.nonce=await x(e,Wt,"getTransactionCount")({address:d.address,blockTag:"pending"});if((c.includes("blobVersionedHashes")||c.includes("sidecars"))&&r&&o){const b=yn({blobs:r,kzg:o});if(c.includes("blobVersionedHashes")){const v=xn({commitments:b,to:"hex"});f.blobVersionedHashes=v}if(c.includes("sidecars")){const v=wn({blobs:r,commitments:b,kzg:o}),g=An({blobs:r,commitments:b,proofs:v,to:"hex"});f.sidecars=g}}if(c.includes("chainId")&&(f.chainId=await y()),(c.includes("fees")||c.includes("type"))&&typeof l>"u")try{f.type=Pn(f)}catch{let b=vt.get(e.uid);if(typeof b>"u"){const v=await p();b=typeof(v==null?void 0:v.baseFeePerGas)=="bigint",vt.set(e.uid,b)}f.type=b?"eip1559":"legacy"}if(c.includes("fees"))if(f.type!=="legacy"&&f.type!=="eip2930"){if(typeof f.maxFeePerGas>"u"||typeof f.maxPriorityFeePerGas>"u"){const b=await p(),{maxFeePerGas:v,maxPriorityFeePerGas:g}=await Te(e,{block:b,chain:a,request:f});if(typeof t.maxPriorityFeePerGas>"u"&&t.maxFeePerGas&&t.maxFeePerGas<g)throw new hr({maxPriorityFeePerGas:g});f.maxPriorityFeePerGas=g,f.maxFeePerGas=v}}else{if(typeof t.maxFeePerGas<"u"||typeof t.maxPriorityFeePerGas<"u")throw new Ve;if(typeof t.gasPrice>"u"){const b=await p(),{gasPrice:v}=await Te(e,{block:b,chain:a,request:f,type:"legacy"});f.gasPrice=v}}return c.includes("gas")&&typeof s>"u"&&(f.gas=await x(e,Ze,"estimateGas")({...f,account:d&&{address:d.address,type:"json-rpc"}})),ve(f),delete f.parameters,f}async function Ze(e,t){const{account:n=e.account}=t,r=n?W(n):void 0;try{let F=function(V){const{block:U,request:z,rpcStateOverride:M}=V;return e.request({method:"eth_estimateGas",params:M?[z,U??"pending",M]:U?[z,U]:[z]})};var a;const{accessList:s,authorizationList:o,blobs:i,blobVersionedHashes:u,blockNumber:c,blockTag:l,data:d,gas:f,gasPrice:h,maxFeePerBlobGas:p,maxFeePerGas:m,maxPriorityFeePerGas:y,nonce:b,value:v,stateOverride:g,...I}=await Jt(e,{...t,parameters:(r==null?void 0:r.type)==="local"?void 0:["blobVersionedHashes"]}),N=(typeof c=="bigint"?T(c):void 0)||l,P=$t(g),A=await(async()=>{if(I.to)return I.to;if(o&&o.length>0)return await fr({authorization:o[0]}).catch(()=>{throw new S("`to` is required. Could not infer from `authorizationList`")})})();ve(t);const k=(a=e.chain)===null||a===void 0||(a=a.formatters)===null||a===void 0||(a=a.transactionRequest)===null||a===void 0?void 0:a.format,B=(k||Le)({...Ft(I,{format:k}),from:r==null?void 0:r.address,accessList:s,authorizationList:o,blobs:i,blobVersionedHashes:u,data:d,gas:f,gasPrice:h,maxFeePerBlobGas:p,maxFeePerGas:m,maxPriorityFeePerGas:y,nonce:b,to:A,value:v});let R=BigInt(await F({block:N,request:B,rpcStateOverride:P}));if(o){const V=await Mt(e,{address:B.from}),U=await Promise.all(o.map(async z=>{const{address:M}=z,te=await F({block:N,request:{authorizationList:void 0,data:d,from:r==null?void 0:r.address,to:M,value:T(V)},rpcStateOverride:P}).catch(()=>100000n);return 2n*BigInt(te)}));R+=U.reduce((z,M)=>z+M,0n)}return R}catch(s){throw pr(s,{...t,account:r,chain:e.chain})}}async function wr(e,t){const{abi:n,address:r,args:a,functionName:s,dataSuffix:o,...i}=t,u=Z({abi:n,args:a,functionName:s});try{return await x(e,Ze,"estimateGas")({data:`${u}${o?o.replace("0x",""):""}`,to:r,...i})}catch(c){const l=i.account?W(i.account):void 0;throw He(c,{abi:n,address:r,args:a,docsPath:"/docs/contract/estimateContractGas",functionName:s,sender:l==null?void 0:l.address})}}const gt="/docs/contract/decodeEventLog";function Je(e){const{abi:t,data:n,strict:r,topics:a}=e,s=r??!0,[o,...i]=a;if(!o)throw new ar({docsPath:gt});const u=t.length===1?t[0]:t.find(m=>m.type==="event"&&o===De(qt(m)));if(!(u&&"name"in u)||u.type!=="event")throw new _t(o,{docsPath:gt});const{name:c,inputs:l}=u,d=l==null?void 0:l.some(m=>!("name"in m&&m.name));let f=d?[]:{};const h=l.filter(m=>"indexed"in m&&m.indexed);for(let m=0;m<h.length;m++){const y=h[m],b=i[m];if(!b)throw new we({abiItem:u,param:y});f[d?m:y.name||m]=xr({param:y,value:b})}const p=l.filter(m=>!("indexed"in m&&m.indexed));if(p.length>0){if(n&&n!=="0x")try{const m=Tt(p,n);if(m)if(d)f=[...f,...m];else for(let y=0;y<p.length;y++)f[p[y].name]=m[y]}catch(m){if(s)throw m instanceof rr||m instanceof Sn?new ie({abiItem:u,data:n,params:p,size:Rn(n)}):m}else if(s)throw new ie({abiItem:u,data:"0x",params:p,size:0})}return{eventName:c,args:Object.values(f).length>0?f:void 0}}function xr({param:e,value:t}){return e.type==="string"||e.type==="bytes"||e.type==="tuple"||e.type.match(/^(.*)\[(\d+)?\]$/)?t:(Tt([e],t)||[])[0]}function Ke(e){const{abi:t,args:n,logs:r,strict:a=!0}=e,s=(()=>{if(e.eventName)return Array.isArray(e.eventName)?e.eventName:[e.eventName]})();return r.map(o=>{try{const u=t.find(l=>l.type==="event"&&o.topics[0]===De(l));if(!u)return null;const c=Je({...o,abi:[u],strict:a});return s&&!s.includes(c.eventName)||!kr({args:c.args,inputs:u.inputs,matchArgs:n})?null:{...c,...o}}catch(u){let c,l;if(u instanceof _t)return null;if(u instanceof ie||u instanceof we){var i;if(a)return null;c=u.abiItem.name,l=(i=u.abiItem.inputs)===null||i===void 0?void 0:i.some(d=>!("name"in d&&d.name))}return{...o,args:l?[]:{},eventName:c}}}).filter(Boolean)}function kr(e){const{args:t,inputs:n,matchArgs:r}=e;if(!r)return!0;if(!t)return!1;function a(s,o,i){try{return s.type==="address"?je(o,i):s.type==="string"||s.type==="bytes"?Y(Ge(o))===i:o===i}catch{return!1}}return Array.isArray(t)&&Array.isArray(r)?r.every((s,o)=>{if(s==null)return!0;const i=n[o];return i?(Array.isArray(s)?s:[s]).some(c=>a(i,c,t[o])):!1}):typeof t=="object"&&!Array.isArray(t)&&typeof r=="object"&&!Array.isArray(r)?Object.entries(r).every(([s,o])=>{if(o==null)return!0;const i=n.find(c=>c.name===s);return i?(Array.isArray(o)?o:[o]).some(c=>a(i,c,t[s])):!1}):!1}async function Qe(e,{address:t,blockHash:n,fromBlock:r,toBlock:a,event:s,events:o,args:i,strict:u}={}){const c=u??!1,l=o??(s?[s]:void 0);let d=[];l&&(d=[l.flatMap(m=>ce({abi:[m],eventName:m.name,args:o?void 0:i}))],s&&(d=d[0]));let f;n?f=await e.request({method:"eth_getLogs",params:[{address:t,topics:d,blockHash:n}]}):f=await e.request({method:"eth_getLogs",params:[{address:t,topics:d,fromBlock:typeof r=="bigint"?T(r):r,toBlock:typeof a=="bigint"?T(a):a}]});const h=f.map(p=>O(p));return l?Ke({abi:l,args:i,logs:h,strict:c}):h}async function Kt(e,t){const{abi:n,address:r,args:a,blockHash:s,eventName:o,fromBlock:i,toBlock:u,strict:c}=t,l=o?Gt({abi:n,name:o}):void 0,d=l?void 0:n.filter(f=>f.type==="event");return x(e,Qe,"getLogs")({address:r,args:a,blockHash:s,event:l,events:d,fromBlock:i,toBlock:u,strict:c})}async function Ir(e,t){const{abi:n,address:r,args:a,dataSuffix:s,functionName:o,...i}=t,u=i.account?W(i.account):e.account,c=Z({abi:n,args:a,functionName:o});try{const{data:l}=await x(e,ze,"call")({batch:!1,data:`${c}${s?s.replace("0x",""):""}`,to:r,...i,account:u}),d=ge({abi:n,args:a,functionName:o,data:l||"0x"}),f=n.filter(h=>"name"in h&&h.name===t.functionName);return{result:d,request:{abi:f,address:r,args:a,dataSuffix:s,functionName:o,...i,account:u}}}catch(l){throw He(l,{abi:n,address:r,args:a,docsPath:"/docs/contract/simulateContract",functionName:o,sender:u==null?void 0:u.address})}}const Ne=new Map,yt=new Map;let Pr=0;function j(e,t,n){const r=++Pr,a=()=>Ne.get(e)||[],s=()=>{const l=a();Ne.set(e,l.filter(d=>d.id!==r))},o=()=>{const l=a();if(!l.some(f=>f.id===r))return;const d=yt.get(e);l.length===1&&d&&d(),s()},i=a();if(Ne.set(e,[...i,{id:r,fns:t}]),i&&i.length>0)return o;const u={};for(const l in t)u[l]=(...d)=>{var f,h;const p=a();if(p.length!==0)for(const m of p)(f=(h=m.fns)[l])===null||f===void 0||f.call(h,...d)};const c=n(u);return typeof c=="function"&&yt.set(e,c),o}function ue(e,{emitOnBegin:t,initialWaitTime:n,interval:r}){let a=!0;const s=()=>a=!1;return(async()=>{let i;t&&(i=await e({unpoll:s}));const u=await(n==null?void 0:n(i))??r;await ft(u);const c=async()=>{a&&(await e({unpoll:s}),await ft(r),c())};c()})(),s}const Ar=new Map,Nr=new Map;function Er(e){const t=(a,s)=>({clear:()=>s.delete(a),get:()=>s.get(a),set:o=>s.set(a,o)}),n=t(e,Ar),r=t(e,Nr);return{clear:()=>{n.clear(),r.clear()},promise:n,response:r}}async function Br(e,{cacheKey:t,cacheTime:n=Number.POSITIVE_INFINITY}){const r=Er(t),a=r.response.get();if(a&&n>0&&new Date().getTime()-a.created.getTime()<n)return a.data;let s=r.promise.get();s||(s=e(),r.promise.set(s));try{const o=await s;return r.response.set({created:new Date,data:o}),o}finally{r.promise.clear()}}const Tr=e=>`blockNumber.${e}`;async function de(e,{cacheTime:t=e.cacheTime}={}){const n=await Br(()=>e.request({method:"eth_blockNumber"}),{cacheKey:Tr(e.uid),cacheTime:t});return BigInt(n)}async function ke(e,{filter:t}){const n="strict"in t&&t.strict,r=await t.request({method:"eth_getFilterChanges",params:[t.id]});if(typeof r[0]=="string")return r;const a=r.map(s=>O(s));return!("abi"in t)||!t.abi?a:Ke({abi:t.abi,logs:a,strict:n})}async function Ie(e,{filter:t}){return t.request({method:"eth_uninstallFilter",params:[t.id]})}function Fr(e,t){const{abi:n,address:r,args:a,batch:s=!0,eventName:o,fromBlock:i,onError:u,onLogs:c,poll:l,pollingInterval:d=e.pollingInterval,strict:f}=t;return(typeof l<"u"?l:typeof i=="bigint"?!0:!(e.transport.type==="webSocket"||e.transport.type==="fallback"&&e.transport.transports[0].config.type==="webSocket"))?(()=>{const y=f??!1,b=D(["watchContractEvent",r,a,s,e.uid,o,d,y,i]);return j(b,{onLogs:c,onError:u},v=>{let g;i!==void 0&&(g=i-1n);let I,E=!1;const N=ue(async()=>{if(!E){try{I=await x(e,Ht,"createContractEventFilter")({abi:n,address:r,args:a,eventName:o,strict:y,fromBlock:i})}catch{}E=!0;return}try{let A;if(I)A=await x(e,ke,"getFilterChanges")({filter:I});else{const k=await x(e,de,"getBlockNumber")({});g&&g<k?A=await x(e,Kt,"getContractEvents")({abi:n,address:r,args:a,eventName:o,fromBlock:g+1n,toBlock:k,strict:y}):A=[],g=k}if(A.length===0)return;if(s)v.onLogs(A);else for(const k of A)v.onLogs([k])}catch(A){var P;I&&A instanceof Lt&&(E=!1),(P=v.onError)===null||P===void 0||P.call(v,A)}},{emitOnBegin:!0,interval:d});return async()=>{I&&await x(e,Ie,"uninstallFilter")({filter:I}),N()}})})():(()=>{const y=f??!1,b=D(["watchContractEvent",r,a,s,e.uid,o,d,y]);let v=!0,g=()=>v=!1;return j(b,{onLogs:c,onError:u},I=>((async()=>{try{const E=(()=>{if(e.transport.type==="fallback"){const A=e.transport.transports.find(k=>k.config.type==="webSocket");return A?A.value:e.transport}return e.transport})(),N=o?ce({abi:n,eventName:o,args:a}):[],{unsubscribe:P}=await E.subscribe({params:["logs",{address:r,topics:N}],onData(A){if(!v)return;const k=A.result;try{const{eventName:B,args:F}=Je({abi:n,data:k.data,topics:k.topics,strict:f}),R=O(k,{args:F,eventName:B});I.onLogs([R])}catch(B){let F,R;if(B instanceof ie||B instanceof we){var C;if(f)return;F=B.abiItem.name,R=(C=B.abiItem.inputs)===null||C===void 0?void 0:C.some(U=>!("name"in U&&U.name))}const V=O(k,{args:R?[]:{},eventName:F});I.onLogs([V])}},onError(A){var k;(k=I.onError)===null||k===void 0||k.call(I,A)}});g=P,v||g()}catch(E){u==null||u(E)}})(),()=>g()))})()}async function Cr(e,{serializedTransaction:t}){return e.request({method:"eth_sendRawTransaction",params:[t]},{retryCount:0})}function Ye(e,t){var n,r,a,s,o,i;if(!(e instanceof S))return!1;const u=e.walk(c=>c instanceof ot);return u instanceof ot?!!(((n=u.data)===null||n===void 0?void 0:n.errorName)==="ResolverNotFound"||((r=u.data)===null||r===void 0?void 0:r.errorName)==="ResolverWildcardNotSupported"||((a=u.data)===null||a===void 0?void 0:a.errorName)==="ResolverNotContract"||((s=u.data)===null||s===void 0?void 0:s.errorName)==="ResolverError"||((o=u.data)===null||o===void 0?void 0:o.errorName)==="HttpError"||!((i=u.reason)===null||i===void 0)&&i.includes("Wildcard on non-extended resolvers is not supported")||t==="reverse"&&u.reason===Qn[50]):!1}function Qt(e){if(e.length!==66||e.indexOf("[")!==0||e.indexOf("]")!==65)return null;const t=`0x${e.slice(1,65)}`;return Pt(t)?t:null}function me(e){let t=new Uint8Array(32).fill(0);if(!e)return pe(t);const n=e.split(".");for(let r=n.length-1;r>=0;r-=1){const a=Qt(n[r]),s=a?Ge(a):Y(se(n[r]),"bytes");t=Y(Gn([t,s]),"bytes")}return pe(t)}function Rr(e){return`[${e.slice(2)}]`}function $r(e){const t=new Uint8Array(32).fill(0);return e?Qt(e)||Y(se(e)):pe(t)}function Pe(e){const t=e.replace(/^\.|\.$/gm,"");if(t.length===0)return new Uint8Array(1);const n=new Uint8Array(se(t).byteLength+2);let r=0;const a=t.split(".");for(let s=0;s<a.length;s++){let o=se(a[s]);o.byteLength>255&&(o=se(Rr($r(a[s])))),n[r]=o.length,n.set(o,r+1),r+=o.length+1}return n.byteLength!==r+1?n.slice(0,r+1):n}async function Sr(e,t){const{blockNumber:n,blockTag:r,coinType:a,name:s,gatewayUrls:o,strict:i}=t,{chain:u}=e,c=(()=>{if(t.universalResolverAddress)return t.universalResolverAddress;if(!u)throw new Error("client chain not configured. universalResolverAddress is required.");return ye({blockNumber:n,chain:u,contract:"ensUniversalResolver"})})(),l=u==null?void 0:u.ensTlds;if(l&&!l.some(d=>s.endsWith(d)))return null;try{const d=Z({abi:it,functionName:"addr",...a!=null?{args:[me(s),BigInt(a)]}:{args:[me(s)]}}),f={address:c,abi:St,functionName:"resolve",args:[he(Pe(s)),d,o??[Ot]],blockNumber:n,blockTag:r},p=await x(e,H,"readContract")(f);if(p[0]==="0x")return null;const m=ge({abi:it,args:a!=null?[me(s),BigInt(a)]:void 0,functionName:"addr",data:p[0]});return m==="0x"||$n(m)==="0x00"?null:m}catch(d){if(i)throw d;if(Ye(d,"resolve"))return null;throw d}}var _r=class extends S{constructor({data:e}){super("Unable to extract image from metadata. The metadata may be malformed or invalid.",{metaMessages:["- Metadata must be a JSON object with at least an `image`, `image_url` or `image_data` property.","",`Provided data: ${JSON.stringify(e)}`],name:"EnsAvatarInvalidMetadataError"})}},re=class extends S{constructor({reason:e}){super(`ENS NFT avatar URI is invalid. ${e}`,{name:"EnsAvatarInvalidNftUriError"})}},Xe=class extends S{constructor({uri:e}){super(`Unable to resolve ENS avatar URI "${e}". The URI may be malformed, invalid, or does not respond with a valid image.`,{name:"EnsAvatarUriResolutionError"})}},Ur=class extends S{constructor({namespace:e}){super(`ENS NFT avatar namespace "${e}" is not supported. Must be "erc721" or "erc1155".`,{name:"EnsAvatarUnsupportedNamespaceError"})}};const qr=/(?<protocol>https?:\/\/[^\/]*|ipfs:\/|ipns:\/|ar:\/)?(?<root>\/)?(?<subpath>ipfs\/|ipns\/)?(?<target>[\w\-.]+)(?<subtarget>\/.*)?/,Gr=/^(Qm[1-9A-HJ-NP-Za-km-z]{44,}|b[A-Za-z2-7]{58,}|B[A-Z2-7]{58,}|z[1-9A-HJ-NP-Za-km-z]{48,}|F[0-9A-F]{50,})(\/(?<target>[\w\-.]+))?(?<subtarget>\/.*)?$/,Lr=/^data:([a-zA-Z\-/+]*);base64,([^"].*)/,zr=/^data:([a-zA-Z\-/+]*)?(;[a-zA-Z0-9].*?)?(,)/;async function Mr(e){try{const t=await fetch(e,{method:"HEAD"});if(t.status===200){const n=t.headers.get("content-type");return n==null?void 0:n.startsWith("image/")}return!1}catch(t){return typeof t=="object"&&typeof t.response<"u"||!globalThis.hasOwnProperty("Image")?!1:new Promise(n=>{const r=new Image;r.onload=()=>{n(!0)},r.onerror=()=>{n(!1)},r.src=e})}}function wt(e,t){return e?e.endsWith("/")?e.slice(0,-1):e:t}function Yt({uri:e,gatewayUrls:t}){const n=Lr.test(e);if(n)return{uri:e,isOnChain:!0,isEncoded:n};const r=wt(t==null?void 0:t.ipfs,"https://ipfs.io"),a=wt(t==null?void 0:t.arweave,"https://arweave.net"),s=e.match(qr),{protocol:o,subpath:i,target:u,subtarget:c=""}=(s==null?void 0:s.groups)||{},l=o==="ipns:/"||i==="ipns/",d=o==="ipfs:/"||i==="ipfs/"||Gr.test(e);if(e.startsWith("http")&&!l&&!d){let h=e;return t!=null&&t.arweave&&(h=e.replace(/https:\/\/arweave.net/g,t==null?void 0:t.arweave)),{uri:h,isOnChain:!1,isEncoded:!1}}if((l||d)&&u)return{uri:`${r}/${l?"ipns":"ipfs"}/${u}${c}`,isOnChain:!1,isEncoded:!1};if(o==="ar:/"&&u)return{uri:`${a}/${u}${c||""}`,isOnChain:!1,isEncoded:!1};let f=e.replace(zr,"");if(f.startsWith("<svg")&&(f=`data:image/svg+xml;base64,${btoa(f)}`),f.startsWith("data:")||f.startsWith("{"))return{uri:f,isOnChain:!0,isEncoded:!1};throw new Xe({uri:e})}function Xt(e){if(typeof e!="object"||!("image"in e)&&!("image_url"in e)&&!("image_data"in e))throw new _r({data:e});return e.image||e.image_url||e.image_data}async function Or({gatewayUrls:e,uri:t}){try{const n=await fetch(t).then(a=>a.json());return await et({gatewayUrls:e,uri:Xt(n)})}catch{throw new Xe({uri:t})}}async function et({gatewayUrls:e,uri:t}){const{uri:n,isOnChain:r}=Yt({uri:t,gatewayUrls:e});if(r||await Mr(n))return n;throw new Xe({uri:t})}function Dr(e){let t=e;t.startsWith("did:nft:")&&(t=t.replace("did:nft:","").replace(/_/g,"/"));const[n,r,a]=t.split("/"),[s,o]=n.split(":"),[i,u]=r.split(":");if(!s||s.toLowerCase()!=="eip155")throw new re({reason:"Only EIP-155 supported"});if(!o)throw new re({reason:"Chain ID not found"});if(!u)throw new re({reason:"Contract address not found"});if(!a)throw new re({reason:"Token ID not found"});if(!i)throw new re({reason:"ERC namespace not found"});return{chainID:Number.parseInt(o),namespace:i.toLowerCase(),contractAddress:u,tokenID:a}}async function Hr(e,{nft:t}){if(t.namespace==="erc721")return H(e,{address:t.contractAddress,abi:[{name:"tokenURI",type:"function",stateMutability:"view",inputs:[{name:"tokenId",type:"uint256"}],outputs:[{name:"",type:"string"}]}],functionName:"tokenURI",args:[BigInt(t.tokenID)]});if(t.namespace==="erc1155")return H(e,{address:t.contractAddress,abi:[{name:"uri",type:"function",stateMutability:"view",inputs:[{name:"_id",type:"uint256"}],outputs:[{name:"",type:"string"}]}],functionName:"uri",args:[BigInt(t.tokenID)]});throw new Ur({namespace:t.namespace})}async function jr(e,{gatewayUrls:t,record:n}){return/eip155:/i.test(n)?Vr(e,{gatewayUrls:t,record:n}):et({uri:n,gatewayUrls:t})}async function Vr(e,{gatewayUrls:t,record:n}){const r=Dr(n),a=await Hr(e,{nft:r}),{uri:s,isOnChain:o,isEncoded:i}=Yt({uri:a,gatewayUrls:t});if(o&&(s.includes("data:application/json;base64,")||s.startsWith("{"))){const c=i?atob(s.replace("data:application/json;base64,","")):s,l=JSON.parse(c);return et({uri:Xt(l),gatewayUrls:t})}let u=r.tokenID;return r.namespace==="erc1155"&&(u=u.replace("0x","").padStart(64,"0")),Or({gatewayUrls:t,uri:s.replace(/(?:0x)?{id}/,u)})}async function en(e,t){const{blockNumber:n,blockTag:r,key:a,name:s,gatewayUrls:o,strict:i}=t,{chain:u}=e,c=(()=>{if(t.universalResolverAddress)return t.universalResolverAddress;if(!u)throw new Error("client chain not configured. universalResolverAddress is required.");return ye({blockNumber:n,chain:u,contract:"ensUniversalResolver"})})(),l=u==null?void 0:u.ensTlds;if(l&&!l.some(d=>s.endsWith(d)))return null;try{const d={address:c,abi:St,functionName:"resolve",args:[he(Pe(s)),Z({abi:ut,functionName:"text",args:[me(s),a]}),o??[Ot]],blockNumber:n,blockTag:r},h=await x(e,H,"readContract")(d);if(h[0]==="0x")return null;const p=ge({abi:ut,functionName:"text",data:h[0]});return p===""?null:p}catch(d){if(i)throw d;if(Ye(d,"resolve"))return null;throw d}}async function Wr(e,{blockNumber:t,blockTag:n,assetGatewayUrls:r,name:a,gatewayUrls:s,strict:o,universalResolverAddress:i}){const u=await x(e,en,"getEnsText")({blockNumber:t,blockTag:n,key:"avatar",name:a,universalResolverAddress:i,gatewayUrls:s,strict:o});if(!u)return null;try{return await jr(e,{record:u,gatewayUrls:r})}catch{return null}}async function Zr(e,{address:t,blockNumber:n,blockTag:r,gatewayUrls:a,strict:s,universalResolverAddress:o}){let i=o;if(!i){if(!e.chain)throw new Error("client chain not configured. universalResolverAddress is required.");i=ye({blockNumber:n,chain:e.chain,contract:"ensUniversalResolver"})}const u=`${t.toLowerCase().substring(2)}.addr.reverse`;try{const c={address:i,abi:er,functionName:"reverse",args:[he(Pe(u))],blockNumber:n,blockTag:r},l=x(e,H,"readContract"),[d,f]=a?await l({...c,args:[...c.args,a]}):await l(c);return t.toLowerCase()!==f.toLowerCase()?null:d}catch(c){if(s)throw c;if(Ye(c,"reverse"))return null;throw c}}async function Jr(e,t){const{blockNumber:n,blockTag:r,name:a}=t,{chain:s}=e,o=(()=>{if(t.universalResolverAddress)return t.universalResolverAddress;if(!s)throw new Error("client chain not configured. universalResolverAddress is required.");return ye({blockNumber:n,chain:s,contract:"ensUniversalResolver"})})(),i=s==null?void 0:s.ensTlds;if(i&&!i.some(c=>a.endsWith(c)))throw new Error(`${a} is not a valid ENS TLD (${i==null?void 0:i.join(", ")}) for chain "${s.name}" (id: ${s.id}).`);const[u]=await x(e,H,"readContract")({address:o,abi:[{inputs:[{type:"bytes"}],name:"findResolver",outputs:[{type:"address"},{type:"bytes32"}],stateMutability:"view",type:"function"}],functionName:"findResolver",args:[he(Pe(a))],blockNumber:n,blockTag:r});return u}async function tn(e,t){const{account:n=e.account,blockNumber:r,blockTag:a="latest",blobs:s,data:o,gas:i,gasPrice:u,maxFeePerBlobGas:c,maxFeePerGas:l,maxPriorityFeePerGas:d,to:f,value:h,...p}=t,m=n?W(n):void 0;try{var y;ve(t);const v=(typeof r=="bigint"?T(r):void 0)||a,g=(y=e.chain)===null||y===void 0||(y=y.formatters)===null||y===void 0||(y=y.transactionRequest)===null||y===void 0?void 0:y.format,E=(g||Le)({...Ft(p,{format:g}),from:m==null?void 0:m.address,blobs:s,data:o,gas:i,gasPrice:u,maxFeePerBlobGas:c,maxFeePerGas:l,maxPriorityFeePerGas:d,to:f,value:h}),N=await e.request({method:"eth_createAccessList",params:[E,v]});return{accessList:N.accessList,gasUsed:BigInt(N.gasUsed)}}catch(b){throw Jn(b,{...t,account:m,chain:e.chain})}}async function Kr(e){const t=xe(e,{method:"eth_newBlockFilter"}),n=await e.request({method:"eth_newBlockFilter"});return{id:n,request:t(n),type:"block"}}async function nn(e,{address:t,args:n,event:r,events:a,fromBlock:s,strict:o,toBlock:i}={}){const u=a??(r?[r]:void 0),c=xe(e,{method:"eth_newFilter"});let l=[];u&&(l=[u.flatMap(h=>ce({abi:[h],eventName:h.name,args:n}))],r&&(l=l[0]));const d=await e.request({method:"eth_newFilter",params:[{address:t,fromBlock:typeof s=="bigint"?T(s):s,toBlock:typeof i=="bigint"?T(i):i,...l.length?{topics:l}:{}}]});return{abi:u,args:n,eventName:r?r.name:void 0,fromBlock:s,id:d,request:c(d),strict:!!o,toBlock:i,type:"event"}}async function rn(e){const t=xe(e,{method:"eth_newPendingTransactionFilter"}),n=await e.request({method:"eth_newPendingTransactionFilter"});return{id:n,request:t(n),type:"transaction"}}async function Qr(e){const t=await e.request({method:"eth_blobBaseFee"});return BigInt(t)}async function Yr(e,{blockHash:t,blockNumber:n,blockTag:r="latest"}={}){const a=n!==void 0?T(n):void 0;let s;return t?s=await e.request({method:"eth_getBlockTransactionCountByHash",params:[t]},{dedupe:!0}):s=await e.request({method:"eth_getBlockTransactionCountByNumber",params:[a||r]},{dedupe:!!a}),be(s)}async function xt(e,{address:t,blockNumber:n,blockTag:r="latest"}){const a=n!==void 0?T(n):void 0,s=await e.request({method:"eth_getCode",params:[t,a||r]},{dedupe:!!a});if(s!=="0x")return s}var Xr=class extends S{constructor({address:e}){super(`No EIP-712 domain found on contract "${e}".`,{metaMessages:["Ensure that:",`- The contract is deployed at the address "${e}".`,"- `eip712Domain()` function exists on the contract.","- `eip712Domain()` function matches signature to ERC-5267 specification."],name:"Eip712DomainNotFoundError"})}};async function es(e,t){const{address:n,factory:r,factoryData:a}=t;try{const[s,o,i,u,c,l,d]=await x(e,H,"readContract")({abi:ts,address:n,functionName:"eip712Domain",factory:r,factoryData:a});return{domain:{name:o,version:i,chainId:Number(u),verifyingContract:c,salt:l},extensions:d,fields:s}}catch(s){const o=s;throw o.name==="ContractFunctionExecutionError"&&o.cause.name==="ContractFunctionZeroDataError"?new Xr({address:n}):o}}const ts=[{inputs:[],name:"eip712Domain",outputs:[{name:"fields",type:"bytes1"},{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"},{name:"salt",type:"bytes32"},{name:"extensions",type:"uint256[]"}],stateMutability:"view",type:"function"}];function ns(e){var t;return{baseFeePerGas:e.baseFeePerGas.map(n=>BigInt(n)),gasUsedRatio:e.gasUsedRatio,oldestBlock:BigInt(e.oldestBlock),reward:(t=e.reward)===null||t===void 0?void 0:t.map(n=>n.map(r=>BigInt(r)))}}async function rs(e,{blockCount:t,blockNumber:n,blockTag:r="latest",rewardPercentiles:a}){const s=typeof n=="bigint"?T(n):void 0,o=await e.request({method:"eth_feeHistory",params:[T(t),s||r,a]},{dedupe:!!s});return ns(o)}async function ss(e,{filter:t}){const n=t.strict??!1,a=(await t.request({method:"eth_getFilterLogs",params:[t.id]})).map(s=>O(s));return t.abi?Ke({abi:t.abi,logs:a,strict:n}):a}const sn="0x6492649264926492649264926492649264926492649264926492649264926492";function as(e){return Ln(e,-32)===sn}function os(e){const{address:t,data:n,signature:r,to:a="hex"}=e,s=Et([Ut([{type:"address"},{type:"bytes"},{type:"bytes"}],[t,n,r]),sn]);return a==="hex"?s:qe(s)}function is(e){return e.map(t=>({...t,value:BigInt(t.value)}))}function cs(e){return{...e,balance:e.balance?BigInt(e.balance):void 0,nonce:e.nonce?be(e.nonce):void 0,storageProof:e.storageProof?is(e.storageProof):void 0}}async function us(e,{address:t,blockNumber:n,blockTag:r,storageKeys:a}){const s=r??"latest",o=n!==void 0?T(n):void 0,i=await e.request({method:"eth_getProof",params:[t,a,o||s]});return cs(i)}async function ds(e,{address:t,blockNumber:n,blockTag:r="latest",slot:a}){const s=n!==void 0?T(n):void 0;return await e.request({method:"eth_getStorageAt",params:[t,a,s||r]})}async function tt(e,{blockHash:t,blockNumber:n,blockTag:r,hash:a,index:s}){var o;const i=r||"latest",u=n!==void 0?T(n):void 0;let c=null;if(a?c=await e.request({method:"eth_getTransactionByHash",params:[a]},{dedupe:!0}):t?c=await e.request({method:"eth_getTransactionByBlockHashAndIndex",params:[t,T(s)]},{dedupe:!0}):(u||i)&&(c=await e.request({method:"eth_getTransactionByBlockNumberAndIndex",params:[u||i,T(s)]},{dedupe:!!u})),!c)throw new At({blockHash:t,blockNumber:n,blockTag:i,hash:a,index:s});return(((o=e.chain)===null||o===void 0||(o=o.formatters)===null||o===void 0||(o=o.transaction)===null||o===void 0?void 0:o.format)||kn)(c)}async function ls(e,{hash:t,transactionReceipt:n}){const[r,a]=await Promise.all([x(e,de,"getBlockNumber")({}),t?x(e,tt,"getTransaction")({hash:t}):void 0]),s=(n==null?void 0:n.blockNumber)||(a==null?void 0:a.blockNumber);return s?r-s+1n:0n}async function Fe(e,{hash:t}){var n;const r=await e.request({method:"eth_getTransactionReceipt",params:[t]},{dedupe:!0});if(!r)throw new Nt({hash:t});return(((n=e.chain)===null||n===void 0||(n=n.formatters)===null||n===void 0||(n=n.transactionReceipt)===null||n===void 0?void 0:n.format)||In)(r)}async function Ce(e,t){const{blockNumber:n,blockTag:r="pending",blocks:a,returnFullTransactions:s,traceTransfers:o,validation:i}=t;try{const u=[];for(const f of a){const h=f.blockOverrides?Xn(f.blockOverrides):void 0,p=f.calls.map(y=>{const b=y,v=b.account?W(b.account):void 0,g={...b,data:b.abi?Z(b):b.data,from:b.from??(v==null?void 0:v.address)};return ve(g),Le(g)}),m=f.stateOverrides?$t(f.stateOverrides):void 0;u.push({blockOverrides:h,calls:p,stateOverrides:m})}const l=(typeof n=="bigint"?T(n):void 0)||r;return(await e.request({method:"eth_simulateV1",params:[{blockStateCalls:u,returnFullTransactions:s,traceTransfers:o,validation:i},l]})).map((f,h)=>({...It(f),calls:f.calls.map((p,m)=>{var y,b;const{abi:v,args:g,functionName:I,to:E}=a[h].calls[m],N=((y=p.error)===null||y===void 0?void 0:y.data)??p.returnData,P=BigInt(p.gasUsed),A=(b=p.logs)===null||b===void 0?void 0:b.map(F=>O(F)),k=p.status==="0x1"?"success":"failure",C=v&&k==="success"&&N!=="0x"?ge({abi:v,data:N,functionName:I}):null,B=(()=>{var F;if(k==="success")return;let R;if(((F=p.error)===null||F===void 0?void 0:F.data)==="0x"?R=new sr:p.error&&(R=new Dn(p.error)),!!R)return He(R,{abi:v??[],address:E,args:g,functionName:I??"<unknown>"})})();return{data:N,gasUsed:P,logs:A,status:k,...k==="success"?{result:C}:{error:B}}})}))}catch(u){const c=u,l=Rt(c,{});throw l instanceof Bt?c:l}}Tn();function an(e,t={}){const{as:n=typeof e=="string"?"Hex":"Bytes"}=t,r=Cn(Vn(e));return n==="Bytes"?r:Wn(r)}var fs=class extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const t=super.get(e);return super.has(e)&&t!==void 0&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}};const ms={checksum:new fs(8192)},Ee=ms.checksum,ps=/^0x[a-fA-F0-9]{40}$/;function Ae(e,t={}){const{strict:n=!0}=t;if(!ps.test(e))throw new kt({address:e,cause:new hs});if(n){if(e.toLowerCase()===e)return;if(bs(e)!==e)throw new kt({address:e,cause:new vs})}}function bs(e){if(Ee.has(e))return Ee.get(e);Ae(e,{strict:!1});const t=e.substring(2).toLowerCase(),n=an(Zn(t),{as:"Bytes"}),r=t.split("");for(let s=0;s<40;s+=2)n[s>>1]>>4>=8&&r[s]&&(r[s]=r[s].toUpperCase()),(n[s>>1]&15)>=8&&r[s+1]&&(r[s+1]=r[s+1].toUpperCase());const a=`0x${r.join("")}`;return Ee.set(e,a),a}function Re(e,t={}){const{strict:n=!0}=t??{};try{return Ae(e,{strict:n}),!0}catch{return!1}}var kt=class extends _{constructor({address:e,cause:t}){super(`Address "${e}" is invalid.`,{cause:t}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}},hs=class extends _{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}},vs=class extends _{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}};function $e(e){let t=!0,n="",r=0,a="",s=!1;for(let o=0;o<e.length;o++){const i=e[o];if(["(",")",","].includes(i)&&(t=!0),i==="("&&r++,i===")"&&r--,!!t){if(r===0){if(i===" "&&["event","function","error",""].includes(a))a="";else if(a+=i,i===")"){s=!0;break}continue}if(i===" "){e[o-1]!==","&&n!==","&&n!==",("&&(n="",t=!1);continue}a+=i,n+=i}}if(!s)throw new _("Unable to normalize signature.");return a}function Se(e,t){const n=typeof e,r=t.type;switch(r){case"address":return Re(e,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return r==="tuple"&&"components"in t?Object.values(t.components).every((a,s)=>Se(Object.values(e)[s],a)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(r)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(r)?n==="string"||e instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(r)?Array.isArray(e)&&e.every(a=>Se(a,{...t,type:r.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function on(e,t,n){for(const r in e){const a=e[r],s=t[r];if(a.type==="tuple"&&s.type==="tuple"&&"components"in a&&"components"in s)return on(a.components,s.components,n[r]);const o=[a.type,s.type];if(o.includes("address")&&o.includes("bytes20")?!0:o.includes("address")&&o.includes("string")?Re(n[r],{strict:!1}):o.includes("address")&&o.includes("bytes")?Re(n[r],{strict:!1}):!1)return o}}function cn(e,t={}){const{prepare:n=!0}=t,r=Array.isArray(e)||typeof e=="string"?pt(e):e;return{...r,...n?{hash:K(r)}:{}}}function gs(e,t,n){const{args:r=[],prepare:a=!0}=n??{},s=nr(t,{strict:!1}),o=e.filter(c=>s?c.type==="function"||c.type==="error"?un(c)===Oe(t,0,4):c.type==="event"?K(c)===t:!1:"name"in c&&c.name===t);if(o.length===0)throw new _e({name:t});if(o.length===1)return{...o[0],...a?{hash:K(o[0])}:{}};let i;for(const c of o){if(!("inputs"in c))continue;if(!r||r.length===0){if(!c.inputs||c.inputs.length===0)return{...c,...a?{hash:K(c)}:{}};continue}if(!c.inputs||c.inputs.length===0||c.inputs.length!==r.length)continue;if(r.every((d,f)=>{const h="inputs"in c&&c.inputs[f];return h?Se(d,h):!1})){if(i&&"inputs"in i&&i.inputs){const d=on(c.inputs,i.inputs,r);if(d)throw new ws({abiItem:c,type:d[0]},{abiItem:i,type:d[1]})}i=c}}const u=(()=>{if(i)return i;const[c,...l]=o;return{...c,overloads:l}})();if(!u)throw new _e({name:t});return{...u,...a?{hash:K(u)}:{}}}function un(e){return Oe(K(e),0,4)}function ys(e){const t=typeof e=="string"?e:Be(e);return $e(t)}function K(e){return typeof e!="string"&&"hash"in e&&e.hash?e.hash:an(Me(ys(e)))}var ws=class extends _{constructor(e,t){super("Found ambiguous types in overloaded ABI Items.",{metaMessages:[`\`${e.type}\` in \`${$e(Be(e.abiItem))}\`, and`,`\`${t.type}\` in \`${$e(Be(t.abiItem))}\``,"","These types encode differently and cannot be distinguished at runtime.","Remove one of the ambiguous items in the ABI."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiItem.AmbiguityError"})}},_e=class extends _{constructor({name:e,data:t,type:n="item"}){const r=e?` with name "${e}"`:t?` with data "${t}"`:"";super(`ABI ${n}${r} not found.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiItem.NotFoundError"})}};const xs=/^(.*)\[([0-9]*)\]$/,ks=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,dn=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/,ya=2n**(8n-1n)-1n,wa=2n**(16n-1n)-1n,xa=2n**(24n-1n)-1n,ka=2n**(32n-1n)-1n,Ia=2n**(40n-1n)-1n,Pa=2n**(48n-1n)-1n,Aa=2n**(56n-1n)-1n,Na=2n**(64n-1n)-1n,Ea=2n**(72n-1n)-1n,Ba=2n**(80n-1n)-1n,Ta=2n**(88n-1n)-1n,Fa=2n**(96n-1n)-1n,Ca=2n**(104n-1n)-1n,Ra=2n**(112n-1n)-1n,$a=2n**(120n-1n)-1n,Sa=2n**(128n-1n)-1n,_a=2n**(136n-1n)-1n,Ua=2n**(144n-1n)-1n,qa=2n**(152n-1n)-1n,Ga=2n**(160n-1n)-1n,La=2n**(168n-1n)-1n,za=2n**(176n-1n)-1n,Ma=2n**(184n-1n)-1n,Oa=2n**(192n-1n)-1n,Da=2n**(200n-1n)-1n,Ha=2n**(208n-1n)-1n,ja=2n**(216n-1n)-1n,Va=2n**(224n-1n)-1n,Wa=2n**(232n-1n)-1n,Za=2n**(240n-1n)-1n,Ja=2n**(248n-1n)-1n,Ka=2n**(256n-1n)-1n,Qa=-(2n**(8n-1n)),Ya=-(2n**(16n-1n)),Xa=-(2n**(24n-1n)),eo=-(2n**(32n-1n)),to=-(2n**(40n-1n)),no=-(2n**(48n-1n)),ro=-(2n**(56n-1n)),so=-(2n**(64n-1n)),ao=-(2n**(72n-1n)),oo=-(2n**(80n-1n)),io=-(2n**(88n-1n)),co=-(2n**(96n-1n)),uo=-(2n**(104n-1n)),lo=-(2n**(112n-1n)),fo=-(2n**(120n-1n)),mo=-(2n**(128n-1n)),po=-(2n**(136n-1n)),bo=-(2n**(144n-1n)),ho=-(2n**(152n-1n)),vo=-(2n**(160n-1n)),go=-(2n**(168n-1n)),yo=-(2n**(176n-1n)),wo=-(2n**(184n-1n)),xo=-(2n**(192n-1n)),ko=-(2n**(200n-1n)),Io=-(2n**(208n-1n)),Po=-(2n**(216n-1n)),Ao=-(2n**(224n-1n)),No=-(2n**(232n-1n)),Eo=-(2n**(240n-1n)),Bo=-(2n**(248n-1n)),To=-(2n**(256n-1n)),Fo=2n**8n-1n,Co=2n**16n-1n,Ro=2n**24n-1n,$o=2n**32n-1n,So=2n**40n-1n,_o=2n**48n-1n,Uo=2n**56n-1n,qo=2n**64n-1n,Go=2n**72n-1n,Lo=2n**80n-1n,zo=2n**88n-1n,Mo=2n**96n-1n,Oo=2n**104n-1n,Do=2n**112n-1n,Ho=2n**120n-1n,jo=2n**128n-1n,Vo=2n**136n-1n,Wo=2n**144n-1n,Zo=2n**152n-1n,Jo=2n**160n-1n,Ko=2n**168n-1n,Qo=2n**176n-1n,Yo=2n**184n-1n,Xo=2n**192n-1n,ei=2n**200n-1n,ti=2n**208n-1n,ni=2n**216n-1n,ri=2n**224n-1n,si=2n**232n-1n,ai=2n**240n-1n,oi=2n**248n-1n,ii=2n**256n-1n;function Is({checksumAddress:e,parameters:t,values:n}){const r=[];for(let a=0;a<t.length;a++)r.push(nt({checksumAddress:e,parameter:t[a],value:n[a]}));return r}function nt({checksumAddress:e=!1,parameter:t,value:n}){const r=t,a=Cs(r.type);if(a){const[s,o]=a;return As(n,{checksumAddress:e,length:s,parameter:{...r,type:o}})}if(r.type==="tuple")return Fs(n,{checksumAddress:e,parameter:r});if(r.type==="address")return Ps(n,{checksum:e});if(r.type==="bool")return Es(n);if(r.type.startsWith("uint")||r.type.startsWith("int")){const s=r.type.startsWith("int"),[,,o="256"]=dn.exec(r.type)??[];return Bs(n,{signed:s,size:Number(o)})}if(r.type.startsWith("bytes"))return Ns(n,{type:r.type});if(r.type==="string")return Ts(n);throw new pn(r.type)}function rt(e){let t=0;for(let s=0;s<e.length;s++){const{dynamic:o,encoded:i}=e[s];o?t+=32:t+=X(i)}const n=[],r=[];let a=0;for(let s=0;s<e.length;s++){const{dynamic:o,encoded:i}=e[s];o?(n.push(ee(t+a,{size:32})),r.push(i),a+=X(i)):n.push(i)}return L(...n,...r)}function Ps(e,t){const{checksum:n=!1}=t;return Ae(e,{strict:n}),{dynamic:!1,encoded:ae(e.toLowerCase())}}function As(e,t){const{checksumAddress:n,length:r,parameter:a}=t,s=r===null;if(!Array.isArray(e))throw new $s(e);if(!s&&e.length!==r)throw new Rs({expectedLength:r,givenLength:e.length,type:`${a.type}[${r}]`});let o=!1;const i=[];for(let u=0;u<e.length;u++){const c=nt({checksumAddress:n,parameter:a,value:e[u]});c.dynamic&&(o=!0),i.push(c)}if(s||o){const u=rt(i);if(s){const c=ee(i.length,{size:32});return{dynamic:!0,encoded:i.length>0?L(c,u):c}}if(o)return{dynamic:!0,encoded:u}}return{dynamic:!1,encoded:L(...i.map(({encoded:u})=>u))}}function Ns(e,{type:t}){const[,n]=t.split("bytes"),r=X(e);if(!n){let a=e;return r%32!==0&&(a=oe(a,Math.ceil((e.length-2)/2/32)*32)),{dynamic:!0,encoded:L(ae(ee(r,{size:32})),a)}}if(r!==Number.parseInt(n))throw new fn({expectedSize:Number.parseInt(n),value:e});return{dynamic:!1,encoded:oe(e)}}function Es(e){if(typeof e!="boolean")throw new _(`Invalid boolean value: "${e}" (type: ${typeof e}). Expected: \`true\` or \`false\`.`);return{dynamic:!1,encoded:ae(Ct(e))}}function Bs(e,{signed:t,size:n}){if(typeof n=="number"){const r=2n**(BigInt(n)-(t?1n:0n))-1n,a=t?-r-1n:0n;if(e>r||e<a)throw new Mn({max:r.toString(),min:a.toString(),signed:t,size:n/8,value:e.toString()})}return{dynamic:!1,encoded:ee(e,{size:32,signed:t})}}function Ts(e){const t=Me(e),n=Math.ceil(X(t)/32),r=[];for(let a=0;a<n;a++)r.push(oe(Oe(t,a*32,(a+1)*32)));return{dynamic:!0,encoded:L(oe(ee(X(t),{size:32})),...r)}}function Fs(e,t){const{checksumAddress:n,parameter:r}=t;let a=!1;const s=[];for(let o=0;o<r.components.length;o++){const i=r.components[o],u=Array.isArray(e)?o:i.name,c=nt({checksumAddress:n,parameter:i,value:e[u]});s.push(c),c.dynamic&&(a=!0)}return{dynamic:a,encoded:a?rt(s):L(...s.map(({encoded:o})=>o))}}function Cs(e){const t=e.match(/^(.*)\[(\d+)?\]$/);return t?[t[2]?Number(t[2]):null,t[1]]:void 0}function ln(e,t,n){const{checksumAddress:r=!1}=n??{};if(e.length!==t.length)throw new mn({expectedLength:e.length,givenLength:t.length});const a=Is({checksumAddress:r,parameters:e,values:t}),s=rt(a);return s.length===0?"0x":s}function Ue(e,t){if(e.length!==t.length)throw new mn({expectedLength:e.length,givenLength:t.length});const n=[];for(let r=0;r<e.length;r++){const a=e[r],s=t[r];n.push(Ue.encode(a,s))}return L(...n)}(function(e){function t(n,r,a=!1){if(n==="address"){const u=r;return Ae(u),ae(u.toLowerCase(),a?32:0)}if(n==="string")return Me(r);if(n==="bytes")return r;if(n==="bool")return ae(Ct(r),a?32:1);const s=n.match(dn);if(s){const[u,c,l="256"]=s,d=Number.parseInt(l)/8;return ee(r,{size:a?32:d,signed:c==="int"})}const o=n.match(ks);if(o){const[u,c]=o;if(Number.parseInt(c)!==(r.length-2)/2)throw new fn({expectedSize:Number.parseInt(c),value:r});return oe(r,a?32:0)}const i=n.match(xs);if(i&&Array.isArray(r)){const[u,c]=i,l=[];for(let d=0;d<r.length;d++)l.push(t(c,r[d],!0));return l.length===0?"0x":L(...l)}throw new pn(n)}e.encode=t})(Ue||(Ue={}));var Rs=class extends _{constructor({expectedLength:e,givenLength:t,type:n}){super(`Array length mismatch for type \`${n}\`. Expected: \`${e}\`. Given: \`${t}\`.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.ArrayLengthMismatchError"})}},fn=class extends _{constructor({expectedSize:e,value:t}){super(`Size of bytes "${t}" (bytes${X(t)}) does not match expected size (bytes${e}).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.BytesSizeMismatchError"})}},mn=class extends _{constructor({expectedLength:e,givenLength:t}){super(["ABI encoding parameters/values length mismatch.",`Expected length (parameters): ${e}`,`Given length (values): ${t}`].join(`
`)),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.LengthMismatchError"})}},$s=class extends _{constructor(e){super(`Value \`${e}\` is not a valid array.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidArrayError"})}},pn=class extends _{constructor(e){super(`Type \`${e}\` is not a valid ABI Type.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AbiParameters.InvalidTypeError"})}};function Ss(e,t){var n;const{bytecode:r,args:a}=t;return L(r,!((n=e.inputs)===null||n===void 0)&&n.length&&(a!=null&&a.length)?ln(e.inputs,a):"0x")}function _s(e){return cn(e)}function Us(e,...t){const{overloads:n}=e,r=n?qs([e,...n],e.name,{args:t[0]}):e,a=Gs(r),s=t.length>0?ln(r.inputs,t[0]):void 0;return s?L(a,s):a}function J(e,t={}){return cn(e,t)}function qs(e,t,n){const r=gs(e,t,n);if(r.type!=="function")throw new _e({name:t,type:"function"});return r}function Gs(e){return un(e)}const Ls="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",q="0x0000000000000000000000000000000000000000",zs="0x6080604052348015600e575f80fd5b5061016d8061001c5f395ff3fe608060405234801561000f575f80fd5b5060043610610029575f3560e01c8063f8b2cb4f1461002d575b5f80fd5b610047600480360381019061004291906100db565b61005d565b604051610054919061011e565b60405180910390f35b5f8173ffffffffffffffffffffffffffffffffffffffff16319050919050565b5f80fd5b5f73ffffffffffffffffffffffffffffffffffffffff82169050919050565b5f6100aa82610081565b9050919050565b6100ba816100a0565b81146100c4575f80fd5b50565b5f813590506100d5816100b1565b92915050565b5f602082840312156100f0576100ef61007d565b5b5f6100fd848285016100c7565b91505092915050565b5f819050919050565b61011881610106565b82525050565b5f6020820190506101315f83018461010f565b9291505056fea26469706673582212203b9fe929fe995c7cf9887f0bdba8a36dd78e8b73f149b17d2d9ad7cd09d2dc6264736f6c634300081a0033";async function Ms(e,t){const{blockNumber:n,blockTag:r,calls:a,stateOverrides:s,traceAssetChanges:o,traceTransfers:i,validation:u}=t,c=t.account?W(t.account):void 0;if(o&&!c)throw new S("`account` is required when `traceAssetChanges` is true");const l=c?Ss(_s("constructor(bytes, bytes)"),{bytecode:Hn,args:[zs,Us(J("function getBalance(address)"),[c.address])]}):void 0,d=o?await Promise.all(t.calls.map(async w=>{if(!w.data&&!w.abi)return;const{accessList:$}=await tn(e,{account:c.address,...w,data:w.abi?Z(w):w.data});return $.map(({address:ne,storageKeys:le})=>le.length>0?ne:null)})).then(w=>w.flat().filter(Boolean)):[],f=s==null?void 0:s.map(w=>w.address===(c==null?void 0:c.address)?{...w,nonce:0}:w),h=await Ce(e,{blockNumber:n,blockTag:r,blocks:[...o?[{calls:[{data:l}],stateOverrides:s},{calls:d.map((w,$)=>({abi:[J("function balanceOf(address) returns (uint256)")],functionName:"balanceOf",args:[c.address],to:w,from:q,nonce:$})),stateOverrides:[{address:q,nonce:0}]}]:[],{calls:[...a,{}].map((w,$)=>({...w,from:c==null?void 0:c.address,nonce:$})),stateOverrides:f},...o?[{calls:[{data:l}]},{calls:d.map((w,$)=>({abi:[J("function balanceOf(address) returns (uint256)")],functionName:"balanceOf",args:[c.address],to:w,from:q,nonce:$})),stateOverrides:[{address:q,nonce:0}]},{calls:d.map((w,$)=>({to:w,abi:[J("function decimals() returns (uint256)")],functionName:"decimals",from:q,nonce:$})),stateOverrides:[{address:q,nonce:0}]},{calls:d.map((w,$)=>({to:w,abi:[J("function tokenURI(uint256) returns (string)")],functionName:"tokenURI",args:[0n],from:q,nonce:$})),stateOverrides:[{address:q,nonce:0}]},{calls:d.map((w,$)=>({to:w,abi:[J("function symbol() returns (string)")],functionName:"symbol",from:q,nonce:$})),stateOverrides:[{address:q,nonce:0}]}]:[]],traceTransfers:i,validation:u}),p=o?h[2]:h[0],[m,y,,b,v,g,I,E]=o?h:[],{calls:N,...P}=p,A=N.slice(0,-1)??[],k=(m==null?void 0:m.calls)??[],C=(y==null?void 0:y.calls)??[],B=[...k,...C].map(w=>w.status==="success"?Q(w.data):null),F=(b==null?void 0:b.calls)??[],R=(v==null?void 0:v.calls)??[],V=[...F,...R].map(w=>w.status==="success"?Q(w.data):null),U=((g==null?void 0:g.calls)??[]).map(w=>w.status==="success"?w.result:null),z=((E==null?void 0:E.calls)??[]).map(w=>w.status==="success"?w.result:null),M=((I==null?void 0:I.calls)??[]).map(w=>w.status==="success"?w.result:null),te=[];for(const[w,$]of V.entries()){const ne=B[w];if(typeof $!="bigint"||typeof ne!="bigint")continue;const le=U[w-1],hn=z[w-1],vn=M[w-1],at=w===0?{address:Ls,decimals:18,symbol:"ETH"}:{address:d[w-1],decimals:vn||le?Number(le??1):void 0,symbol:hn??void 0};te.some(gn=>gn.token.address===at.address)||te.push({token:at,value:{pre:ne,post:$,diff:$-ne}})}return{assetChanges:te,block:P,results:A}}function Os({r:e,s:t,to:n="hex",v:r,yParity:a}){const s=(()=>{if(a===0||a===1)return a;if(r&&(r===27n||r===28n||r>=35n))return r%2n===0n?1:0;throw new Error("Invalid `v` or `yParity` value")})(),o=`0x${new ur.Signature(Q(e),Q(t)).toCompactHex()}${s===0?"1b":"1c"}`;return n==="hex"?o:qe(o)}async function st(e,t){var n;const{address:r,factory:a,factoryData:s,hash:o,signature:i,universalSignatureVerifierAddress:u=(n=e.chain)===null||n===void 0||(n=n.contracts)===null||n===void 0||(n=n.universalSignatureVerifier)===null||n===void 0?void 0:n.address,...c}=t,l=Pt(i)?i:typeof i=="object"&&"r"in i&&"s"in i?Os(i):pe(i),d=await(async()=>!a&&!s||as(l)?l:os({address:a,data:s,signature:l}))();try{const f=u?{to:u,data:Z({abi:dt,functionName:"isValidSig",args:[r,o,d]}),...c}:{data:jn({abi:dt,args:[r,o,d],bytecode:tr}),...c},{data:h}=await x(e,ze,"call")(f);return Bn(h??"0x0")}catch(f){try{if(je(En(r),await zt({hash:o,signature:i})))return!0}catch{}if(f instanceof zn)return!1;throw f}}async function Ds(e,{address:t,message:n,factory:r,factoryData:a,signature:s,...o}){const i=Dt(n);return st(e,{address:t,factory:r,factoryData:a,hash:i,signature:s,...o})}async function Hs(e,t){const{address:n,factory:r,factoryData:a,signature:s,message:o,primaryType:i,types:u,domain:c,...l}=t,d=ir({message:o,primaryType:i,types:u,domain:c});return st(e,{address:n,factory:r,factoryData:a,hash:d,signature:s,...l})}function bn(e,{emitOnBegin:t=!1,emitMissed:n=!1,onBlockNumber:r,onError:a,poll:s,pollingInterval:o=e.pollingInterval}){const i=typeof s<"u"?s:!(e.transport.type==="webSocket"||e.transport.type==="fallback"&&e.transport.transports[0].config.type==="webSocket");let u;return i?(()=>{const d=D(["watchBlockNumber",e.uid,t,n,o]);return j(d,{onBlockNumber:r,onError:a},f=>ue(async()=>{try{const p=await x(e,de,"getBlockNumber")({cacheTime:0});if(u){if(p===u)return;if(p-u>1&&n)for(let m=u+1n;m<p;m++)f.onBlockNumber(m,u),u=m}(!u||p>u)&&(f.onBlockNumber(p,u),u=p)}catch(p){var h;(h=f.onError)===null||h===void 0||h.call(f,p)}},{emitOnBegin:t,interval:o}))})():(()=>{const d=D(["watchBlockNumber",e.uid,t,n]);return j(d,{onBlockNumber:r,onError:a},f=>{let h=!0,p=()=>h=!1;return(async()=>{try{const m=(()=>{if(e.transport.type==="fallback"){const b=e.transport.transports.find(v=>v.config.type==="webSocket");return b?b.value:e.transport}return e.transport})(),{unsubscribe:y}=await m.subscribe({params:["newHeads"],onData(b){var v;if(!h)return;const g=Q((v=b.result)===null||v===void 0?void 0:v.number);f.onBlockNumber(g,u),u=g},onError(b){var v;(v=f.onError)===null||v===void 0||v.call(f,b)}});p=y,h||p()}catch(m){a==null||a(m)}})(),()=>p()})})()}async function js(e,{confirmations:t=1,hash:n,onReplaced:r,pollingInterval:a=e.pollingInterval,retryCount:s=6,retryDelay:o=({count:u})=>~~(1<<u)*200,timeout:i=18e4}){const u=D(["waitForTransactionReceipt",e.uid,n]);let c,l,d,f=!1,h,p;const{promise:m,resolve:y,reject:b}=or(),v=i?setTimeout(()=>{p(),h(),b(new _n({hash:n}))},i):void 0;return h=j(u,{onReplaced:r,resolve:y,reject:b},g=>{p=x(e,bn,"watchBlockNumber")({emitMissed:!0,emitOnBegin:!0,poll:!0,pollingInterval:a,async onBlockNumber(I){const E=P=>{clearTimeout(v),p(),P(),h()};let N=I;if(!f)try{if(d){if(t>1&&(!d.blockNumber||N-d.blockNumber+1n<t))return;E(()=>g.resolve(d));return}if(c||(f=!0,await mt(async()=>{c=await x(e,tt,"getTransaction")({hash:n}),c.blockNumber&&(N=c.blockNumber)},{delay:o,retryCount:s}),f=!1),d=await x(e,Fe,"getTransactionReceipt")({hash:n}),t>1&&(!d.blockNumber||N-d.blockNumber+1n<t))return;E(()=>g.resolve(d))}catch(P){if(P instanceof At||P instanceof Nt){if(!c){f=!1;return}try{l=c,f=!0;const A=await mt(()=>x(e,G,"getBlock")({blockNumber:N,includeTransactions:!0}),{delay:o,retryCount:s,shouldRetry:({error:B})=>B instanceof jt});f=!1;const k=A.transactions.find(({from:B,nonce:F})=>B===l.from&&F===l.nonce);if(!k||(d=await x(e,Fe,"getTransactionReceipt")({hash:k.hash}),t>1&&(!d.blockNumber||N-d.blockNumber+1n<t)))return;let C="replaced";k.to===l.to&&k.value===l.value&&k.input===l.input?C="repriced":k.from===k.to&&k.value===0n&&(C="cancelled"),E(()=>{var B;(B=g.onReplaced)===null||B===void 0||B.call(g,{reason:C,replacedTransaction:l,transaction:k,transactionReceipt:d}),g.resolve(d)})}catch(A){E(()=>g.reject(A))}}else E(()=>g.reject(P))}}})}),m}function Vs(e,{blockTag:t="latest",emitMissed:n=!1,emitOnBegin:r=!1,onBlock:a,onError:s,includeTransactions:o,poll:i,pollingInterval:u=e.pollingInterval}){const c=typeof i<"u"?i:!(e.transport.type==="webSocket"||e.transport.type==="fallback"&&e.transport.transports[0].config.type==="webSocket"),l=o??!1;let d;return c?(()=>{const p=D(["watchBlocks",e.uid,t,n,r,l,u]);return j(p,{onBlock:a,onError:s},m=>ue(async()=>{try{const b=await x(e,G,"getBlock")({blockTag:t,includeTransactions:l});if(b.number!==null&&(d==null?void 0:d.number)!=null){if(b.number===d.number)return;if(b.number-d.number>1&&n)for(let v=(d==null?void 0:d.number)+1n;v<b.number;v++){const g=await x(e,G,"getBlock")({blockNumber:v,includeTransactions:l});m.onBlock(g,d),d=g}}((d==null?void 0:d.number)==null||t==="pending"&&(b==null?void 0:b.number)==null||b.number!==null&&b.number>d.number)&&(m.onBlock(b,d),d=b)}catch(b){var y;(y=m.onError)===null||y===void 0||y.call(m,b)}},{emitOnBegin:r,interval:u}))})():(()=>{let p=!0,m=!0,y=()=>p=!1;return(async()=>{try{r&&x(e,G,"getBlock")({blockTag:t,includeTransactions:l}).then(g=>{p&&m&&(a(g,void 0),m=!1)}).catch(s);const b=(()=>{if(e.transport.type==="fallback"){const g=e.transport.transports.find(I=>I.config.type==="webSocket");return g?g.value:e.transport}return e.transport})(),{unsubscribe:v}=await b.subscribe({params:["newHeads"],async onData(g){if(!p)return;const I=await x(e,G,"getBlock")({blockNumber:g.blockNumber,includeTransactions:l}).catch(()=>{});p&&(a(I,d),m=!1,d=I)},onError(g){s==null||s(g)}});y=v,p||y()}catch(b){s==null||s(b)}})(),()=>y()})()}function Ws(e,{address:t,args:n,batch:r=!0,event:a,events:s,fromBlock:o,onError:i,onLogs:u,poll:c,pollingInterval:l=e.pollingInterval,strict:d}){const f=typeof c<"u"?c:typeof o=="bigint"?!0:!(e.transport.type==="webSocket"||e.transport.type==="fallback"&&e.transport.transports[0].config.type==="webSocket"),h=d??!1;return f?(()=>{const y=D(["watchEvent",t,n,r,e.uid,a,l,o]);return j(y,{onLogs:u,onError:i},b=>{let v;o!==void 0&&(v=o-1n);let g,I=!1;const E=ue(async()=>{if(!I){try{g=await x(e,nn,"createEventFilter")({address:t,args:n,event:a,events:s,strict:h,fromBlock:o})}catch{}I=!0;return}try{let P;if(g)P=await x(e,ke,"getFilterChanges")({filter:g});else{const A=await x(e,de,"getBlockNumber")({});v&&v!==A?P=await x(e,Qe,"getLogs")({address:t,args:n,event:a,events:s,fromBlock:v+1n,toBlock:A}):P=[],v=A}if(P.length===0)return;if(r)b.onLogs(P);else for(const A of P)b.onLogs([A])}catch(P){var N;g&&P instanceof Lt&&(I=!1),(N=b.onError)===null||N===void 0||N.call(b,P)}},{emitOnBegin:!0,interval:l});return async()=>{g&&await x(e,Ie,"uninstallFilter")({filter:g}),E()}})})():(()=>{let y=!0,b=()=>y=!1;return(async()=>{try{const v=(()=>{if(e.transport.type==="fallback"){const N=e.transport.transports.find(P=>P.config.type==="webSocket");return N?N.value:e.transport}return e.transport})(),g=s??(a?[a]:void 0);let I=[];g&&(I=[g.flatMap(P=>ce({abi:[P],eventName:P.name,args:n}))],a&&(I=I[0]));const{unsubscribe:E}=await v.subscribe({params:["logs",{address:t,topics:I}],onData(N){if(!y)return;const P=N.result;try{const{eventName:k,args:C}=Je({abi:g??[],data:P.data,topics:P.topics,strict:h}),B=O(P,{args:C,eventName:k});u([B])}catch(k){let C,B;if(k instanceof ie||k instanceof we){var A;if(d)return;C=k.abiItem.name,B=(A=k.abiItem.inputs)===null||A===void 0?void 0:A.some(R=>!("name"in R&&R.name))}const F=O(P,{args:B?[]:{},eventName:C});u([F])}},onError(N){i==null||i(N)}});b=E,y||b()}catch(v){i==null||i(v)}})(),()=>b()})()}function Zs(e,{batch:t=!0,onError:n,onTransactions:r,poll:a,pollingInterval:s=e.pollingInterval}){return(typeof a<"u"?a:e.transport.type!=="webSocket")?(()=>{const c=D(["watchPendingTransactions",e.uid,t,s]);return j(c,{onTransactions:r,onError:n},l=>{let d;const f=ue(async()=>{try{if(!d)try{d=await x(e,rn,"createPendingTransactionFilter")({});return}catch(m){throw f(),m}const p=await x(e,ke,"getFilterChanges")({filter:d});if(p.length===0)return;if(t)l.onTransactions(p);else for(const m of p)l.onTransactions([m])}catch(p){var h;(h=l.onError)===null||h===void 0||h.call(l,p)}},{emitOnBegin:!0,interval:s});return async()=>{d&&await x(e,Ie,"uninstallFilter")({filter:d}),f()}})})():(()=>{let c=!0,l=()=>c=!1;return(async()=>{try{const{unsubscribe:d}=await e.transport.subscribe({params:["newPendingTransactions"],onData(f){if(!c)return;const h=f.result;r([h])},onError(f){n==null||n(f)}});l=d,c||l()}catch(d){n==null||n(d)}})(),()=>l()})()}function Js(e){var t,n,r;const{scheme:a,statement:s,...o}=((t=e.match(Ks))===null||t===void 0?void 0:t.groups)??{},{chainId:i,expirationTime:u,issuedAt:c,notBefore:l,requestId:d,...f}=((n=e.match(Qs))===null||n===void 0?void 0:n.groups)??{},h=(r=e.split("Resources:")[1])===null||r===void 0?void 0:r.split(`
- `).slice(1);return{...o,...f,...i?{chainId:Number(i)}:{},...u?{expirationTime:new Date(u)}:{},...c?{issuedAt:new Date(c)}:{},...l?{notBefore:new Date(l)}:{},...d?{requestId:d}:{},...h?{resources:h}:{},...a?{scheme:a}:{},...s?{statement:s}:{}}}const Ks=/^(?:(?<scheme>[a-zA-Z][a-zA-Z0-9+-.]*):\/\/)?(?<domain>[a-zA-Z0-9+-.]*(?::[0-9]{1,5})?) (?:wants you to sign in with your Ethereum account:\n)(?<address>0x[a-fA-F0-9]{40})\n\n(?:(?<statement>.*)\n\n)?/,Qs=/(?:URI: (?<uri>.+))\n(?:Version: (?<version>.+))\n(?:Chain ID: (?<chainId>\d+))\n(?:Nonce: (?<nonce>[a-zA-Z0-9]+))\n(?:Issued At: (?<issuedAt>.+))(?:\nExpiration Time: (?<expirationTime>.+))?(?:\nNot Before: (?<notBefore>.+))?(?:\nRequest ID: (?<requestId>.+))?/;function Ys(e){const{address:t,domain:n,message:r,nonce:a,scheme:s,time:o=new Date}=e;if(n&&r.domain!==n||a&&r.nonce!==a||s&&r.scheme!==s||r.expirationTime&&o>=r.expirationTime||r.notBefore&&o<r.notBefore)return!1;try{if(!r.address||!Fn(r.address,{strict:!1})||t&&!je(r.address,t))return!1}catch{return!1}return!0}async function Xs(e,t){const{address:n,domain:r,message:a,nonce:s,scheme:o,signature:i,time:u=new Date,...c}=t,l=Js(a);if(!l.address||!Ys({address:n,domain:r,message:l,nonce:s,scheme:o,time:u}))return!1;const f=Dt(a);return st(e,{address:l.address,hash:f,signature:i,...c})}function ci(e){return{call:t=>ze(e,t),createAccessList:t=>tn(e,t),createBlockFilter:()=>Kr(e),createContractEventFilter:t=>Ht(e,t),createEventFilter:t=>nn(e,t),createPendingTransactionFilter:()=>rn(e),estimateContractGas:t=>wr(e,t),estimateGas:t=>Ze(e,t),getBalance:t=>Mt(e,t),getBlobBaseFee:()=>Qr(e),getBlock:t=>G(e,t),getBlockNumber:t=>de(e,t),getBlockTransactionCount:t=>Yr(e,t),getBytecode:t=>xt(e,t),getChainId:()=>Zt(e),getCode:t=>xt(e,t),getContractEvents:t=>Kt(e,t),getEip712Domain:t=>es(e,t),getEnsAddress:t=>Sr(e,t),getEnsAvatar:t=>Wr(e,t),getEnsName:t=>Zr(e,t),getEnsResolver:t=>Jr(e,t),getEnsText:t=>en(e,t),getFeeHistory:t=>rs(e,t),estimateFeesPerGas:t=>gr(e,t),getFilterChanges:t=>ke(e,t),getFilterLogs:t=>ss(e,t),getGasPrice:()=>We(e),getLogs:t=>Qe(e,t),getProof:t=>us(e,t),estimateMaxPriorityFeePerGas:t=>vr(e,t),getStorageAt:t=>ds(e,t),getTransaction:t=>tt(e,t),getTransactionConfirmations:t=>ls(e,t),getTransactionCount:t=>Wt(e,t),getTransactionReceipt:t=>Fe(e,t),multicall:t=>cr(e,t),prepareTransactionRequest:t=>Jt(e,t),readContract:t=>H(e,t),sendRawTransaction:t=>Cr(e,t),simulate:t=>Ce(e,t),simulateBlocks:t=>Ce(e,t),simulateCalls:t=>Ms(e,t),simulateContract:t=>Ir(e,t),verifyMessage:t=>Ds(e,t),verifySiweMessage:t=>Xs(e,t),verifyTypedData:t=>Hs(e,t),uninstallFilter:t=>Ie(e,t),waitForTransactionReceipt:t=>js(e,t),watchBlocks:t=>Vs(e,t),watchBlockNumber:t=>bn(e,t),watchContractEvent:t=>Fr(e,t),watchEvent:t=>Ws(e,t),watchPendingTransactions:t=>Zs(e,t)}}export{Zr as getEnsName,tt as getTransaction,ci as publicActions};
