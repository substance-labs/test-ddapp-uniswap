import{protoBase64 as Q}from"./proto3-DkSQZto4.js";var l;(function(e){e[e.Canceled=1]="Canceled",e[e.Unknown=2]="Unknown",e[e.InvalidArgument=3]="InvalidArgument",e[e.DeadlineExceeded=4]="DeadlineExceeded",e[e.NotFound=5]="NotFound",e[e.AlreadyExists=6]="AlreadyExists",e[e.PermissionDenied=7]="PermissionDenied",e[e.ResourceExhausted=8]="ResourceExhausted",e[e.FailedPrecondition=9]="FailedPrecondition",e[e.Aborted=10]="Aborted",e[e.OutOfRange=11]="OutOfRange",e[e.Unimplemented=12]="Unimplemented",e[e.Internal=13]="Internal",e[e.Unavailable=14]="Unavailable",e[e.DataLoss=15]="DataLoss",e[e.Unauthenticated=16]="Unauthenticated"})(l||(l={}));function R(e){const n=l[e];return typeof n!="string"?e.toString():n[0].toLowerCase()+n.substring(1).replace(/[A-Z]/g,t=>"_"+t.toLowerCase())}let j;function re(e){if(!j){j={};for(const n of Object.values(l))typeof n!="string"&&(j[R(n)]=n)}return j[e]}var p=class E extends Error{constructor(n,t=l.Unknown,a,r,o){super(ae(n,t)),this.name="ConnectError",Object.setPrototypeOf(this,new.target.prototype),this.rawMessage=n,this.code=t,this.metadata=new Headers(a??{}),this.details=r??[],this.cause=o}static from(n,t=l.Unknown){return n instanceof E?n:n instanceof Error?n.name=="AbortError"?new E(n.message,l.Canceled):new E(n.message,t,void 0,void 0,n):new E(String(n),t,void 0,void 0,n)}static[Symbol.hasInstance](n){return n instanceof Error?Object.getPrototypeOf(n)===E.prototype?!0:n.name==="ConnectError"&&"code"in n&&typeof n.code=="number"&&"metadata"in n&&"details"in n&&Array.isArray(n.details)&&"rawMessage"in n&&typeof n.rawMessage=="string"&&"cause"in n:!1}findDetails(n){const t="typeName"in n?{findMessage:r=>r===n.typeName?n:void 0}:n,a=[];for(const r of this.details){if("getType"in r){t.findMessage(r.getType().typeName)&&a.push(r);continue}const o=t.findMessage(r.type);if(o)try{a.push(o.fromBinary(r.value))}catch{}}return a}};function ae(e,n){return e.length?`[${R(n)}] ${e}`:`[${R(n)}]`}var A;(function(e){e[e.Unary=0]="Unary",e[e.ServerStreaming=1]="ServerStreaming",e[e.ClientStreaming=2]="ClientStreaming",e[e.BiDiStreaming=3]="BiDiStreaming"})(A||(A={}));var D;(function(e){e[e.NoSideEffects=1]="NoSideEffects",e[e.Idempotent=2]="Idempotent"})(D||(D={}));function oe(...e){const n=new Headers;for(const t of e)t.forEach((a,r)=>{n.append(r,a)});return n}function ie(e){let n,t=new Uint8Array(0);function a(r){const o=new Uint8Array(t.length+r.length);o.set(t),o.set(r,t.length),t=o}return new ReadableStream({start(){n=e.getReader()},async pull(r){let o;for(;;){if(o===void 0&&t.byteLength>=5){let u=0;for(let d=1;d<5;d++)u=(u<<8)+t[d];o={flags:t[0],length:u}}if(o!==void 0&&t.byteLength>=o.length+5)break;const s=await n.read();if(s.done)break;a(s.value)}if(o===void 0){if(t.byteLength==0){r.close();return}r.error(new p("premature end of stream",l.DataLoss));return}const i=t.subarray(5,5+o.length);t=t.subarray(5+o.length),r.enqueue({flags:o.flags,data:i})}})}function se(e,n){const t=new Uint8Array(n.length+5);t.set(n,5);const a=new DataView(t.buffer,t.byteOffset,t.byteLength);return a.setUint8(0,e),a.setUint32(1,n.length),t}function ce(...e){const n=new AbortController,t=e.filter(r=>r!==void 0).concat(n.signal);for(const r of t){if(r.aborted){a.apply(r);break}r.addEventListener("abort",a)}function a(){n.signal.aborted||n.abort(X(this));for(const r of t)r.removeEventListener("abort",a)}return n}function le(e){const n=new AbortController,t=()=>{n.abort(new p("the operation timed out",l.DeadlineExceeded))};let a;return e!==void 0&&(e<=0?t():a=setTimeout(t,e)),{signal:n.signal,cleanup:()=>clearTimeout(a)}}function X(e){if(!e.aborted)return;if(e.reason!==void 0)return e.reason;const n=new Error("This operation was aborted");return n.name="AbortError",n}function H(){return{get(e){return e.id in this?this[e.id]:e.defaultValue},set(e,n){return this[e.id]=n,this},delete(e){return delete this[e.id],this}}}function N(e,n,t){const a=typeof n=="string"?n:n.typeName,r=typeof t=="string"?t:t.name;return e.toString().replace(/\/?$/,`/${a}/${r}`)}function Y(e,n){return n instanceof e?n:new e(n)}function ue(e,n){function t(a){return a.done===!0?a:{done:a.done,value:Y(e,a.value)}}return{[Symbol.asyncIterator](){const a=n[Symbol.asyncIterator](),r={next:()=>a.next().then(t)};return a.throw!==void 0&&(r.throw=o=>a.throw(o).then(t)),a.return!==void 0&&(r.return=o=>a.return(o).then(t)),r}}}function V(e,n){var t;return(t=n==null?void 0:n.concat().reverse().reduce((a,r)=>r(a),e))!==null&&t!==void 0?t:e}function K(e){var n;const t=Object.assign({},e);return(n=t.ignoreUnknownFields)!==null&&n!==void 0||(t.ignoreUnknownFields=!0),t}function z(e,n,t,a){const r=n?J(e.I,a):B(e.I,t);return{parse:(n?J(e.O,a):B(e.O,t)).parse,serialize:r.serialize}}function J(e,n){return{parse(t){try{return e.fromBinary(t,n)}catch(a){const r=a instanceof Error?a.message:String(a);throw new p(`parse binary: ${r}`,l.InvalidArgument)}},serialize(t){try{return t.toBinary(n)}catch(a){const r=a instanceof Error?a.message:String(a);throw new p(`serialize binary: ${r}`,l.Internal)}}}}function B(e,n){var t,a;const r=(t=n==null?void 0:n.textEncoder)!==null&&t!==void 0?t:new TextEncoder,o=(a=n==null?void 0:n.textDecoder)!==null&&a!==void 0?a:new TextDecoder,i=K(n);return{parse(s){try{const u=o.decode(s);return e.fromJsonString(u,i)}catch(u){throw p.from(u,l.InvalidArgument)}},serialize(s){try{const u=s.toJsonString(i);return r.encode(u)}catch(u){throw p.from(u,l.Internal)}}}}const de=/^application\/(connect\+)?(?:(json)(?:; ?charset=utf-?8)?|(proto))$/i,fe="application/proto",ge="application/json",ye="application/connect+proto",he="application/connect+json";function pe(e){const n=e==null?void 0:e.match(de);if(!n)return;const t=!!n[1],a=!!n[3];return{stream:t,binary:a}}function M(e,n,t){if(n&&new Headers(n).forEach((i,s)=>t.metadata.append(s,i)),typeof e!="object"||e==null||Array.isArray(e)||!("code"in e)||typeof e.code!="string")throw t;const a=re(e.code);if(a===void 0)throw t;const r=e.message;if(r!=null&&typeof r!="string")throw t;const o=new p(r??"",a,n);if("details"in e&&Array.isArray(e.details))for(const i of e.details){if(i===null||typeof i!="object"||Array.isArray(i)||typeof i.type!="string"||typeof i.value!="string"||"debug"in i&&typeof i.debug!="object")throw t;try{o.details.push({type:i.type,value:Q.dec(i.value),debug:i.debug})}catch{throw t}}return o}const k=2;function me(e){const n=new p("invalid end stream",l.InvalidArgument);let t;try{t=JSON.parse(typeof e=="string"?e:new TextDecoder().decode(e))}catch{throw n}if(typeof t!="object"||t==null||Array.isArray(t))throw n;const a=new Headers;if("metadata"in t){if(typeof t.metadata!="object"||t.metadata==null||Array.isArray(t.metadata))throw n;for(const[o,i]of Object.entries(t.metadata)){if(!Array.isArray(i)||i.some(s=>typeof s!="string"))throw n;for(const s of i)a.append(o,s)}}const r="error"in t?M(t.error,a,n):void 0;return{metadata:a,error:r}}const L="Content-Type",be="Content-Length",C="Content-Encoding",ve="Accept-Encoding",we="Connect-Timeout-Ms",$="Connect-Protocol-Version",Ee="User-Agent";function Se(e){switch(e){case 400:return l.InvalidArgument;case 401:return l.Unauthenticated;case 403:return l.PermissionDenied;case 404:return l.Unimplemented;case 408:return l.DeadlineExceeded;case 409:return l.Aborted;case 412:return l.FailedPrecondition;case 413:return l.ResourceExhausted;case 415:return l.Internal;case 429:return l.Unavailable;case 431:return l.ResourceExhausted;case 502:return l.Unavailable;case 503:return l.Unavailable;case 504:return l.Unavailable;default:return l.Unknown}}function G(e){const n=new Headers,t=new Headers;return e.forEach((a,r)=>{r.toLowerCase().startsWith("trailer-")?t.set(r.substring(8),a):n.set(r,a)}),[n,t]}const ee="1";function q(e,n,t,a,r){const o=new Headers(a??{});return t!==void 0&&o.set(we,`${t}`),o.set(L,e==A.Unary?n?fe:ge:n?ye:he),o.set($,ee),r&&o.set(Ee,"connect-es/1.4.0"),o}function W(e,n,t){const a=t.get("Content-Type"),r=pe(a);if(n!==200){const o=new p(`HTTP ${n}`,Se(n),t);if(e==A.Unary&&r&&!r.binary)return{isUnaryError:!0,unaryError:o};throw o}return{isUnaryError:!1}}const Z="application/";function Ue(e,n){return n?Q.enc(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""):encodeURIComponent(new TextDecoder().decode(e))}function Ae(e,n,t){let a=`?connect=v${ee}`;const r=e.header.get(L);(r==null?void 0:r.indexOf(Z))===0&&(a+="&encoding="+encodeURIComponent(r.slice(Z.length)));const o=e.header.get(C);o!==null&&o!=="identity"&&(a+="&compression="+encodeURIComponent(o),t=!0),t&&(a+="&base64=1"),a+="&message="+Ue(n,t);const i=e.url+a,s=new Headers(e.header);return[$,L,be,C,ve].forEach(u=>s.delete(u)),Object.assign(Object.assign({},e),{init:Object.assign(Object.assign({},e.init),{method:"GET"}),url:i,header:s})}function Oe(e){const n=V(e.next,e.interceptors),[t,a,r]=ne(e),o=Object.assign(Object.assign({},e.req),{message:Y(e.req.method.I,e.req.message),signal:t});return n(o).then(i=>(r(),i),a)}function xe(e){const n=V(e.next,e.interceptors),[t,a,r]=ne(e),o=Object.assign(Object.assign({},e.req),{message:ue(e.req.method.I,e.req.message),signal:t});let i=!1;return t.addEventListener("abort",function(){var s,u;const d=e.req.message[Symbol.asyncIterator]();i||(s=d.throw)===null||s===void 0||s.call(d,this.reason).catch(()=>{}),(u=d.return)===null||u===void 0||u.call(d).catch(()=>{})}),n(o).then(s=>Object.assign(Object.assign({},s),{message:{[Symbol.asyncIterator](){const u=s.message[Symbol.asyncIterator]();return{next(){return u.next().then(d=>(d.done==!0&&(i=!0,r()),d),a)}}}}}),a)}function ne(e){const{signal:n,cleanup:t}=le(e.timeoutMs),a=ce(e.signal,n);return[a.signal,function(o){const i=p.from(n.aborted?X(n):o);return a.abort(i),t(),Promise.reject(i)},function(){t(),a.abort()}]}function Te(){try{new Headers}catch{throw new Error("connect-web requires the fetch API. Are you running on an old version of Node.js? Node.js is not supported in Connect for Web - please stay tuned for Connect for Node.")}}var O=function(e){return this instanceof O?(this.v=e,this):new O(e)},je=function(e,n,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=t.apply(e,n||[]),r,o=[];return r={},s("next"),s("throw"),s("return",i),r[Symbol.asyncIterator]=function(){return this},r;function i(c){return function(y){return Promise.resolve(y).then(c,b)}}function s(c,y){a[c]&&(r[c]=function(f){return new Promise(function(h,S){o.push([c,f,h,S])>1||u(c,f)})},y&&(r[c]=y(r[c])))}function u(c,y){try{d(a[c](y))}catch(f){v(o[0][3],f)}}function d(c){c.value instanceof O?Promise.resolve(c.value.v).then(m,b):v(o[0][2],c)}function m(c){u("next",c)}function b(c){u("throw",c)}function v(c,y){c(y),o.shift(),o.length&&u(o[0][0],o[0][1])}};function Pe(e){var n;Te();const t=(n=e.useBinaryFormat)!==null&&n!==void 0?n:!1;return{async unary(a,r,o,i,s,u,d){var m;const{serialize:b,parse:v}=z(r,t,e.jsonOptions,e.binaryOptions);return i=i===void 0?e.defaultTimeoutMs:i<=0?void 0:i,await Oe({interceptors:e.interceptors,signal:o,timeoutMs:i,req:{stream:!1,service:a,method:r,url:N(e.baseUrl,a,r),init:{method:"POST",credentials:(m=e.credentials)!==null&&m!==void 0?m:"same-origin",redirect:"error",mode:"cors"},header:q(r.kind,t,i,s,!1),contextValues:d??H(),message:u},next:async c=>{var y;const f=e.useHttpGet===!0&&r.idempotency===D.NoSideEffects;let h=null;f?c=Ae(c,b(c.message),t):h=b(c.message);const g=await((y=e.fetch)!==null&&y!==void 0?y:globalThis.fetch)(c.url,Object.assign(Object.assign({},c.init),{headers:c.header,signal:c.signal,body:h})),{isUnaryError:w,unaryError:U}=W(r.kind,g.status,g.headers);if(w)throw M(await g.json(),oe(...G(g.headers)),U);const[x,I]=G(g.headers);return{stream:!1,service:a,method:r,header:x,message:t?v(new Uint8Array(await g.arrayBuffer())):r.O.fromJson(await g.json(),K(e.jsonOptions)),trailer:I}}})},async stream(a,r,o,i,s,u,d){var m;const{serialize:b,parse:v}=z(r,t,e.jsonOptions,e.binaryOptions);function c(f,h,S){return je(this,arguments,function*(){const w=ie(f).getReader();let U=!1;for(;;){const x=yield O(w.read());if(x.done)break;const{flags:I,data:F}=x.value;if((I&k)===k){U=!0;const P=me(F);if(P.error){const T=P.error;throw S.forEach((_,te)=>{T.metadata.append(te,_)}),T}P.metadata.forEach((T,_)=>h.set(_,T));continue}yield yield O(v(F))}if(!U)throw"missing EndStreamResponse"})}async function y(f){if(r.kind!=A.ServerStreaming)throw"The fetch API does not support streaming request bodies";const h=await f[Symbol.asyncIterator]().next();if(h.done==!0)throw"missing request message";return se(0,b(h.value))}return i=i===void 0?e.defaultTimeoutMs:i<=0?void 0:i,await xe({interceptors:e.interceptors,timeoutMs:i,signal:o,req:{stream:!0,service:a,method:r,url:N(e.baseUrl,a,r),init:{method:"POST",credentials:(m=e.credentials)!==null&&m!==void 0?m:"same-origin",redirect:"error",mode:"cors"},header:q(r.kind,t,i,s,!1),contextValues:d??H(),message:u},next:async f=>{var h;const g=await((h=e.fetch)!==null&&h!==void 0?h:globalThis.fetch)(f.url,Object.assign(Object.assign({},f.init),{headers:f.header,signal:f.signal,body:await y(f.message)}));if(W(r.kind,g.status,g.headers),g.body===null)throw"missing response body";const w=new Headers;return Object.assign(Object.assign({},f),{header:g.headers,trailer:w,message:c(g.body,w,g.headers)})}})}}}export{l as Code,p as ConnectError,D as MethodIdempotency,A as MethodKind,Pe as createConnectTransport};
