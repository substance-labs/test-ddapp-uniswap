import{__toESM as y}from"./chunk-DgAfPHQg.js";import"./preload-helper-CaakwtpC.js";import{require_react as v}from"./react-CNoFhWkx.js";import{Button as g,SpinningLoader as E}from"./src-DOOtfpHS.js";import{useTranslation as j}from"./useTranslation-BotBuoJf.js";import"./index.web-BqgtOHN3.js";import"./react-dom-xovCOntK.js";import"./cache-BFZkIToX.js";import"./dist-Q7olfaoJ.js";import"./tslib.es6-Dbpxy1u8.js";import"./dist-QCpUvRkJ.js";import{useSearchParams as A}from"./chunk-QMGIS6GS-B91ZVkXt.js";import{require_jsx_runtime as D}from"./jsx-runtime-D7bMTQeG.js";import{getChromeRuntime as w,getChromeRuntimeWithThrow as R,logger as o}from"./hooks-BXO4d1DJ.js";import"./dist-ceZDlR1V.js";import"./analytics.web-DLc1_wTk.js";import"./bn-D7somgUb.js";import"./lib-DPFIyRke.js";import"./config-C4KrHqHG.js";import{ONE_SECOND_MS as q}from"./time-D_OqcZ4M.js";import{InterfacePageName as C}from"./page-zDkoCQe4.js";import"./lib-CKG8APVv.js";import"./lib-XGdDYWzD.js";import"./hash-05APZTFm.js";import"./inherits_browser-Dqx8HagI.js";import"./useQuery-D_ZCw8XG.js";import"./lib-CWHZrl0T.js";import"./lib-BncBk3QF.js";import"./utils-7WDx1QGa.js";import"./addresses-D56PBUHX.js";import"./configs-B4dDdw82.js";import"./hooks-Bp0VtWbX.js";import"./statsig-B7I9iQRf.js";import{uniswapUrls as N}from"./urls-kwiZbYPW.js";import"./TraceContext-Ddfk7zjz.js";import{authenticatePasskey as U}from"./passkey.web-DakcatU3.js";import{Text as _}from"./Loader-D83W8G1W.js";import"./client-BlU1ozBP.js";import{Anchor as M}from"./Anchor-B1nkrQbP.js";import"./urls-aCnKF23w.js";import"./encode-utf8-DiSL6KQ9.js";import"./dijkstra-6umg7ymP.js";import"./UniconSVGs-CVEtuhJW.js";import{Passkey as z}from"./Passkey-Bey7xD4Z.js";import{UniswapLogo as O}from"./UniswapLogo-D1ayVSkF.js";import{useTimeout as F,z as i}from"./timing-DsWr56iv.js";import{Trace_default as H}from"./Trace-DgHN3Ak9.js";import{EnvelopeHeartIcon as B}from"./EnvelopeHeart-DxsgNuRq.js";import{useExternallyConnectableExtensionId as W}from"./useExternallyConnectableExtensionId-s_V-9ZjG.js";function L(t,r){try{return r.parse(t)}catch{return}}const m=i.object({});let T=(function(t){return t.PasskeyRequest="PasskeyRequest",t})({});const V=m.extend({type:i.literal(T.PasskeyRequest),requestId:i.string(),challengeJson:i.string()});let p=(function(t){return t.PasskeySignInFlowOpened="PasskeySignInFlowOpened",t.PasskeyCredentialRetrieved="PasskeyCredentialRetrieved",t.PasskeyCredentialError="PasskeyCredentialError",t})({});const Xe=m.extend({type:i.literal(p.PasskeySignInFlowOpened),requestId:i.string()}),Ge=m.extend({type:i.literal(p.PasskeyCredentialRetrieved),requestId:i.string(),credential:i.string()}),Ke=m.extend({type:i.literal(p.PasskeyCredentialError),requestId:i.string(),error:i.string()});var u=y(v()),e=y(D());const J="  _display-flex _alignItems-stretch _flexBasis-auto _boxSizing-border-box _position-relative _minHeight-0px _minWidth-0px _flexShrink-0 _flexDirection-row _pt-t-space-spa1360334076 _pb-t-space-spa1360334076 ",h="  _display-flex _flexBasis-auto _boxSizing-border-box _position-relative _minHeight-0px _minWidth-0px _flexShrink-0 _flexDirection-column _alignItems-center _pr-t-space-spa1360333927 _pl-t-space-spa1360333927 ",f="  _display-flex _flexBasis-auto _boxSizing-border-box _position-relative _minHeight-0px _minWidth-0px _flexShrink-0 _flexDirection-column _alignItems-center ",X="  _display-flex _alignItems-stretch _flexBasis-auto _boxSizing-border-box _position-relative _minHeight-0px _minWidth-0px _flexShrink-0 _flexDirection-row _width-fit-content ",G="  _display-flex _alignItems-stretch _flexBasis-auto _boxSizing-border-box _position-relative _minHeight-0px _minWidth-0px _flexShrink-0 _flexDirection-row _justifyContent-flex-end ",K="  _display-flex _alignItems-stretch _flexBasis-auto _boxSizing-border-box _position-relative _minHeight-0px _minWidth-0px _flexShrink-0 _width-400px _pt-t-space-spa1360334076 _pr-t-space-spa1360334076 _pb-t-space-spa1360334076 _pl-t-space-spa1360334076 _flexDirection-column _gap-t-space-spa1360334076 ",Q="  _display-flex _flexBasis-auto _boxSizing-border-box _position-relative _minWidth-0px _flexShrink-0 _flexDirection-column _alignItems-center _justifyContent-center _minHeight-100vh ",Y=q*3;var s=(function(t){return t.Verifying="Verifying",t.Allowed="Allowed",t.Denied="Denied",t})(s||{});function Qe(){const{t}=j(),r=W(),[a,d]=(0,u.useState)(s.Verifying),[c,P]=(0,u.useState)(null),[k]=A();(0,u.useEffect)(()=>{const n=w();if(!(n!=null&&n.sendMessage)){o.debug("ExtensionPasskeyAuthPopUp/index.tsx","useEffect","No `chrome.runtime` found"),d(s.Denied);return}const l=k.get("request_id");if(!l){o.debug("ExtensionPasskeyAuthPopUp/index.tsx","useEffect","No `request_id` found"),d(s.Denied);return}const S=async b=>{const x=L(b,V);if(!x){d(s.Denied);return}o.debug("ExtensionPasskeyAuthPopUp/index.tsx","handleMessageRequestPasskey",`Message received: ${x.type}`),d(s.Allowed),P(x)};o.debug("ExtensionPasskeyAuthPopUp/index.tsx","useEffect",`Sending PasskeySignInFlowOpened message to extension ID ${r}`),n.sendMessage(r,{type:p.PasskeySignInFlowOpened,requestId:l},S)},[]);const I=async()=>{if(a!==s.Allowed||!c){o.debug("ExtensionPasskeyAuthPopUp/index.tsx","onPressSignIn","Invalid state",{signInAttemptStatus:a,passkeyRequestData:c});return}const n=R();try{const l=await U(c.challengeJson);if(!l){o.debug("ExtensionPasskeyAuthPopUp/index.tsx","onPressSignIn",`Sending PasskeyCredentialError message to extension ID ${r}`),n.sendMessage(r,{type:p.PasskeyCredentialError,requestId:c.requestId,error:"No credential returned"});return}o.debug("ExtensionPasskeyAuthPopUp/index.tsx","onPressSignIn",`Sending PasskeyCredentialRetrieved message to extension ID ${r}`),n.sendMessage(r,{type:p.PasskeyCredentialRetrieved,requestId:c.requestId,credential:l})}catch(l){o.error(l,{tags:{file:"ExtensionPasskeyAuthPopUp/index.tsx",function:"onPressSignIn"}})}};return F(()=>{d(n=>n===s.Verifying?s.Denied:n)},Y),(0,e.jsx)(H,{logImpression:!0,page:C.ExtensionPasskeySignInPage,children:(0,e.jsx)("div",{className:Q,children:(0,e.jsxs)("div",{className:K,children:[(0,e.jsx)("div",{className:G,children:(0,e.jsx)("div",{className:X,children:(0,e.jsx)(M,{target:"_blank",rel:"noreferrer",href:N.helpArticleUrls.passkeysInfo,textDecorationLine:"none",children:(0,e.jsx)(g,{icon:(0,e.jsx)(B,{}),size:"xxsmall",emphasis:"secondary",children:t("common.getHelp.button")})})})}),(0,e.jsx)("div",{className:f,children:(0,e.jsx)(O,{size:"$icon.40",color:"$accent1"})}),a===s.Denied?(0,e.jsx)("div",{className:h,children:(0,e.jsx)(_,{variant:"body3",textAlign:"center",children:t("extensionPasskeyLogInPopUp.invalidReferrer")})}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:f,children:(0,e.jsx)(_,{variant:"subheading1",children:t("nav.logIn.button")})}),(0,e.jsx)("div",{className:h,children:(0,e.jsx)(_,{variant:"body3",textAlign:"center",children:t("extensionPasskeyLogInPopUp.description")})}),(0,e.jsx)("div",{className:J,children:(0,e.jsx)(g,{icon:a===s.Verifying?(0,e.jsx)(E,{}):(0,e.jsx)(z,{}),size:"large",variant:"branded",onPress:I,isDisabled:a!==s.Allowed,children:a===s.Allowed?t("nav.logIn.button"):void 0})})]})]})})})}export{Qe as default};
