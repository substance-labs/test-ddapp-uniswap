import{__toESM as J}from"./chunk-DgAfPHQg.js";import{require_react as Et}from"./react-CNoFhWkx.js";import{useTranslation as Z}from"./useTranslation-BotBuoJf.js";import{isInterface as le,isMobileApp as Mt,isWeb as Ut}from"./index.web-BqgtOHN3.js";import{ReactQueryCacheKey as R}from"./cache-BFZkIToX.js";import{useEnabledChains as Ze,useProvider as qt,useUniswapContextSelector as Dt}from"./useEnabledChains-DuB86c95.js";import{getLogger as Me,logger as D,useEvent as _e}from"./hooks-BXO4d1DJ.js";import{BIPS_BASE as Qt,Connection as Nt,CurrencyAmount as H,NativeCurrency as Gt,Percent as Rt,Platform as Ue,PollingInterval as $e,Price as se,ProtectionResult as B,PublicKey as Ce,SOLANA_CHAIN_INFO as Lt,TradeType as O,UniverseChainId as $,getChainInfo as Bt,getChainLabel as Ht,getPollingIntervalByBlocktime as xt,getPrimaryStablecoin as Vt,init_index_browser_esm as be,init_jsbi as et,init_sdk_core_esm as ee,isL2ChainId as Kt,isUniverseChainId as Wt,jsbi_default as q}from"./utils-BX1Fu73x.js";import{areCurrencyIdsEqual as Xt,chainIdToPlatform as jt,currencyAddress as zt,currencyId as he,getCurrencyAddressForAnalytics as ue}from"./currencyId-Ci6selsx.js";import{config as Yt}from"./config-C4KrHqHG.js";import{ONE_DAY_MS as Jt,ONE_SECOND_MS as we,inXMinutesUnix as Zt}from"./time-D_OqcZ4M.js";import{SwapEventName as ye}from"./features-yACC1hVw.js";import{Pool as tt,init_v4_sdk_esm as $t,require_dist$1 as nt}from"./V3DutchOrderTrade-Cl7yELmp.js";import{Pool as ge,init_v3_sdk_esm as en}from"./v3-sdk.esm-CHH6GWR1.js";import{Query as tn,Subscribable as ot,focusManager as nn,functionalUpdate as on,hashKey as Y,hashQueryKeyByOptions as it,keepPreviousData as rn,matchMutation as qe,matchQuery as De,noop as w,notifyManager as I,onlineManager as Qe,partialMatchKey as Ne,resolveStaleTime as Ge,skipToken as de,useQuery as te,useQueryClient as an}from"./useQuery-D_ZCw8XG.js";import{Pair as Fe,init_v2_sdk_esm as sn}from"./v2-sdk.esm-CIiDMO7F.js";import{ValueType as E,getCurrencyAmount as M}from"./getCurrencyAmount-vvZpAzIm.js";import{DynamicConfigs as rt,SyncTransactionSubmissionChainIdsConfigKey as un}from"./configs-B4dDdw82.js";import{getDynamicConfigValue as cn,useStatsigClientStatus as at}from"./hooks-Bp0VtWbX.js";import{getStatsigClient as st}from"./statsig-B7I9iQRf.js";import{usePollingIntervalByChain as ut}from"./usePollingIntervalByChain-YBOfXXzb.js";import{erc20_default as ct}from"./erc20-CdGGKIp0.js";import{nativeOnChain as fe}from"./objects-DlLkJwrJ.js";import{sendAnalyticsEvent as lt}from"./send.web-CrSXW2rw.js";import{DEFAULT_PROTOCOL_OPTIONS as ln,IndicativeTrade as dn,SWAP_GAS_URGENCY_OVERRIDE as fn,SwapEventType as ie,createGetProtocolsForChain as mn,createGetQuoteRoutingParams as pn,createGetQuoteSlippageParams as vn,fetchIndicativeQuote as hn,fetchQuote as yn,getClassicQuoteFromResponse as Se,getMinAutoSlippageToleranceL2 as gn,getTokenAddressForApi as Re,timestampTracker as me,toTradingApiSupportedChainId as Le,transformTradingApiResponseToTrade as Fn,validateIndicativeQuoteResponse as Sn,validateTrade as Tn}from"./TradingApiClient-Cp_0ez5S.js";import{Routing as k,isClassic as G,isJupiter as An,isUniswapX as In}from"./selectors-BwkayGDl.js";import{usePortfolioTotalValue as Pn}from"./balances-DV0Wvmri.js";import{AttackType as re,TokenList as Be}from"./getCurrencySafetyInfo-BHD1ohD-.js";import{Mutation as _n}from"./mutation-CRQvRc5_.js";import{infiniteQueryBehavior as He}from"./infiniteQueryBehavior-C10I_UVS.js";import{queryOptions as ne}from"./queryOptions-P48mrm5X.js";import{uniswapUrls as V}from"./urls-kwiZbYPW.js";import{FetchError as dt,createApiClient as ft}from"./createApiClient-BjXZMbEB.js";import{TransactionOriginType as mt}from"./transactionDetails-BsNW_jus.js";import{NumberType as x}from"./types-JuyYLR0O.js";import{useLocalizationContext as oe}from"./LocalizationContext-B31peW1_.js";import{WarningAction as Cn,WarningLabel as bn,WarningSeverity as P,getAlertColor as wn}from"./getAlertColor-J5DrJWHv.js";import{CurrencyField as T}from"./currency-xm5i4cH7.js";import{require_ethers as pt}from"./ethers-D2SIY1xg.js";import{useWallet as vt}from"./useWallet-CL5owP9P.js";import{useTrace as kn}from"./TraceContext-Ddfk7zjz.js";import{ensure0xHex as ht}from"./hex-njd-4N-2.js";import{z as f}from"./timing-DsWr56iv.js";import{createEthersProvider as ke}from"./createEthersProvider-B5AW2bpJ.js";var c=(function(e){function t(r,s,u){if(typeof r=="function"?r===s:r.has(s))return arguments.length<3?s:u;throw TypeError("Private element is not present on this object")}function n(r,s,u){return r.set(t(r,s),u),u}function o(r,s){if(s.has(r))throw TypeError("Cannot initialize the same private elements twice on an object")}function i(r,s,u){o(r,s),s.set(r,u)}function a(r,s){return r.get(t(r,s))}return e.classPrivateFieldGet2=a,e.classPrivateFieldInitSpec=i,e.classPrivateFieldSet2=n,e})({}),C,U,_,K,y,Q,N,W,X,b,j,z;let Te=(function(e){return e.EXACT_INPUT="EXACT_INPUT",e.EXACT_OUTPUT="EXACT_OUTPUT",e})({});var On=(C=new WeakMap,class extends ot{constructor(e={}){super(),c.classPrivateFieldInitSpec(this,C,void 0),this.config=e,c.classPrivateFieldSet2(C,this,new Map)}build(e,t,n){const o=t.queryKey,i=t.queryHash??it(o,t);let a=this.get(i);return a||(a=new tn({client:e,queryKey:o,queryHash:i,options:e.defaultQueryOptions(t),state:n,defaultOptions:e.getQueryDefaults(o)}),this.add(a)),a}add(e){c.classPrivateFieldGet2(C,this).has(e.queryHash)||(c.classPrivateFieldGet2(C,this).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const t=c.classPrivateFieldGet2(C,this).get(e.queryHash);t&&(e.destroy(),t===e&&c.classPrivateFieldGet2(C,this).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){I.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return c.classPrivateFieldGet2(C,this).get(e)}getAll(){return[...c.classPrivateFieldGet2(C,this).values()]}find(e){const t={exact:!0,...e};return this.getAll().find(n=>De(t,n))}findAll(e={}){const t=this.getAll();return Object.keys(e).length>0?t.filter(n=>De(e,n)):t}notify(e){I.batch(()=>{this.listeners.forEach(t=>{t(e)})})}onFocus(){I.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){I.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}}),En=(U=new WeakMap,_=new WeakMap,K=new WeakMap,class extends ot{constructor(e={}){super(),c.classPrivateFieldInitSpec(this,U,void 0),c.classPrivateFieldInitSpec(this,_,void 0),c.classPrivateFieldInitSpec(this,K,void 0),this.config=e,c.classPrivateFieldSet2(U,this,new Set),c.classPrivateFieldSet2(_,this,new Map),c.classPrivateFieldSet2(K,this,0)}build(e,t,n){var o;const i=new _n({mutationCache:this,mutationId:c.classPrivateFieldSet2(K,this,(o=c.classPrivateFieldGet2(K,this),++o)),options:e.defaultMutationOptions(t),state:n});return this.add(i),i}add(e){c.classPrivateFieldGet2(U,this).add(e);const t=ae(e);if(typeof t=="string"){const n=c.classPrivateFieldGet2(_,this).get(t);n?n.push(e):c.classPrivateFieldGet2(_,this).set(t,[e])}this.notify({type:"added",mutation:e})}remove(e){if(c.classPrivateFieldGet2(U,this).delete(e)){const t=ae(e);if(typeof t=="string"){const n=c.classPrivateFieldGet2(_,this).get(t);if(n)if(n.length>1){const o=n.indexOf(e);o!==-1&&n.splice(o,1)}else n[0]===e&&c.classPrivateFieldGet2(_,this).delete(t)}}this.notify({type:"removed",mutation:e})}canRun(e){const t=ae(e);if(typeof t=="string"){const n=c.classPrivateFieldGet2(_,this).get(t),o=n==null?void 0:n.find(i=>i.state.status==="pending");return!o||o===e}else return!0}runNext(e){const t=ae(e);if(typeof t=="string"){var n;const o=(n=c.classPrivateFieldGet2(_,this).get(t))===null||n===void 0?void 0:n.find(i=>i!==e&&i.state.isPaused);return(o==null?void 0:o.continue())??Promise.resolve()}else return Promise.resolve()}clear(){I.batch(()=>{c.classPrivateFieldGet2(U,this).forEach(e=>{this.notify({type:"removed",mutation:e})}),c.classPrivateFieldGet2(U,this).clear(),c.classPrivateFieldGet2(_,this).clear()})}getAll(){return Array.from(c.classPrivateFieldGet2(U,this))}find(e){const t={exact:!0,...e};return this.getAll().find(n=>qe(t,n))}findAll(e={}){return this.getAll().filter(t=>qe(e,t))}notify(e){I.batch(()=>{this.listeners.forEach(t=>{t(e)})})}resumePausedMutations(){const e=this.getAll().filter(t=>t.state.isPaused);return I.batch(()=>Promise.all(e.map(t=>t.continue().catch(w))))}});function ae(e){var t;return(t=e.options.scope)===null||t===void 0?void 0:t.id}var Mn=(y=new WeakMap,Q=new WeakMap,N=new WeakMap,W=new WeakMap,X=new WeakMap,b=new WeakMap,j=new WeakMap,z=new WeakMap,class{constructor(e={}){c.classPrivateFieldInitSpec(this,y,void 0),c.classPrivateFieldInitSpec(this,Q,void 0),c.classPrivateFieldInitSpec(this,N,void 0),c.classPrivateFieldInitSpec(this,W,void 0),c.classPrivateFieldInitSpec(this,X,void 0),c.classPrivateFieldInitSpec(this,b,void 0),c.classPrivateFieldInitSpec(this,j,void 0),c.classPrivateFieldInitSpec(this,z,void 0),c.classPrivateFieldSet2(y,this,e.queryCache||new On),c.classPrivateFieldSet2(Q,this,e.mutationCache||new En),c.classPrivateFieldSet2(N,this,e.defaultOptions||{}),c.classPrivateFieldSet2(W,this,new Map),c.classPrivateFieldSet2(X,this,new Map),c.classPrivateFieldSet2(b,this,0)}mount(){var e,t;c.classPrivateFieldSet2(b,this,(e=c.classPrivateFieldGet2(b,this),t=e++,e)),c.classPrivateFieldGet2(b,this)===1&&(c.classPrivateFieldSet2(j,this,nn.subscribe(async n=>{n&&(await this.resumePausedMutations(),c.classPrivateFieldGet2(y,this).onFocus())})),c.classPrivateFieldSet2(z,this,Qe.subscribe(async n=>{n&&(await this.resumePausedMutations(),c.classPrivateFieldGet2(y,this).onOnline())})))}unmount(){var e,t,n,o;c.classPrivateFieldSet2(b,this,(e=c.classPrivateFieldGet2(b,this),t=e--,e)),c.classPrivateFieldGet2(b,this)===0&&((n=c.classPrivateFieldGet2(j,this))===null||n===void 0||n.call(this),c.classPrivateFieldSet2(j,this,void 0),(o=c.classPrivateFieldGet2(z,this))===null||o===void 0||o.call(this),c.classPrivateFieldSet2(z,this,void 0))}isFetching(e){return c.classPrivateFieldGet2(y,this).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return c.classPrivateFieldGet2(Q,this).findAll({...e,status:"pending"}).length}getQueryData(e){var t;const n=this.defaultQueryOptions({queryKey:e});return(t=c.classPrivateFieldGet2(y,this).get(n.queryHash))===null||t===void 0?void 0:t.state.data}ensureQueryData(e){const t=this.defaultQueryOptions(e),n=c.classPrivateFieldGet2(y,this).build(this,t),o=n.state.data;return o===void 0?this.fetchQuery(e):(e.revalidateIfStale&&n.isStaleByTime(Ge(t.staleTime,n))&&this.prefetchQuery(t),Promise.resolve(o))}getQueriesData(e){return c.classPrivateFieldGet2(y,this).findAll(e).map(({queryKey:t,state:n})=>{const o=n.data;return[t,o]})}setQueryData(e,t,n){const o=this.defaultQueryOptions({queryKey:e}),i=c.classPrivateFieldGet2(y,this).get(o.queryHash),a=i==null?void 0:i.state.data,r=on(t,a);if(r!==void 0)return c.classPrivateFieldGet2(y,this).build(this,o).setData(r,{...n,manual:!0})}setQueriesData(e,t,n){return I.batch(()=>c.classPrivateFieldGet2(y,this).findAll(e).map(({queryKey:o})=>[o,this.setQueryData(o,t,n)]))}getQueryState(e){var t;const n=this.defaultQueryOptions({queryKey:e});return(t=c.classPrivateFieldGet2(y,this).get(n.queryHash))===null||t===void 0?void 0:t.state}removeQueries(e){const t=c.classPrivateFieldGet2(y,this);I.batch(()=>{t.findAll(e).forEach(n=>{t.remove(n)})})}resetQueries(e,t){const n=c.classPrivateFieldGet2(y,this);return I.batch(()=>(n.findAll(e).forEach(o=>{o.reset()}),this.refetchQueries({type:"active",...e},t)))}cancelQueries(e,t={}){const n={revert:!0,...t},o=I.batch(()=>c.classPrivateFieldGet2(y,this).findAll(e).map(i=>i.cancel(n)));return Promise.all(o).then(w).catch(w)}invalidateQueries(e,t={}){return I.batch(()=>(c.classPrivateFieldGet2(y,this).findAll(e).forEach(n=>{n.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},t)))}refetchQueries(e,t={}){const n={...t,cancelRefetch:t.cancelRefetch??!0},o=I.batch(()=>c.classPrivateFieldGet2(y,this).findAll(e).filter(i=>!i.isDisabled()).map(i=>{let a=i.fetch(void 0,n);return n.throwOnError||(a=a.catch(w)),i.state.fetchStatus==="paused"?Promise.resolve():a}));return Promise.all(o).then(w)}fetchQuery(e){const t=this.defaultQueryOptions(e);t.retry===void 0&&(t.retry=!1);const n=c.classPrivateFieldGet2(y,this).build(this,t);return n.isStaleByTime(Ge(t.staleTime,n))?n.fetch(t):Promise.resolve(n.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(w).catch(w)}fetchInfiniteQuery(e){return e.behavior=He(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(w).catch(w)}ensureInfiniteQueryData(e){return e.behavior=He(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return Qe.isOnline()?c.classPrivateFieldGet2(Q,this).resumePausedMutations():Promise.resolve()}getQueryCache(){return c.classPrivateFieldGet2(y,this)}getMutationCache(){return c.classPrivateFieldGet2(Q,this)}getDefaultOptions(){return c.classPrivateFieldGet2(N,this)}setDefaultOptions(e){c.classPrivateFieldSet2(N,this,e)}setQueryDefaults(e,t){c.classPrivateFieldGet2(W,this).set(Y(e),{queryKey:e,defaultOptions:t})}getQueryDefaults(e){const t=[...c.classPrivateFieldGet2(W,this).values()],n={};return t.forEach(o=>{Ne(e,o.queryKey)&&Object.assign(n,o.defaultOptions)}),n}setMutationDefaults(e,t){c.classPrivateFieldGet2(X,this).set(Y(e),{mutationKey:e,defaultOptions:t})}getMutationDefaults(e){const t=[...c.classPrivateFieldGet2(X,this).values()],n={};return t.forEach(o=>{Ne(e,o.mutationKey)&&Object.assign(n,o.defaultOptions)}),n}defaultQueryOptions(e){if(e._defaulted)return e;const t={...c.classPrivateFieldGet2(N,this).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return t.queryHash||(t.queryHash=it(t.queryKey,t)),t.refetchOnReconnect===void 0&&(t.refetchOnReconnect=t.networkMode!=="always"),t.throwOnError===void 0&&(t.throwOnError=!!t.suspense),!t.networkMode&&t.persister&&(t.networkMode="offlineFirst"),t.queryFn===de&&(t.enabled=!1),t}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...c.classPrivateFieldGet2(N,this).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){c.classPrivateFieldGet2(y,this).clear(),c.classPrivateFieldGet2(Q,this).clear()}});ee();let l=(function(e){return e[e.Blocked=10]="Blocked",e[e.MaliciousHoneypot=9]="MaliciousHoneypot",e[e.FotVeryHigh=8]="FotVeryHigh",e[e.MaliciousImpersonator=7]="MaliciousImpersonator",e[e.FotHigh=6]="FotHigh",e[e.MaliciousGeneral=5]="MaliciousGeneral",e[e.PotentialHoneypot=4.5]="PotentialHoneypot",e[e.SpamAirdrop=4]="SpamAirdrop",e[e.FotLow=3]="FotLow",e[e.NonDefault=2]="NonDefault",e[e.None=1]="None",e})({});const yt=100,gt=80,Ae=15;function Un(e){if(!e)return{buyFeePercent:void 0,sellFeePercent:void 0};if(e.isNative)return{buyFeePercent:0,sellFeePercent:0};const t=e.sellFeeBps?e.sellFeeBps.toNumber()/100:void 0;return{buyFeePercent:e.buyFeeBps?e.buyFeeBps.toNumber()/100:void 0,sellFeePercent:t}}function Ft(e){var t;const{buyFeePercent:n,sellFeePercent:o}=Un(e==null?void 0:e.currency),i=e==null||(t=e.safetyInfo)===null||t===void 0?void 0:t.blockaidFees,a=n??(i==null?void 0:i.buyFeePercent),r=o??(i==null?void 0:i.sellFeePercent);return{buyFeePercent:a,sellFeePercent:r,maxFeePercent:r||a?Math.max(r??0,a??0):void 0}}function ce(e){if(!(e!=null&&e.currency)||!e.safetyInfo)return l.NonDefault;const{currency:t,safetyInfo:n}=e,{protectionResult:o,attackType:i}=n;if(t instanceof Gt)return l.None;const{maxFeePercent:a}=Ft(e);return n.tokenList===Be.Blocked?l.Blocked:a===yt?l.MaliciousHoneypot:a&&a>=gt||(o===B.Malicious||o===B.Spam)&&i===re.HighFees?l.FotVeryHigh:(o===B.Malicious||o===B.Spam)&&i===re.Impersonator?l.MaliciousImpersonator:a&&a>=Ae?l.FotHigh:o===B.Malicious?l.MaliciousGeneral:i===re.Honeypot?l.PotentialHoneypot:o===B.Spam&&i===re.Airdrop?l.SpamAirdrop:a&&a>0&&a<Ae?l.FotLow:n.tokenList===Be.NonDefault?l.NonDefault:l.None}function Bi(e){return e===l.MaliciousHoneypot||e===l.FotVeryHigh||e===l.FotHigh||e===l.FotLow}function qn(e){let t=l.None;return e>=yt?t=l.MaliciousHoneypot:e>=gt?t=l.FotVeryHigh:e>=Ae?t=l.FotHigh:e>0&&(t=l.FotLow),t}function xe(e){if(!e)return P.None;const t=ce(e);return St(t)}function St(e){switch(e){case l.Blocked:return P.Blocked;case l.MaliciousHoneypot:case l.MaliciousImpersonator:case l.MaliciousGeneral:case l.FotVeryHigh:case l.FotHigh:return P.High;case l.PotentialHoneypot:case l.SpamAirdrop:case l.FotLow:return P.Medium;case l.NonDefault:return P.Low;case l.None:return P.None}}function Hi(e,t){const n=xe(e),o=xe(t),i=t&&n===P.Low&&o===P.Low,a=t&&n===P.Blocked&&o===P.Blocked;return(i||a)??!1}function xi({tokenProtectionWarning:e,tokenSymbol0:t,tokenSymbol1:n,shouldHavePluralTreatment:o}){const{t:i}=Z();if(!e)return null;switch(!o&&n&&D.error("Should only combine into one plural-languaged modal if BOTH are low or BOTH are blocked",{tags:{file:"safetyUtils.ts",function:"useModalHeaderText"}}),e){case l.Blocked:return o&&n?i("token.safety.blocked.title.tokensNotAvailable",{tokenSymbol0:t??i("common.thisToken"),tokenSymbol1:n}):i("token.safety.blocked.title.tokenNotAvailable",{tokenSymbol:t??i("common.thisToken")});case l.MaliciousHoneypot:return i("token.safety.warning.sellFee100.title");case l.FotVeryHigh:return i("token.safety.warning.fotVeryHigh.title");case l.MaliciousImpersonator:return i("token.safety.warning.impersonator.title");case l.FotHigh:return i("token.safety.warning.fotHigh.title");case l.MaliciousGeneral:return i("token.safety.warning.malicious.title");case l.PotentialHoneypot:return i("token.safety.warning.potentialHoneypot.title");case l.SpamAirdrop:return i("token.safety.warning.spam.title");case l.FotLow:return i("token.safety.warning.fotLow.title");case l.NonDefault:return i("token.safety.warning.alwaysDoYourResearch");case l.None:return null}}function Vi({tokenProtectionWarning:e,tokenSymbol:t,buyFeePercent:n,sellFeePercent:o,shouldHavePluralTreatment:i}){const{formatPercent:a}=oe(),{t:r}=Z();if(!e)return null;const s=t??r("common.thisToken"),u=n&&n>0?a(n):void 0,d=o&&o>0?a(o):void 0;switch(e){case l.Blocked:return r(le?i?"token.safety.warning.blocked.description.default_other":"token.safety.warning.blocked.description.default_one":"token.safetyLevel.blocked.message");case l.MaliciousHoneypot:return r("token.safety.warning.honeypot.message",{tokenSymbol:s});case l.MaliciousGeneral:return r("token.safety.warning.malicious.general.message",{tokenSymbol:s})+" "+r("token.safety.warning.doYourOwnResearch");case l.MaliciousImpersonator:return r("token.safety.warning.malicious.impersonator.message",{tokenSymbol:s});case l.PotentialHoneypot:return r("token.safety.warning.potentialHoneypot.modal.message",{tokenSymbol:s});case l.SpamAirdrop:return r("token.safety.warning.spam.message",{tokenSymbol:s})+" "+r("token.safety.warning.doYourOwnResearch");case l.FotVeryHigh:case l.FotHigh:case l.FotLow:return(u&&d?r("token.safety.warning.tokenChargesFee.both.message",{tokenSymbol:s,buyFeePercent:u,sellFeePercent:d}):u?r("token.safety.warning.tokenChargesFee.buy.message",{tokenSymbol:s,feePercent:u}):d?r("token.safety.warning.tokenChargesFee.sell.message",{tokenSymbol:s,feePercent:d}):r("token.safety.warning.tokenChargesFee.unknownFee.message",{tokenSymbol:s}))+" "+r("token.safety.warning.mayResultInLoss")+" "+r("token.safety.fees.uniswapLabsDoesNotReceive");case l.NonDefault:return i?r("token.safetyLevel.medium.message.plural"):r("token.safety.warning.medium.heading.named",{tokenSymbol:s});case l.None:return null}}function Ki(e){const t=ce(e),{buyFeePercent:n,sellFeePercent:o}=Ft(e),i=Dn({tokenProtectionWarning:t}),a=Qn({tokenProtectionWarning:t,tokenSymbol:e==null?void 0:e.currency.symbol,buyFeePercent:n,sellFeePercent:o});return!e||!e.safetyInfo?{heading:null,description:null}:{heading:i,description:a}}function Dn({tokenProtectionWarning:e}){const{t}=Z();switch(e){case l.MaliciousHoneypot:return t("token.safety.warning.honeypot.title");case l.FotVeryHigh:return t("token.safety.warning.fotVeryHigh.title");case l.MaliciousImpersonator:return t("token.safety.warning.impersonator.title");case l.FotHigh:return t("token.safety.warning.fotHigh.title");case l.MaliciousGeneral:return t("token.safety.warning.malicious.title");case l.PotentialHoneypot:return t("token.safety.warning.potentialHoneypot.title");case l.SpamAirdrop:return t("token.safety.warning.spam.title");case l.FotLow:return t("token.safety.warning.fotLow.title");case l.NonDefault:case l.None:default:return null}}function Qn({tokenProtectionWarning:e,tokenSymbol:t,buyFeePercent:n,sellFeePercent:o}){const{t:i}=Z(),{formatPercent:a}=oe(),r=t??i("common.thisToken"),s=n&&n>0?a(n):void 0,u=o&&o>0?a(o):void 0;switch(e){case l.Blocked:return i(le?"token.safety.warning.blocked.description.default_one":"token.safetyLevel.blocked.message");case l.MaliciousHoneypot:return i("token.safety.warning.sellFee100.message",{tokenSymbol:r});case l.MaliciousGeneral:return i("token.safety.warning.malicious.general.message",{tokenSymbol:r});case l.MaliciousImpersonator:return i("token.safety.warning.malicious.impersonator.message.short",{tokenSymbol:r});case l.PotentialHoneypot:return i("token.safety.warning.potentialHoneypot.card.message",{tokenSymbol:r});case l.SpamAirdrop:return i("token.safety.warning.spam.message",{tokenSymbol:r});case l.FotVeryHigh:case l.FotHigh:case l.FotLow:return s&&u?i("token.safety.warning.tokenChargesFee.both.message",{tokenSymbol:r,buyFeePercent:s,sellFeePercent:u}):s?i("token.safety.warning.tokenChargesFee.buy.message",{tokenSymbol:r,feePercent:s}):u?i("token.safety.warning.tokenChargesFee.sell.message",{tokenSymbol:r,feePercent:u}):i("token.safety.warning.tokenChargesFee.unknownFee.message",{tokenSymbol:r});case l.NonDefault:return i("token.safety.warning.medium.heading.named",{tokenSymbol:r});case l.None:return null}}function Wi(e){const t=qn(e),n=St(t),{headerText:o}=wn(n);return o}function Tt({trade:e,outputAmount:t,outputAmountUsd:n}){if(!e.swapFee)return;const o=(parseFloat(n.toExact())/parseFloat(t.toExact())).toString(),i=M({value:e.swapFee.amount,valueType:E.Raw,currency:e.outputAmount.currency});return i?parseFloat(o)*parseFloat(i.toExact()):void 0}function Xi(e){if(!(!e.trade.trade||!e.currencyAmounts[T.OUTPUT]||!e.currencyAmountsUSDValue[T.OUTPUT]))return Tt({trade:e.trade.trade,outputAmount:e.currencyAmounts[T.OUTPUT],outputAmountUsd:e.currencyAmountsUSDValue[T.OUTPUT]})}var pe=J(nt());sn();en();$t();var g=J(Et());const Ve={v2Used:!1,v3Used:!1,v4Used:!1,uniswapXUsed:!1};function Nn(e){if(e instanceof Fe)return Fe.getAddress(e.token0,e.token1);if(e instanceof ge)return ge.getAddress(e.token0,e.token1,e.fee);if(e instanceof tt)return e.poolId}function Gn(e){if(e instanceof Fe)return"V2";if(e instanceof ge)return"V3";if(e instanceof tt)return"V4"}function Rn(e){return e.map(t=>t.pools)}function Ln({routing:e,routes:t}){if(e){if(G({routing:e})&&t){const o=Rn(t).map(u=>u.map(d=>({poolAddress:Nn(d)??"unknown",version:Gn(d)??"unknown"}))),i=o.some(u=>u.some(d=>d.version===pe.Protocol.V2)),a=o.some(u=>u.some(d=>d.version===pe.Protocol.V3)),r=o.some(u=>u.some(d=>d.version===pe.Protocol.V4));return{poolsCount:o.reduce((u,d)=>u+d.length,0),paths:o,v2Used:i,v3Used:a,v4Used:r,uniswapXUsed:!1}}return In({routing:e})?{...Ve,uniswapXUsed:!0}:Ve}}function ji(e){const t=oe(),n=kn(),{trade:{trade:o}}=e,i=o==null?void 0:o.quote.requestId,a=vt().evmAccount,{data:r}=Pn({address:a==null?void 0:a.address,fetchPolicy:"cache-first"});(0,g.useEffect)(()=>{o&&lt(ye.SwapQuoteReceived,Bn({formatter:t,trade:o,currencyInAmountUSD:e.currencyAmountsUSDValue.input,currencyOutAmountUSD:e.currencyAmountsUSDValue.output,portfolioBalanceUsd:r==null?void 0:r.balanceUSD,trace:n}))},[i])}function Bn({formatter:e,trade:t,currencyInAmountUSD:n,currencyOutAmountUSD:o,portfolioBalanceUsd:i,presetPercentage:a,preselectAsset:r,trace:s,isBatched:u,includedPermitTransactionStep:d,includesDelegation:m,isSmartWalletTransaction:h}){var p;const v=(p=Se(t.quote))===null||p===void 0?void 0:p.portionAmount,A=M({value:v,valueType:E.Raw,currency:t.outputAmount.currency}),F=Se(t.quote),S=A?t.outputAmount.subtract(A):t.outputAmount;return{...s,routing:Hn(t),total_balances_usd:i,token_in_symbol:t.inputAmount.currency.symbol,token_out_symbol:t.outputAmount.currency.symbol,token_in_address:ue(t.inputAmount.currency),token_out_address:ue(t.outputAmount.currency),price_impact_basis_points:G(t)?t.priceImpact.multiply(100).toSignificant():void 0,chain_id:t.inputAmount.currency.chainId===t.outputAmount.currency.chainId?t.inputAmount.currency.chainId:void 0,chain_id_in:t.inputAmount.currency.chainId,chain_id_out:t.outputAmount.currency.chainId,token_in_amount:t.inputAmount.toExact(),token_out_amount:e.formatCurrencyAmount({value:S,type:x.SwapTradeAmount}),token_in_amount_usd:n?parseFloat(n.toFixed(2)):void 0,token_out_amount_usd:o?parseFloat(o.toFixed(2)):void 0,preset_percentage:a,preselect_asset:r,allowed_slippage:t.slippageTolerance!==void 0?parseFloat(t.slippageTolerance.toFixed(2)):void 0,allowed_slippage_basis_points:t.slippageTolerance?t.slippageTolerance*100:void 0,fee_amount:v,requestId:t.quote.requestId,ura_request_id:t.quote.requestId,ura_block_number:G(t)?t.quote.quote.blockNumber:void 0,quoteId:F==null?void 0:F.quoteId,transactionOriginType:mt.Internal,swap_quote_block_number:F==null?void 0:F.blockNumber,estimated_network_fee_usd:G(t)?t.quote.quote.gasFeeUSD:void 0,fee_usd:o?Tt({trade:t,outputAmount:t.outputAmount,outputAmountUsd:o}):void 0,type:t.tradeType,minimum_output_after_slippage:t.minAmountOut.toSignificant(6),token_in_amount_max:t.maxAmountIn.toExact(),token_out_amount_min:t.minAmountOut.toExact(),token_in_detected_tax:parseFloat(t.inputTax.toFixed(2)),token_out_detected_tax:parseFloat(t.outputTax.toFixed(2)),simulation_failure_reasons:G(t)?t.quote.quote.txFailureReasons:void 0,...Ln(t),is_batch:u,included_permit_transaction_step:d,includes_delegation:m,is_smart_wallet_transaction:h}}function zi({transactionSettings:e,derivedSwapInfo:t,trace:n}){var o,i;const{chainId:a,currencyAmounts:r,currencyAmountsUSDValue:s}=t,u=r[T.INPUT],d=r[T.OUTPUT],m=s[T.INPUT]?parseFloat(s[T.INPUT].toFixed(2)):void 0,h=s[T.OUTPUT]?parseFloat(s[T.OUTPUT].toFixed(2)):void 0,p=e.customSlippageTolerance??e.autoSlippageTolerance,v=(o=Se((i=t.trade.trade)===null||i===void 0?void 0:i.quote))===null||o===void 0?void 0:o.portionAmount,A=M({value:v,valueType:E.Raw,currency:d==null?void 0:d.currency}),F=d&&A?d.subtract(A):d,S=t.trade.trade;return{...n,token_in_symbol:u==null?void 0:u.currency.symbol,token_out_symbol:d==null?void 0:d.currency.symbol,token_in_address:u?ue(u.currency):"",token_out_address:d?ue(d.currency):"",price_impact_basis_points:S&&G(S)?S.priceImpact.multiply(100).toSignificant():void 0,estimated_network_fee_usd:void 0,chain_id:a,token_in_amount:(u==null?void 0:u.toExact())??"",token_out_amount:(F==null?void 0:F.toExact())??"",token_in_amount_usd:m,token_out_amount_usd:h,allowed_slippage_basis_points:p?p*100:void 0,fee_amount:v,transactionOriginType:mt.Internal,tokenWarnings:{input:ce(t.currencies.input),output:ce(t.currencies.output)}}}function Ke({chainId:e,isUSDQuote:t=!1,isQuickRoute:n=!1}){let o={};if(!t){const i=me.hasTimestamp(ie.FirstQuoteFetchStarted),a=me.setElapsedTime(ie.FirstQuoteFetchStarted),r=i?void 0:a,s=i?void 0:me.getElapsedTime(ie.FirstQuoteFetchStarted,ie.FirstSwapAction);o={time_to_first_quote_request:r,time_to_first_quote_request_since_first_input:s}}lt(ye.SwapQuoteFetch,{chainId:e,isQuickRoute:n,...o}),D.info("analytics","logSwapQuoteFetch",ye.SwapQuoteFetch,{chainId:e,chainLabel:Ht(e),isQuickRoute:n,...o})}function Hn({routing:e,indicative:t}){if(t)return"none";switch(e){case k.DUTCH_V3:return"uniswap_x_v3";case k.DUTCH_V2:return"uniswap_x_v2";case k.DUTCH_LIMIT:return"uniswap_x";case k.PRIORITY:return"priority_order";case k.LIMIT_ORDER:return"limit_order";case k.CLASSIC:return"classic";case k.BRIDGE:return"bridge";default:return"none"}}const xn=ft({baseUrl:V.jupiterApiUrl});function Yi(e){if(!(e.value===void 0||e.error))return{...e,value:e.value,error:null}}function Vn(e){const t=Ie(e);return Y(t)}function Ie(e){if(e==null)return e;if(Array.isArray(e))return[...e.map(n=>Ie(n))].sort((n,o)=>{const i=Y([n]),a=Y([o]);return i<a?-1:i>a?1:0});if(typeof e=="object"&&e.constructor===Object){const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=Ie(e[n]));return t}return e}const Kn=new Mn({defaultOptions:{queries:{staleTime:15*we,gcTime:Jt,retry:(e,t)=>e<2&&t instanceof dt&&t.response.status===500,queryKeyHashFn:Vn}}});be();const Wn=new Nt(Lt.rpcUrls.default.http[0]);function At(){return Wn}be();const We=100,Xn=new Ce("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA");function jn(e){try{var t,n;const o=(t=e.parsed.info.mint)===null||t===void 0?void 0:t.toString(),i=(n=e.parsed.info.tokenAmount)===null||n===void 0||(n=n.amount)===null||n===void 0?void 0:n.toString();return{mint:o,tokenAmount:i}}catch(o){return D.error(o,{tags:{file:"solanaConnectionQueryOptions.ts",function:"parseTokenAccount"},extra:{account:e}}),{mint:void 0,tokenAmount:void 0}}}function zn({params:e}){return ne({queryKey:[R.SolanaConnection,"getParsedTokenAccountsByOwner",e],queryFn:async()=>{const n=await At().getParsedTokenAccountsByOwner(new Ce(e.accountAddress),{programId:Xn}),o={};return n.value.forEach(i=>{const a=jn(i.account.data);a.mint&&(o[a.mint]=a)}),o},staleTime:We,gcTime:We})}be();var It=J(pt());async function Yn(e){switch(jt(e.chainId)){case Ue.EVM:return Jn(e);case Ue.SVM:return $n(e);default:return D.error(new Error(`Unexpected chainId for balance lookup: ${e.chainId}`),{tags:{file:"api.ts",function:"getOnChainBalancesFetch"},extra:{params:e}}),{balance:void 0}}}async function Jn(e){var t,n;const{currencyAddress:o,chainId:i,currencyIsNative:a,accountAddress:r}=e,s=[];if(cn({config:rt.SyncTransactionSubmissionChainIds,key:un.ChainIds,defaultValue:s}).includes(i))return Zn(e);const m=ke({chainId:i});return m?a?{balance:(await m.getBalance(r)).toString()}:{balance:(await((t=(n=new It.Contract(o,ct,m).callStatic).balanceOf)===null||t===void 0?void 0:t.call(n,r))).toString()}:{balance:void 0}}async function Zn(e){const{currencyAddress:t,chainId:n,currencyIsNative:o,accountAddress:i}=e;if(!t||!i)return{balance:void 0};const a=ke({chainId:n});if(!a)return{balance:void 0};if(o)return{balance:(await a.getBalance(i,"pending")).toString()};const r=new It.Contract(t,ct,a),s=await a.send("eth_call",[{to:t,data:r.interface.encodeFunctionData("balanceOf",[i])},"pending"]);return{balance:r.interface.decodeFunctionResult("balanceOf",s)[0].toString()}}async function $n(e){const{currencyAddress:t,chainId:n,accountAddress:o}=e;try{var i;return t===Bt(n).nativeCurrency.address?{balance:(await At().getBalance(new Ce(o))).toString()}:{balance:(i=(await Kn.ensureQueryData(zn({params:{accountAddress:o}})))[t])===null||i===void 0?void 0:i.tokenAmount}}catch(a){return D.error(a,{tags:{file:"api.ts",function:"getOnChainBalancesFetchSVM"},extra:{params:e}}),{balance:void 0}}}function eo(e,t){const n=xt(e==null?void 0:e.chainId),{data:o,error:i}=te({queryKey:[R.OnchainBalances,t,he(e)],queryFn:e&&t?async()=>await Yn({currencyAddress:zt(e),chainId:e.chainId,currencyIsNative:e.isNative,accountAddress:t}):de,staleTime:n,refetchInterval:n,gcTime:n*2});return(0,g.useMemo)(()=>({balance:M({value:o==null?void 0:o.balance,valueType:E.Raw,currency:e})??void 0,isLoading:!(o!=null&&o.balance),error:i}),[o==null?void 0:o.balance,e,i])}function to(e,t){const n=fe(e),{balance:o,isLoading:i}=eo(n,t);return{balance:o,isLoading:i}}const no=f.object({ammKey:f.string(),label:f.string(),inputMint:f.string(),outputMint:f.string(),inAmount:f.string(),outAmount:f.string(),feeAmount:f.string(),feeMint:f.string()}).passthrough(),oo=f.array(f.object({swapInfo:no,percent:f.number()}).passthrough()),io=f.object({amount:f.string(),feeBps:f.number()}).passthrough(),ro=f.union([f.literal("aggregator"),f.literal("rfq"),f.literal("hashflow"),f.string()]).transform(e=>e==="aggregator"||e==="rfq"||e==="hashflow"?e:"unknown"),ao=f.object({inputMint:f.string(),outputMint:f.string(),inAmount:f.string(),outAmount:f.string(),otherAmountThreshold:f.string(),swapMode:f.enum(["ExactIn","ExactOut"]),slippageBps:f.number(),priceImpactPct:f.string(),routePlan:oo,feeMint:f.string().nullish(),feeBps:f.number(),prioritizationFeeLamports:f.number(),swapType:ro,transaction:f.string().nullish(),gasless:f.boolean(),requestId:f.string(),taker:f.string().nullish(),quoteId:f.string().nullish(),maker:f.string().nullish(),platformFee:io.nullish()}).passthrough();async function so(e){const t=new URLSearchParams;t.set("inputMint",e.inputMint),t.set("outputMint",e.outputMint),t.set("amount",e.amount.toString()),t.set("swapMode",e.swapMode),e.taker&&t.set("taker",e.taker),e.referralAccount&&t.set("referralAccount",e.referralAccount),e.referralFee&&t.set("referralFee",e.referralFee.toString()),e.slippageBps&&t.set("slippageBps",e.slippageBps.toString());const n=await xn.get(V.jupiterApiPaths.order+"?"+t.toString());return ao.parse(n)}var Xe=J(nt());ee();function uo({quote:e,inputToken:t,outputToken:n}){const o=H.fromRawAmount(t,e.inAmount),i=H.fromRawAmount(n,e.outAmount);if(e.swapMode==="ExactIn"){const a=o,r=H.fromRawAmount(n,e.otherAmountThreshold);return{inputAmount:o,outputAmount:i,minAmountOut:r,maxAmountIn:a}}else{const a=H.fromRawAmount(t,e.otherAmountThreshold);return{inputAmount:o,outputAmount:i,minAmountOut:i,maxAmountIn:a}}}function co({quote:e,inputToken:t,outputToken:n}){var o,i;const{inputAmount:a,outputAmount:r,minAmountOut:s,maxAmountIn:u}=uo({quote:e,inputToken:t,outputToken:n}),d=new se(t,n,a.quotient,r.quotient),m=e.swapMode==="ExactIn";return{inputAmount:a,outputAmount:r,executionPrice:d,quote:{routing:k.JUPITER,quote:e,requestId:e.requestId,permitData:null},tradeType:m?O.EXACT_INPUT:O.EXACT_OUTPUT,routing:k.JUPITER,indicative:!1,swapFee:{recipient:"",percent:new Rt(((o=e.platformFee)===null||o===void 0?void 0:o.feeBps)??0,Qt),amount:((i=e.platformFee)===null||i===void 0?void 0:i.amount)??"0"},inputTax:Xe.ZERO_PERCENT,outputTax:Xe.ZERO_PERCENT,slippageTolerance:e.slippageBps/100,priceImpact:void 0,deadline:void 0,minAmountOut:s,maxAmountIn:u,get quoteOutputAmount(){return r},get quoteOutputAmountUserWillReceive(){return r}}}ee();function lo(){return{async getTrade(e){var t,n,o,i;const a=e.tradeType===O.EXACT_INPUT?(t=e.amountSpecified)===null||t===void 0?void 0:t.currency:e.otherCurrency,r=e.tradeType===O.EXACT_OUTPUT?(n=e.amountSpecified)===null||n===void 0?void 0:n.currency:e.otherCurrency;if(!a||!r)return null;const s=e.customSlippageTolerance?(e.customSlippageTolerance*100).toString():void 0,u=e.tradeType===O.EXACT_INPUT?"ExactIn":"ExactOut",d=await so({inputMint:a.wrapped.address,outputMint:r.wrapped.address,amount:((o=e.amountSpecified)===null||o===void 0?void 0:o.quotient.toString())??"0",taker:(i=e.account)===null||i===void 0?void 0:i.address,slippageBps:s,swapMode:u});return co({quote:d,inputToken:a,outputToken:r})}}}function fo(e){return function(n){var o;return ne({queryKey:[R.SolanaTradeService,n],queryFn:()=>e.solanaTradeService.getTrade(n),refetchInterval:2e3,enabled:!n.skip&&((o=n.amountSpecified)===null||o===void 0?void 0:o.currency.chainId)===$.Solana})}}function mo(e){const t=(0,g.useMemo)(()=>lo(),[]),{svmAccount:n}=vt(),o=_e(fo({solanaTradeService:t})),i=(0,g.useMemo)(()=>({...e,account:n}),[e,n]),{data:a,isLoading:r,isFetching:s,error:u}=te(o(i));return(0,g.useMemo)(()=>({isLoading:e.isDebouncing||r,isFetching:s,trade:a??null,indicativeTrade:void 0,isIndicativeLoading:!1,error:u,gasEstimate:void 0}),[e.isDebouncing,a,u,s,r])}ee();function Oe(e){const{tradeType:t,amountSpecified:n,otherCurrency:o}=e,i=t===O.EXACT_INPUT?n==null?void 0:n.currency:o,a=t===O.EXACT_OUTPUT?n==null?void 0:n.currency:o,r=t===O.EXACT_INPUT?Te.EXACT_INPUT:Te.EXACT_OUTPUT;return{currencyIn:i??void 0,currencyOut:a??void 0,requestTradeType:r}}function po(e){return(e==null?void 0:e.quotient.toString())==="0"}function vo(e){return{fetchQuote:async({isUSDQuote:t,...n})=>{Ke({chainId:n.tokenInChainId,isUSDQuote:t});const o=e.logger&&!t?Date.now():void 0,i=await e.fetchQuote(n);return e.logger&&!i.quote&&e.logger.error(new Error("Unexpected empty Trading API response"),{tags:{file:"tradeRepository",function:"fetchQuote"},extra:{params:n,routing:i.routing,requestId:i.requestId}}),o&&e.logger&&e.logger.info("useTrade","useTrade","Quote Latency",{quoteLatency:Date.now()-o,chainIdIn:n.tokenInChainId,chainIdOut:n.tokenOutChainId,isBridging:je(n.tokenInChainId,n.tokenOutChainId)}),i},fetchIndicativeQuote:async t=>{Ke({chainId:t.tokenInChainId,isQuickRoute:!0});const n=e.logger?Date.now():void 0,o=await e.fetchIndicativeQuote(t);return n&&e.logger&&e.logger.info("tradeRepository","fetchIndicativeQuote","Indicative Quote Latency",{quoteLatency:Date.now()-n,chainIdIn:t.tokenInChainId,chainIdOut:t.tokenOutChainId,isBridging:je(t.tokenInChainId,t.tokenOutChainId)}),o}}}function je(e,t){return!!(e&&t&&e!==t)}function ho(){return vo({fetchQuote:yn,fetchIndicativeQuote:hn,logger:D})}function Pt({immediateGcTime:e,...t},n){const o=an(),i=n??o,{queryKey:a,queryFn:r}=t,s=r===de,u=te({...t,gcTime:e},i),{dataUpdatedAt:d}=u;return(0,g.useEffect)(()=>{if(s||!e)return;const m=Date.now()-d,h=setTimeout(()=>{var p;const v=(p=i.getQueryCache().find({queryKey:a}))===null||p===void 0?void 0:p.state;if(!v){D.debug("TradingApiClient.ts","useQueryWithImmediateGarbageCollection","Cache not found",{queryKey:a});return}const{data:A,dataUpdatedAt:F,fetchStatus:S}=v;if(!A||S==="fetching")return;const L=Date.now()-F;L>=e&&(D.debug("TradingApiClient.ts","useQueryWithImmediateGarbageCollection","Clearing stale data",{queryKey:a,immediateGcTime:e,latestDataUpdatedAt:F,latestTimeSinceLastUpdate:L,state:v}),i.removeQueries({queryKey:a,exact:!0}))},e-m);return()=>clearTimeout(h)},[d,e,i,a,s]),u}const _t=ft({baseUrl:V.apiBaseUrl,additionalHeaders:{"x-api-key":Yt.uniswapApiKey},includeBaseUniswapHeaders:!le});function yo({gasStrategy:e,smartContractDelegationAddress:t}){const n=s=>({...s,gasStrategies:[e]}),o=s=>({...s,...t?{smartContractDelegationAddress:t}:{}}),i=s=>{const u=s.gasEstimates[0];if(!u)throw new Error("Could not get gas estimate");return{value:u.gasFee,displayValue:Oo(u.gasFee,e),params:go(u),gasEstimate:u}},a=async({tx:s,fallbackGasLimit:u})=>{try{if(!s.chainId)throw new Error("No chainId for clientside gas estimation");const d=ke({chainId:s.chainId});if(!d)throw new Error("No provider for clientside gas estimation");const m=(await d.estimateGas(s)).toNumber()*1e10;return{value:m.toString(),displayValue:m.toString()}}catch{return{value:u==null?void 0:u.toString(),displayValue:u==null?void 0:u.toString()}}};return async({tx:s,fallbackGasLimit:u})=>{const d=JSON.stringify(n(o(s)));try{const m=await _t.post(V.gasServicePath,{body:d,headers:t?{"x-viem-provider-enabled":"true"}:{}});return i(m)}catch(m){if(le)return a({tx:s,fallbackGasLimit:u});throw m}}}function go(e){return"maxFeePerGas"in e?{maxFeePerGas:e.maxFeePerGas,maxPriorityFeePerGas:e.maxPriorityFeePerGas,gasLimit:e.gasLimit}:{gasPrice:e.gasPrice,gasLimit:e.gasLimit}}async function Ji(e){return await _t.post(V.trmPath,{body:JSON.stringify(e)})}et();const ze={limitInflationFactor:1.15,displayLimitInflationFactor:1,priceInflationFactor:1.5,percentileThresholdFor1559Fee:75,thresholdToInflateLastBlockBaseFee:0,baseFeeMultiplier:1.05,baseFeeHistoryWindow:100,minPriorityFeeRatioOfBaseFee:void 0,minPriorityFeeGwei:2,maxPriorityFeeGwei:9};function Zi(e,t){if(!e)return;if(!e.currency.isNative)return e;const n=q.subtract(q.BigInt(1e4),q.BigInt(Math.floor(t*100))),o=e.quotient,i=q.divide(q.multiply(o,n),q.BigInt(1e4));return M({value:i.toString(),valueType:E.Raw,currency:e.currency})}function Fo({value:e,gasFee:t,nativeCurrency:n}){if(!t||!n)return e;const o=M({value:t,valueType:E.Raw,currency:n});return e&&o?o.add(e):o}function So(e){const{transactionAmount:t,gasFee:n,nativeCurrencyBalance:o}=e,i=Fo({value:t,gasFee:n,nativeCurrency:o==null?void 0:o.currency});return!i||!(o!=null&&o.lessThan(i))}function To(e){return typeof e=="object"&&e!==null&&"strategies"in e&&Array.isArray(e.strategies)}function Ao(){return st().loadingStatus==="Ready"}function Ee({chainId:e,type:t,isStatsigReady:n}){if(n===!1||!Ao())return ze;const o=st().getDynamicConfig(rt.GasStrategies),i=To(o.value)?o.value:void 0,a=i==null?void 0:i.strategies.find(r=>r.conditions.chainId===e&&r.conditions.types===t&&r.conditions.isActive);return a?a.strategy:ze}function Io({params:e,shouldUsePreviousValueDuringLoading:t,...n}){const{isStatsigReady:o}=at(),i=[R.UniswapApi,V.gasServicePath,e];return Pt({queryKey:i,queryFn:e?()=>Po({...e,isStatsigReady:o}):de,...t&&{placeholderData:rn},...n})}async function Po(e){const{tx:t,smartContractDelegationAddress:n,isStatsigReady:o}=e,i=Ee({chainId:t.chainId,type:"general",isStatsigReady:o});return yo({gasStrategy:i,smartContractDelegationAddress:n})(e)}const Ye="ef0100",_o=46;function Co(e){const{bytecode:t}=e;if(t==="0x")return{isDelegated:!1,delegateTo:null};const n=t.startsWith("0x")?t.slice(2).toLowerCase():t.toLowerCase();return n.startsWith(Ye)&&n.length===_o?{isDelegated:!0,delegateTo:ht(n.replace(Ye,""))}:{isDelegated:!1,delegateTo:null}}function bo(e,t){const n=qt(t),o=(0,g.useMemo)(()=>wo({provider:n}),[n]),{data:i,isLoading:a}=te(o({address:e,chainId:t}));return{isSmartContractAddress:(i==null?void 0:i.isSmartContractAddress)??!1,loading:a}}const wo=e=>t=>ne({queryKey:[R.IsSmartContractAddress,t.address,t.chainId],queryFn:async()=>{var n;return t.address?await((n=e.provider)===null||n===void 0?void 0:n.getCode(t.address))??null:null},enabled:!!t.address,select:ko,refetchInterval:!1,refetchOnWindowFocus:!1,refetchOnMount:!0,refetchOnReconnect:!1});function ko(e){if(!e||e==="0x")return{isSmartContractAddress:!1,isDelegatedAddress:!1};const t=Co({bytecode:ht(e)});return{isSmartContractAddress:!t.isDelegated,isDelegatedAddress:t.isDelegated}}var ve=J(pt());function $i(e,t){const{isStatsigReady:n}=at();return(0,g.useMemo)(()=>Ee({chainId:e,type:t,isStatsigReady:n}),[n,e,t])}function Oo(e,t){if(!e||!t||t.limitInflationFactor===0)return e;const n=1e6,{displayLimitInflationFactor:o,limitInflationFactor:i}=t,a=Math.round(o*n),r=Math.round(i*n);return ve.BigNumber.from(e).mul(ve.BigNumber.from(a)).div(ve.BigNumber.from(r)).toString()}function er({tx:e,smartContractDelegationAddress:t,skip:n,refetchInterval:o,fallbackGasLimit:i,shouldUsePreviousValueDuringLoading:a}){const r=ut(e==null?void 0:e.chainId),{data:s,error:u,isLoading:d}=Io({params:n||!e?void 0:{tx:e,fallbackGasLimit:i,smartContractDelegationAddress:t},refetchInterval:o,staleTime:r,immediateGcTime:r+15*we,shouldUsePreviousValueDuringLoading:a});return(0,g.useMemo)(()=>({...s,error:u,isLoading:d}),[s,u,d])}function Ct(e,t){const n=M({value:t,valueType:E.Raw,currency:e?fe(e):void 0}),{value:o,isLoading:i}=Ot(n);return{isLoading:i,value:o==null?void 0:o.toExact()}}function tr(e,t){const n=M({value:t,valueType:E.Raw,currency:e?fe(e):void 0}),{value:o}=Ot(n);return o}function nr(e,t){const{convertFiatAmountFormatted:n}=oe(),{value:o}=Ct(t,e==null?void 0:e.approvalCost);return(0,g.useMemo)(()=>{if(!e)return;const{approvalCost:i,inputTokenSymbol:a}=e,r=Number(o??0)+Number(e.classicGasUseEstimateUSD??0),s=n(r,x.FiatGasPrice),u=n(0,x.FiatGasPrice);return{approvalFeeFormatted:i?n(o,x.FiatGasPrice):void 0,preSavingsGasFeeFormatted:s,swapFeeFormatted:u,inputTokenSymbol:a}},[e,o,n])}function or(e,t){return(0,g.useMemo)(()=>{if(!t)return!1;const n=parseFloat(t.toExact())/10;return Number(e??0)>n},[e,t])}function ir({account:e,derivedInfo:t,gasFee:n}){const{chainId:o,currencyAmounts:i,currencyBalances:a}=t,{t:r}=Z(),{balance:s}=to(o,e==null?void 0:e.address),{isSmartContractAddress:u}=bo(e==null?void 0:e.address,o),d=i[T.INPUT],m=a[T.INPUT],h=d!=null&&d.currency.isNative?d:void 0,p=So({transactionAmount:h,gasFee:n,nativeCurrencyBalance:s}),v=d&&(m==null?void 0:m.lessThan(d));return(0,g.useMemo)(()=>{if(n===void 0||u||v||!s||p)return;const A=s.currency.symbol??"";return{type:bn.InsufficientGasFunds,severity:P.Medium,action:Cn.DisableSubmit,title:r("swap.warning.insufficientGas.title",{currencySymbol:A}),buttonText:Ut?r("swap.warning.insufficientGas.button",{currencySymbol:A}):void 0,message:void 0,currency:s.currency}},[n,u,v,s,p,r])}function rr({gasFee:e,chainId:t,placeholder:n}){const{convertFiatAmountFormatted:o,formatNumberOrString:i}=oe(),{value:a,isLoading:r}=Ct(t,e==null?void 0:e.displayValue),{isTestnetModeEnabled:s}=Ze(),u=fe(t),d=M({currency:u,value:e==null?void 0:e.displayValue,valueType:E.Raw}),m=o(a,x.FiatGasPrice),h=i({value:d==null?void 0:d.toExact(),type:x.TokenNonTx}),p=n??null,v=(0,g.useMemo)(()=>e!=null&&e.displayValue?!a||s?e.isLoading||r?p:`${h} ${u.symbol}`:m:p,[p,m,e==null?void 0:e.isLoading,e==null?void 0:e.displayValue,a,r,s,h,u.symbol]);return{gasFeeUSD:a,gasFeeFormatted:v}}const bt="0xAAAA44272dc658575Ba38f43C438447dDED45358";function Eo(e){const{getRoutingParams:t,getSlippageParams:n}=e;return function(i){const a=t({tokenInChainId:i.tokenInChainId,tokenOutChainId:i.tokenOutChainId,isUSDQuote:i.isUSDQuote}),r=n({tokenInChainId:i.tokenInChainId,tokenOutChainId:i.tokenOutChainId,isUSDQuote:i.isUSDQuote});return{amount:i.amount.quotient.toString(),generatePermitAsTransaction:i.generatePermitAsTransaction,gasStrategies:[Ee({chainId:i.tokenInChainId,type:"swap"})],isUSDQuote:i.isUSDQuote,swapper:i.activeAccountAddress??bt,tokenIn:i.tokenInAddress,tokenInChainId:i.tokenInChainId,tokenOut:i.tokenOutAddress,tokenOutChainId:i.tokenOutChainId,type:i.requestTradeType,urgency:fn,routingParams:a,slippageParams:r}}}function Mo(e){const{routingParams:t,slippageParams:n,...o}=e;return{...o,...t,...n}}function Uo(e){var t;const{currencyIn:n,currencyOut:o,requestTradeType:i}=Oe(e);return{currencyIn:n,currencyOut:o,amount:e.amountSpecified,requestTradeType:i,activeAccountAddress:(t=e.account)===null||t===void 0?void 0:t.address,tokenInChainId:Le(n==null?void 0:n.chainId),tokenOutChainId:Le(o==null?void 0:o.chainId),tokenInAddress:Re(n),tokenOutAddress:Re(o),generatePermitAsTransaction:e.generatePermitAsTransaction,isUSDQuote:e.isUSDQuote??!1}}function qo(e){if(!(!e.tokenInChainId||!e.tokenOutChainId||!e.tokenInAddress||!e.tokenOutAddress||!e.amount||!e.currencyIn||!e.currencyOut||po(e.amount)||Do(e.currencyIn,e.currencyOut)))return{currencyIn:e.currencyIn,currencyOut:e.currencyOut,amount:e.amount,requestTradeType:e.requestTradeType,activeAccountAddress:e.activeAccountAddress,tokenInChainId:e.tokenInChainId,tokenOutChainId:e.tokenOutChainId,tokenInAddress:e.tokenInAddress,tokenOutAddress:e.tokenOutAddress,generatePermitAsTransaction:e.generatePermitAsTransaction,isUSDQuote:e.isUSDQuote}}function Do(e,t){return!e||!t?!1:e.equals(t)}function Qo(e){if(!(!(e!=null&&e.quote)||!("gasEstimates"in e.quote)||!e.quote.gasEstimates))return e.quote.gasEstimates[0]}const No=30;function Go(e){if(!e.quote)return null;const t=e.quoteCurrencyData,{currencyIn:n,currencyOut:o,requestTradeType:i}=t,a=i===Te.EXACT_INPUT?T.INPUT:T.OUTPUT,r=Qo(e.quote),s=n&&o?Fn({currencyIn:n,currencyOut:o,tradeType:i,deadline:Zt(No),data:e.quote}):null,u=s?Tn({trade:s,currencyIn:n,currencyOut:o,exactAmount:e.amountSpecified,exactCurrencyField:a}):null;return{...e.quote,gasEstimate:r,trade:u}}function Ro(e){const{tradeRepository:t,getIsUniswapXSupported:n,getEnabledChains:o,getIsL2ChainId:i,getMinAutoSlippageToleranceL2:a,onTradeError:r}=e,s=mn({getIsUniswapXSupported:n,getEnabledChains:o});return{prepareTradeInput:Pe,prepareIndicativeTradeInput:Je,async getTrade(u){let d;try{const m=pn({getProtocols:()=>{var L;return s(u.selectedProtocols??ln,(L=u.amountSpecified)===null||L===void 0?void 0:L.currency.chainId)},getIsV4HookPoolsEnabled:()=>u.isV4HookPoolsEnabled??!0}),h=vn({getIsL2ChainId:i,getMinAutoSlippageToleranceL2:a,getCustomSlippageTolerance:()=>u.customSlippageTolerance}),p=Eo({getRoutingParams:m,getSlippageParams:h}),v=Pe(u);if(!v)return{trade:null};const A=p(v);d=Mo(A);const F=await t.fetchQuote(d),S=Go({quote:F,amountSpecified:v.amount,quoteCurrencyData:{currencyIn:v.currencyIn,currencyOut:v.currencyOut,requestTradeType:v.requestTradeType}});return{trade:(S==null?void 0:S.trade)??null,gasEstimate:S==null?void 0:S.gasEstimate}}catch(m){const h=m instanceof Error?m:new Error("Unknown error");throw r==null||r(h,{input:u,quoteRequestArgs:d}),d=void 0,h}},async getIndicativeTrade(u){const d=Je(u);if(!d)return null;const m=Lo(d);try{const p=await t.fetchIndicativeQuote(m),v=Sn(p);return v?new dn({quote:v,currencyIn:d.currencyIn,currencyOut:d.currencyOut}):null}catch(p){var h;return(h=e.logger)===null||h===void 0||h.error(p,{tags:{file:"tradeService.ts",function:"getIndicativeTrade"}}),null}}}}function Pe(e){if(!e||e.skip)return null;const t=Uo(e),n=qo(t);return n||null}function Je(e){return!e||e.skip||e.isUSDQuote?null:Pe(e)}function Lo(e){return{type:e.requestTradeType,amount:e.amount.quotient.toString(),tokenInChainId:e.tokenInChainId,tokenOutChainId:e.tokenOutChainId,tokenIn:e.tokenInAddress,tokenOut:e.tokenOutAddress,swapper:e.activeAccountAddress||bt}}function Bo(e){const{getIsUniswapXSupported:t,getEnabledChains:n}=e;return Ro({tradeRepository:ho(),getIsUniswapXSupported:t,getEnabledChains:n,getIsL2ChainId:o=>o?Kt(o):!1,getMinAutoSlippageToleranceL2:gn,logger:Me(),onTradeError:(o,i)=>{(!Mt||!(o instanceof dt))&&!i.input.isUSDQuote&&Me().error(o,{tags:{file:"useTrade",function:"quote"},extra:{...i.quoteRequestArgs}})}})}function wt(){const e=Dt(n=>n.getIsUniswapXSupported),t=Ze();return(0,g.useMemo)(()=>Bo({getIsUniswapXSupported:e??(()=>!1),getEnabledChains:()=>t.chains}),[e,t])}function Ho(e){return t=>{var n;const o=e.tradeService.prepareIndicativeTradeInput(t);return ne({queryKey:[R.TradeService,"getIndicativeTrade",o],queryFn:async()=>t?e.tradeService.getIndicativeTrade(t):null,enabled:!!t&&!t.skip&&!!o&&((n=t.amountSpecified)===null||n===void 0?void 0:n.currency.chainId)!==$.Solana})}}function xo(e){const t=wt(),n=_e(Ho({tradeService:t})),{data:o,isLoading:i}=te(n(e));return{trade:o??void 0,isLoading:i}}function Vo(e){return t=>{var n;const o=t?e.tradeService.prepareTradeInput(t):null;return ne({queryKey:[R.TradeService,"getTrade",o],queryFn:async()=>t?e.tradeService.getTrade(t):{trade:null},enabled:!!t&&!t.skip&&!!o&&((n=t.amountSpecified)===null||n===void 0?void 0:n.currency.chainId)!==$.Solana})}}function Ko(e){var t;const n=Oe(e),o=ut((t=n.currencyIn)===null||t===void 0?void 0:t.chainId),i=e.pollInterval??o,a=wt(),r=_e(Vo({tradeService:a})),s=Pt({...r(e),refetchInterval:i,immediateGcTime:i+we*15,retry:1}),u=(0,g.useRef)(s.error);return s.errorUpdatedAt>s.dataUpdatedAt?u.current=s.error??u.current:u.current=s.error,{...s,error:u.current}}function Wo(e){const{error:t,data:n,isLoading:o,isFetching:i}=Ko(e),a=e.amountSpecified&&e.isDebouncing||o,r=xo(e),{currencyIn:s,currencyOut:u}=Oe(e),d=mo(e);return(0,g.useMemo)(()=>(s==null?void 0:s.chainId)===$.Solana?d:Xo({data:n,currencyIn:s,currencyOut:u,isLoading:a,isFetching:i,indicative:r,error:t,isDebouncing:e.isDebouncing}),[s,u,n,t,r,i,a,e.isDebouncing,d])}function Xo(e){const{data:t,currencyIn:n,currencyOut:o,isLoading:i,isFetching:a,indicative:r,error:s,isDebouncing:u}=e;return!(t!=null&&t.trade)||!n||!o?{isLoading:!!(i||u),isFetching:a,trade:null,indicativeTrade:i?r.trade:void 0,isIndicativeLoading:r.isLoading,error:s,gasEstimate:t==null?void 0:t.gasEstimate}:t.trade===null?{isLoading:i,isFetching:a,trade:null,indicativeTrade:void 0,isIndicativeLoading:!1,error:new Error("Unable to validate trade"),gasEstimate:t.gasEstimate}:{isLoading:u||i,isFetching:a,trade:t.trade,indicativeTrade:r.trade,isIndicativeLoading:r.isLoading,error:s,gasEstimate:t.gasEstimate}}ee();et();const jo=30,zo=1e3;function Yo(e){const t=Vt(e);if(e===$.Soneium){const o=jo*Math.pow(10,t.decimals);return H.fromRawAmount(t,o)}const n=zo*Math.pow(10,t.decimals);return H.fromRawAmount(t,n)}function kt(e,t=$e.Fast){const n=e==null?void 0:e.chainId,o=(0,g.useMemo)(()=>Wt(n)?Yo(n):void 0,[n]),i=o==null?void 0:o.currency,a=!!(i&&e&&Xt(he(e),he(i))),r=a?void 0:o,{trade:s,isLoading:u}=Wo({amountSpecified:r,otherCurrency:e,tradeType:O.EXACT_OUTPUT,pollInterval:t,isUSDQuote:!0});return(0,g.useMemo)(()=>{if(!i)return{price:void 0,isLoading:!1};if(a)return{price:new se(i,i,"1","1"),isLoading:!1};if(s&&An(s)&&e){const h=q.BigInt(s.quote.quote.inAmount),p=q.BigInt(s.quote.quote.outAmount);return{price:new se(e,i,h,p),isLoading:u}}if(!s||!G(s)||!s.routes[0]||!e)return{price:void 0,isLoading:u};const{numerator:d,denominator:m}=s.routes[0].midPrice;return{price:new se(e,i,m,d),isLoading:u}},[e,i,a,s,u])}function ar(e,t=$e.Fast){const{price:n}=kt(e==null?void 0:e.currency,t);return(0,g.useMemo)(()=>{if(!n||!e)return null;try{return n.quote(e)}catch{return null}},[e,n])}function Ot(e){const{price:t,isLoading:n}=kt(e==null?void 0:e.currency);return(0,g.useMemo)(()=>{if(!t||!e)return{value:null,isLoading:n};try{return{value:t.quote(e),isLoading:n}}catch{return{value:null,isLoading:!1}}},[e,n,t])}export{xn as JupiterApiClient,Kn as SharedQueryClient,l as TokenProtectionWarning,Te as TradeType,Zi as applyNativeTokenPercentageBuffer,Oo as convertGasFeeToDisplayValue,Ji as fetchTrmScreen,Bn as getBaseTradeAnalyticsProperties,zi as getBaseTradeAnalyticsPropertiesFromSwapInfo,Un as getCurrencyFeeOnTransfer,Wi as getFeeColor,qn as getFeeWarning,Bi as getIsFeeRelatedWarning,Yn as getOnChainBalancesFetch,Ln as getRouteAnalyticsData,St as getSeverityFromTokenProtectionWarning,Hi as getShouldHaveCombinedPluralTreatment,Xi as getSwapFeeUsdFromDerivedSwapInfo,Ft as getTokenProtectionFeeOnTransfer,ce as getTokenProtectionWarning,xe as getTokenWarningSeverity,Ke as logSwapQuoteFetch,Hn as tradeRoutingToFillType,$i as useActiveGasStrategy,Dn as useCardHeaderText,Qn as useCardSubtitleText,nr as useFormattedUniswapXGasFeeInfo,rr as useGasFeeFormattedDisplayAmounts,or as useGasFeeHighRelativeToValue,bo as useIsSmartContractAddress,xi as useModalHeaderText,Vi as useModalSubtitleText,eo as useOnChainCurrencyBalance,Pt as useQueryWithImmediateGarbageCollection,ji as useSwapAnalytics,Ki as useTokenWarningCardText,Wo as useTrade,er as useTransactionGasFee,ir as useTransactionGasWarning,kt as useUSDCPrice,ar as useUSDCValue,tr as useUSDCurrencyAmountOfGasFee,Ct as useUSDValueOfGasFee,Yi as validateGasFeeResult};
