import{__toESM as V}from"./chunk-DgAfPHQg.js";import{require_react as h}from"./react-CNoFhWkx.js";import{ProtocolVersion as T}from"./types_pb-yZxlo4b1.js";import{useAtomValue as C}from"./utils-CDaPKk14.js";import{PoolSortFields as k,calculate1DVolOverTvl as F,calculateApr as w,exploreSearchStringAtom as E}from"./state-DRfrbe8S.js";import{OrderDirection as P}from"./util-BZ6kLG7e.js";import{DEFAULT_TICK_SPACING as L,V2_DEFAULT_FEE_TIER as D}from"./pools-5GjP-hMy.js";import{ExploreContext as x,giveExploreStatDefaultValue as n}from"./explore-CL40v3_c.js";var S=V(h());function I(o){const t=C(E),e=(0,S.useMemo)(()=>t.toLowerCase(),[t]);return(0,S.useMemo)(()=>o==null?void 0:o.filter(l=>{var r,i,v,d,c,p;const m=l.id.toLowerCase().includes(e),u=(r=l.token0)===null||r===void 0||(r=r.symbol)===null||r===void 0?void 0:r.toLowerCase().includes(e),f=(i=l.token1)===null||i===void 0||(i=i.symbol)===null||i===void 0?void 0:i.toLowerCase().includes(e),s=(v=l.token0)===null||v===void 0?void 0:v.address.toLowerCase().includes(e),a=(d=l.token1)===null||d===void 0?void 0:d.address.toLowerCase().includes(e),g=`${(c=l.token0)===null||c===void 0?void 0:c.symbol}/${(p=l.token1)===null||p===void 0?void 0:p.symbol}`.toLowerCase().includes(e);return u||f||m||s||a||g}),[e,o])}function O(o,t){return t==null?void 0:t.sort((e,l)=>{switch(o.sortBy){case k.VolOverTvl:return o.sortDirection===P.Desc?(l.volOverTvl??0)-(e.volOverTvl??0):(e.volOverTvl??0)-(l.volOverTvl??0);case k.Volume24h:var r,i,v,d;return o.sortDirection===P.Desc?n((r=l.volume1Day)===null||r===void 0?void 0:r.value)-n((i=e.volume1Day)===null||i===void 0?void 0:i.value):n((v=e.volume1Day)===null||v===void 0?void 0:v.value)-n((d=l.volume1Day)===null||d===void 0?void 0:d.value);case k.Volume30D:var c,p,m,u;return o.sortDirection===P.Desc?n((c=l.volume30Day)===null||c===void 0?void 0:c.value)-n((p=e.volume30Day)===null||p===void 0?void 0:p.value):n((m=e.volume30Day)===null||m===void 0?void 0:m.value)-n((u=l.volume30Day)===null||u===void 0?void 0:u.value);case k.Apr:return o.sortDirection===P.Desc?l.apr.greaterThan(e.apr)?1:-1:e.apr.greaterThan(l.apr)?1:-1;case k.RewardApr:return o.sortDirection===P.Desc?(l.boostedApr??0)-(e.boostedApr??0):(e.boostedApr??0)-(l.boostedApr??0);default:var f,s,a,A;return o.sortDirection===P.Desc?n((f=l.totalLiquidity)===null||f===void 0?void 0:f.value)-n((s=e.totalLiquidity)===null||s===void 0?void 0:s.value):n((a=e.totalLiquidity)===null||a===void 0?void 0:a.value)-n((A=l.totalLiquidity)===null||A===void 0?void 0:A.value)}})}function B(o){var t,e,l,r,i;return{...o,apr:w({volume24h:n((t=o.volume1Day)===null||t===void 0?void 0:t.value),tvl:n((e=o.totalLiquidity)===null||e===void 0?void 0:e.value),feeTier:o.feeTier??D}),boostedApr:o.boostedApr,feeTier:{feeAmount:o.feeTier??D,tickSpacing:L,isDynamic:!1},volOverTvl:F((l=o.volume1Day)===null||l===void 0?void 0:l.value,(r=o.totalLiquidity)===null||r===void 0?void 0:r.value),hookAddress:(i=o.hook)===null||i===void 0?void 0:i.address}}function M(o,t){switch(t){case T.V2:var e;return o==null||(e=o.stats)===null||e===void 0?void 0:e.poolStatsV2;case T.V3:var l;return o==null||(l=o.stats)===null||l===void 0?void 0:l.poolStatsV3;case T.V4:var r;return o==null||(r=o.stats)===null||r===void 0?void 0:r.poolStatsV4;default:var i;return o==null||(i=o.stats)===null||i===void 0?void 0:i.poolStats}}function z(o,t){const{exploreStats:{data:e,isLoading:l,error:r}}=(0,S.useContext)(x);return N({topPoolData:{data:e,isLoading:l,isError:r},sortState:o,protocol:t})}function N({topPoolData:o,sortState:t,protocol:e}){const{data:l,isLoading:r,isError:i}=o,v=M(l,e),{sortedPoolStats:d,boostedPoolStats:c}=(0,S.useMemo)(()=>{const m=v==null?void 0:v.map(s=>B(s)),u=O(t,m),f=u==null?void 0:u.filter(s=>typeof s.boostedApr=="number"&&s.boostedApr>0).sort((s,a)=>(a.boostedApr??0)-(s.boostedApr??0));return{sortedPoolStats:u,boostedPoolStats:f}},[v,t]);return{topPools:I(d),topBoostedPools:c,isLoading:r,isError:i}}export{z as useExploreContextTopPools,N as useTopPools};
