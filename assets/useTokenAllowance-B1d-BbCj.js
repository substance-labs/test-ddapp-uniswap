import{__toESM as y}from"./chunk-DgAfPHQg.js";import{require_react as v}from"./react-CNoFhWkx.js";import{usePrevious as h}from"./hooks-BXO4d1DJ.js";import{CurrencyAmount as f,MaxUint256 as A,init_sdk_core_esm as T}from"./utils-BX1Fu73x.js";import{InterfaceEventName as g}from"./interface-BdpC4qOF.js";import{erc20Abi as b}from"./call-CTDbaN-t.js";import{sendAnalyticsEvent as E}from"./send.web-CrSXW2rw.js";import{TransactionType as p}from"./transactionDetails-BsNW_jus.js";import{useTrace as _}from"./TraceContext-Ddfk7zjz.js";import{assume0xAddress as d}from"./wagmi-CsUiFCSO.js";import{useReadContract as R}from"./useReadContract-DodDFlY8.js";import{UserRejectedRequestError as u}from"./errors-BaezSPLl.js";import{didUserReject as I}from"./swapErrorToUserReadableMessage-DgHZMHU-.js";import{useTokenContract as k}from"./useContract-CKZ4cOLX.js";import{usePendingTransactions as M}from"./hooks-BA_A7Su9.js";var s=y(v());function S(r,o){const t=M(),c=(0,s.useMemo)(()=>t.filter(e=>e.typeInfo.type===r).length,[t,r]),n=h(c);(0,s.useEffect)(()=>{n&&c<n&&o()},[c,n,o])}T();const q=A.toString();function H({token:r,owner:o,spender:t}){const c=!!o&&!!t,{data:n,isFetching:e,refetch:i}=R({address:d(r==null?void 0:r.address),chainId:r==null?void 0:r.chainId,abi:b,functionName:"allowance",args:c?[d(o),d(t)]:void 0,query:{enabled:c}});S(p.Approve,i);const a=(0,s.useMemo)(()=>r&&n!==void 0?f.fromRawAmount(r,n.toString()):void 0,[r,n]);return(0,s.useMemo)(()=>({tokenAllowance:a,isSyncing:e}),[a,e])}function C(r,o){const t=_(),c=k({tokenAddress:r==null?void 0:r.currency.address,withSignerIfPossible:!0,chainId:r==null?void 0:r.currency.chainId}),n=(0,s.useRef)(c);return n.current=c,(0,s.useCallback)(async()=>{try{const e=n.current;if(!r)throw new Error("missing amount");if(!e)throw new Error("missing contract");if(!o)throw new Error("missing spender");const i=r.equalTo(0)?"0":q,a=await(async()=>{const l=n.current;try{if(!l)throw new Error("missing contract");return await l.approve(o,i)}catch(m){if(I(m)){const w=r.currency.symbol??"Token";throw new u(`${w} token allowance failed: User rejected`)}else throw m}})();return E(g.ApproveTokenTxnSubmitted,{chain_id:r.currency.chainId,token_symbol:r.currency.symbol,token_address:r.currency.address,...t}),{response:a,info:{type:p.Approve,tokenAddress:e.address,spender:o,amount:i}}}catch(e){if(e instanceof u)throw e;{const i=(r==null?void 0:r.currency.symbol)??"Token";throw new Error(`${i} token allowance failed: ${e instanceof Error?e.message:e}`)}}},[r,o,t])}function J(r,o){const t=(0,s.useMemo)(()=>r?f.fromRawAmount(r,0):void 0,[r]);return C(t,o)}export{J as useRevokeTokenAllowance,H as useTokenAllowance,S as useTriggerOnTransactionType,C as useUpdateTokenAllowance};
