import{__toESM as I}from"./chunk-DgAfPHQg.js";import{require_react as C}from"./react-CNoFhWkx.js";import{CurrencyAmount as b,init_jsbi as A,init_sdk_core_esm as T,jsbi_default as k}from"./utils-BX1Fu73x.js";import{hexToString as _,trim as q}from"./isAddress-P2vaZgmG.js";import{weiUnits as O}from"./node-C_BraYgX.js";import{formatUnits as h}from"./formatUnits-DkyMpOD7.js";import{erc20Abi as R}from"./call-CTDbaN-t.js";import{ValueType as S,getCurrencyAmount as E}from"./getCurrencyAmount-vvZpAzIm.js";import{isAddress as N}from"./addresses-D56PBUHX.js";import{usePortfolioBalances as x}from"./balances-DV0Wvmri.js";import{getBalance as L}from"./getBalance-TsPVbzB5.js";import{getAction as K}from"./getAction-BBhbL9mE.js";import{useAccount as y,useChainId as Q,useConfig as U}from"./useAccount-C5hwiBwN.js";import{readContracts as j,useReadContracts as F}from"./useReadContracts-Orb8TypL.js";import{assume0xAddress as g}from"./wagmi-CsUiFCSO.js";import{filterQueryOptions as P,useQuery as V}from"./query-qNZtVuxH.js";import{currencyKey as B}from"./currencyKey-B-LQIyOE.js";function M(n){return typeof n=="number"?n:n==="wei"?0:Math.abs(O[n])}async function D(n,t){const{address:i,blockNumber:o,blockTag:r,chainId:s,token:a,unit:e="ether"}=t;if(a)try{return await v(n,{balanceAddress:i,chainId:s,symbolType:"string",tokenAddress:a})}catch(f){if(f.name==="ContractFunctionExecutionError"){const p=await v(n,{balanceAddress:i,chainId:s,symbolType:"bytes32",tokenAddress:a}),w=_(q(p.symbol,{dir:"right"}));return{...p,symbol:w}}throw f}const l=n.getClient({chainId:s}),c=await K(l,L,"getBalance")(o?{address:i,blockNumber:o}:{address:i,blockTag:r}),d=n.chains.find(f=>f.id===s)??l.chain;return{decimals:d.nativeCurrency.decimals,formatted:h(c,M(e)),symbol:d.nativeCurrency.symbol,value:c}}async function v(n,t){const{balanceAddress:i,chainId:o,symbolType:r,tokenAddress:s,unit:a}=t,e={abi:[{type:"function",name:"balanceOf",stateMutability:"view",inputs:[{type:"address"}],outputs:[{type:"uint256"}]},{type:"function",name:"decimals",stateMutability:"view",inputs:[],outputs:[{type:"uint8"}]},{type:"function",name:"symbol",stateMutability:"view",inputs:[],outputs:[{type:r}]}],address:s},[l,m,c]=await j(n,{allowFailure:!1,contracts:[{...e,functionName:"balanceOf",args:[i],chainId:o},{...e,functionName:"decimals",chainId:o},{...e,functionName:"symbol",chainId:o}]}),d=h(l??"0",M(a??m));return{decimals:m,formatted:d,symbol:c,value:l}}function G(n,t={}){return{async queryFn({queryKey:i}){const{address:o,scopeKey:r,...s}=i[1];if(!o)throw new Error("address is required");return await D(n,{...s,address:o})??null},queryKey:H(t)}}function H(n={}){return["balance",P(n)]}function W(n={}){const{address:t,query:i={}}=n,o=U(n),r=Q({config:o}),s=G(o,{...n,chainId:n.chainId??r}),a=!!(t&&(i.enabled??!0));return V({...i,...s,enabled:a})}var u=I(C());function $({cacheOnly:n}={}){const t=y(),{data:i,loading:o}=x({address:t.address??"",fetchPolicy:n?"cache-first":"cache-and-network"});return(0,u.useMemo)(()=>{if(!i)return{balanceMap:{},balanceList:[],loading:o};const r=Object.values(i);return{balanceMap:r.reduce((a,e)=>{const l=e.currencyInfo.currency,m=B(l),c=e.balanceUSD??0,d=e.quantity;return a[m]={usdValue:c,balance:d},a},{}),balanceList:r,loading:o}},[i,o])}T();A();function z({address:n,tokens:t,skip:i}){const{chainId:o}=y(),r=(0,u.useMemo)(()=>i?[]:(t==null?void 0:t.filter(e=>N(e==null?void 0:e.address)!==!1&&(e==null?void 0:e.chainId)===o))??[],[o,t,i]),{data:s,isLoading:a}=F({contracts:(0,u.useMemo)(()=>r.map(e=>({address:g(e.address),chainId:o,abi:R,functionName:"balanceOf",args:[n]})),[n,o,r]),query:{enabled:!!n}});return(0,u.useMemo)(()=>[n&&r.length>0?r.reduce((e,l,m)=>{const c=s==null?void 0:s[m].result;if(!c)return e;const d=c?k.BigInt(c.toString()):void 0;return d&&(e[l.address]=b.fromRawAmount(l,d)),e},{}):{},a],[n,r,a,s])}function J(n,t){return z({address:n,tokens:t})[0]}function X(n,t){const i=(0,u.useMemo)(()=>(t==null?void 0:t.filter(e=>(e==null?void 0:e.isToken)??!1))??[],[t]),{chainId:o}=y(),r=J(n,i),s=(0,u.useMemo)(()=>(t==null?void 0:t.some(e=>e==null?void 0:e.isNative))??!1,[t]),{data:a}=W({address:g(n),chainId:o,query:{enabled:s&&!!n}});return(0,u.useMemo)(()=>(t==null?void 0:t.map(e=>{if(!(!n||!e||e.chainId!==o))return e.isToken?r[e.address]:a!=null&&a.value?b.fromRawAmount(e,a.value.toString()):void 0}))??[],[n,o,t,a==null?void 0:a.value,r])}function Y(n,t){const{balanceMap:i}=$({cacheOnly:!0});return(0,u.useMemo)(()=>!n||!t?[]:t.map(o=>{if(!o)return;const r=B(o),s=i[r];if(s){const a=E({value:s.balance.toString(),valueType:S.Exact,currency:o});return a||void 0}else return b.fromRawAmount(o,0)}),[n,i,t])}function Z(n,t){const{chainId:i}=y(),o=(0,u.useMemo)(()=>{var e;return t==null||(e=t[0])===null||e===void 0?void 0:e.chainId},[t]),r=!o||o===i,s=Y(n,t),a=X(n,t);return(0,u.useMemo)(()=>!n||!t?[]:r?a:s,[n,t,r,s,a])}function gn(n,t){return nn(n,t)}function nn(n,t){return Z(n,(0,u.useMemo)(()=>[t],[t]))[0]}export{nn as useCurrencyBalance,Z as useCurrencyBalances,z as useRpcTokenBalancesWithLoadingIndicator,gn as useTokenBalance,$ as useTokenBalances};
